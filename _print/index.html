<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js data-theme-init><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=color-scheme content="light dark"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#000000"><style>html{background:Canvas;color:CanvasText}@media(prefers-color-scheme:dark){html{background:#0b0d12;color:#e6e6e6}}html[data-theme-init] *{transition:none!important}</style><script>(function(){const t="td-color-theme",n=localStorage.getItem(t);let e=n||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");e==="auto"&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.setAttribute("data-bs-theme",e)})()</script><link rel=canonical type=text/html href=https://fchastanet.github.io/my-documents/><link rel=alternate type=application/rss+xml href=https://fchastanet.github.io/my-documents/index.xml><link rel=alternate type=application/json href=https://fchastanet.github.io/my-documents/index.json><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/my-documents/favicons/favicon.ico><link rel=apple-touch-icon href=/my-documents/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/my-documents/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/my-documents/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/my-documents/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/my-documents/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/my-documents/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/my-documents/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/my-documents/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/my-documents/favicons/android-192x192.png sizes=192x192><title>My Documents</title><meta name=description content="Welcome to My Documents, a personal collection of notes, guides, and resources on various topics related to development, testing, and documentation. This site is organized into several sections, each containing detailed content and resources to help you explore and learn about different aspects of software development and documentation."><meta property="og:url" content="https://fchastanet.github.io/my-documents/"><meta property="og:site_name" content="My Documents"><meta property="og:title" content="My Documents"><meta property="og:description" content="Welcome to My Documents, a personal collection of notes, guides, and resources on various topics related to development, testing, and documentation. This site is organized into several sections, each containing detailed content and resources to help you explore and learn about different aspects of software development and documentation."><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><meta itemprop=name content="My Documents"><meta itemprop=description content="Welcome to My Documents, a personal collection of notes, guides, and resources on various topics related to development, testing, and documentation. This site is organized into several sections, each containing detailed content and resources to help you explore and learn about different aspects of software development and documentation."><meta itemprop=wordCount content="48"><meta name=twitter:card content="summary"><meta name=twitter:title content="My Documents"><meta name=twitter:description content="Welcome to My Documents, a personal collection of notes, guides, and resources on various topics related to development, testing, and documentation. This site is organized into several sections, each containing detailed content and resources to help you explore and learn about different aspects of software development and documentation."><link rel=preload href=/my-documents/scss/main.min.9e50c00facbebb58d8217b505ef77562d03cd9d47700a424a4a96bcc2c824633.css as=style integrity="sha256-nlDAD6y+u1jYIXtQXvd1YtA82dR3AKQkpKlrzCyCRjM=" crossorigin=anonymous><link href=/my-documents/scss/main.min.9e50c00facbebb58d8217b505ef77562d03cd9d47700a424a4a96bcc2c824633.css rel=stylesheet integrity="sha256-nlDAD6y+u1jYIXtQXvd1YtA82dR3AKQkpKlrzCyCRjM=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script><meta name=description content="Technical documentation on Bash scripting, Docker, Jenkins, and development best practices"><meta name=keywords content="bash,best practices,learn,docker,jenkins,documentation"><meta name=robots content="index, follow"><meta name=author content="fchastanet"><script type=application/ld+json>{"@context":"https://schema.org","@type":"TechArticle","headline":"\u0022My Documents\u0022","description":"\u0022\\u003cdiv class=\\\u0022pageinfo pageinfo-primary\\\u0022\\u003e\\n\\u003cp\\u003eWelcome to My Documents, a personal collection of notes, guides, and resources on\\nvarious topics related to development, testing, and documentation.\\nThis site …\\u003c\/p\\u003e\\u003c\/div\\u003e\u0022","author":{"@type":"Person","name":"\u0022fchastanet\u0022"},"publisher":{"@type":"Organization","name":"\u0022My Documents\u0022","url":"\u0022https:\/\/fchastanet.github.io\/my-documents\/\u0022"},"mainEntityOfPage":{"@type":"WebPage","@id":"\u0022https:\/\/fchastanet.github.io\/my-documents\/\u0022"}}</script><meta property="og:title" content="My Documents"><meta property="og:description" content="
Welcome to My Documents, a personal collection of notes, guides, and resources on
various topics related to development, testing, and documentation.
This site …"><meta property="og:url" content="https://fchastanet.github.io/my-documents/"><meta property="og:type" content="article"><meta property="og:site_name" content="My Documents"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="My Documents"><meta name=twitter:description content="
Welcome to My Documents, a personal collection of notes, guides, and resources on
various topics related to development, testing, and documentation.
This site …"><link rel=canonical href=https://fchastanet.github.io/my-documents/></head><body class=td-home><header><nav class="td-navbar js-navbar-scroll"><div class="td-navbar-container container-fluid flex-column flex-md-row"><a class=navbar-brand href=/my-documents/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>My Documents</span></a><div class="td-navbar__main td-navbar-nav-scroll td-navbar-nav-scroll--indicator" id=main_navbar><div class="scroll-indicator scroll-left"></div><ul class=navbar-nav><li class=nav-item><a class=nav-link href=https://github.com/fchastanet/my-documents target=_blank rel=noopener><span>GitHub</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://fchastanet.github.io/bash-tools-framework/ target=_blank rel=noopener><span>Bash Tools Framework</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://fchastanet.github.io/bash-tools/ target=_blank rel=noopener><span>Bash Tools</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://fchastanet.github.io/bash-dev-env/ target=_blank rel=noopener><span>Bash Dev Env</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class=nav-item><a class=nav-link href=https://fchastanet.github.io/bash-compiler/ target=_blank rel=noopener><span>Bash Compiler</span><sup><i class="ps-1 fa-solid fa-up-right-from-square fa-xs" aria-hidden=true></i></sup></a></li><li class="nav-item td-navbar__light-dark-menu"><div class="td-light-dark-menu dropdown"><svg class="d-none"><symbol id="check2" viewBox="0 0 16 16"><path d="M13.854 3.646a.5.5.0 010 .708l-7 7a.5.5.0 01-.708.0l-3.5-3.5a.5.5.0 11.708-.708L6.5 10.293l6.646-6.647a.5.5.0 01.708.0z"/></symbol><symbol id="circle-half" viewBox="0 0 16 16"><path d="M8 15A7 7 0 108 1v14zm0 1A8 8 0 118 0a8 8 0 010 16z"/></symbol><symbol id="moon-stars-fill" viewBox="0 0 16 16"><path d="M6 .278a.768.768.0 01.08.858 7.208 7.208.0 00-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527.0 1.04-.055 1.533-.16a.787.787.0 01.81.316.733.733.0 01-.031.893A8.349 8.349.0 018.344 16C3.734 16 0 12.286.0 7.71.0 4.266 2.114 1.312 5.124.06A.752.752.0 016 .278z"/><path d="M10.794 3.148a.217.217.0 01.412.0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217.0 010 .412l-1.162.387A1.734 1.734.0 0011.593 7.69l-.387 1.162a.217.217.0 01-.412.0l-.387-1.162A1.734 1.734.0 009.31 6.593l-1.162-.387a.217.217.0 010-.412l1.162-.387a1.734 1.734.0 001.097-1.097l.387-1.162zM13.863.099a.145.145.0 01.274.0l.258.774c.115.346.386.617.732.732l.774.258a.145.145.0 010 .274l-.774.258a1.156 1.156.0 00-.732.732l-.258.774a.145.145.0 01-.274.0l-.258-.774a1.156 1.156.0 00-.732-.732l-.774-.258a.145.145.0 010-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/></symbol><symbol id="sun-fill" viewBox="0 0 16 16"><path d="M8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 0zm0 13a.5.5.0 01.5.5v2a.5.5.0 01-1 0v-2A.5.5.0 018 13zm8-5a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2a.5.5.0 01.5.5zM3 8a.5.5.0 01-.5.5h-2a.5.5.0 010-1h2A.5.5.0 013 8zm10.657-5.657a.5.5.0 010 .707l-1.414 1.415a.5.5.0 11-.707-.708l1.414-1.414a.5.5.0 01.707.0zm-9.193 9.193a.5.5.0 010 .707L3.05 13.657a.5.5.0 01-.707-.707l1.414-1.414a.5.5.0 01.707.0zm9.193 2.121a.5.5.0 01-.707.0l-1.414-1.414a.5.5.0 01.707-.707l1.414 1.414a.5.5.0 010 .707zM4.464 4.465a.5.5.0 01-.707.0L2.343 3.05a.5.5.0 11.707-.707l1.414 1.414a.5.5.0 010 .708z"/></symbol></svg>
<button class="btn btn-link nav-link dropdown-toggle d-flex align-items-center" id=bd-theme type=button aria-expanded=false data-bs-toggle=dropdown aria-label="Toggle theme (auto)">
<svg class="bi my-1 theme-icon-active"><use href="#circle-half"/></svg></button><ul class=dropdown-menu aria-labelledby=bd-theme><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=light aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#sun-fill"/></svg>
Light
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center" data-bs-theme-value=dark aria-pressed=false>
<svg class="bi me-2 opacity-50"><use href="#moon-stars-fill"/></svg>
Dark
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li><li><button type=button class="dropdown-item d-flex align-items-center active" data-bs-theme-value=auto aria-pressed=true>
<svg class="bi me-2 opacity-50"><use href="#circle-half"/></svg>
Auto
<svg class="bi ms-auto d-none"><use href="#check2"/></svg></button></li></ul></div></li></ul><div class="scroll-indicator scroll-right"></div></div><div class="td-navbar__search d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search name=q class="td-search__input form-control" placeholder='Search this site…' aria-label='Search this site…' autocomplete=off data-offline-search-index-json-src=/my-documents/offline-search-index.01656e0e4f2430e2a37948525bf31617.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/my-documents/>Return to the regular view of this page</a>.</p></div><h1 class=title>My Documents</h1><ul><li>1: <a href=#pg-4cdd37113783e47641dd300543c94e1b>Documentation</a></li><ul><li>1.1: <a href=#pg-ea619b912690ef4d28763959e571914b>Brainstorming</a></li><ul><li>1.1.1: <a href=#pg-6d62e8a5f4243aec89d15154415c47d2>Static Site Generation Migration Analysis</a></li></ul><li>1.2: <a href=#pg-56d2ab02e267eeddf83eefa58f6669e5>Bash Scripts</a></li><ul><li>1.2.1: <a href=#pg-7ef26c14a02482638bf4859504252d1d>Basic Best Practices</a></li><li>1.2.2: <a href=#pg-95d2544e96fb3b262007c120f8333ac8>Linux Commands Best Practices</a></li><li>1.2.3: <a href=#pg-68381a72b7319e266b81540193a71450>Bats Testing Framework</a></li></ul><li>1.3: <a href=#pg-17b81e141eb8ac7e0af38775813b1152>How-To Guides</a></li><ul><li>1.3.1: <a href=#pg-6cc9860e9db2740aab81c482809a4042>How to Write Jenkinsfiles</a></li><ul><li>1.3.1.1: <a href=#pg-6971fa357af9d063f9640ffefd5beb05>How Jenkins Works</a></li><li>1.3.1.2: <a href=#pg-9869243d0d83c4e5b661966a7578774f>Jenkins Pipelines</a></li><li>1.3.1.3: <a href=#pg-8eb985311f27db5ec418f1717f4e0622>Jenkins Library</a></li><li>1.3.1.4: <a href=#pg-7468762d46626d9a543656cc02eabce8>Jenkins Best Practices</a></li><li>1.3.1.5: <a href=#pg-0f486b9cd450314fe64a457617932115>Annotated Jenkinsfiles - Part 1</a></li><li>1.3.1.6: <a href=#pg-4fc294def0f6cdaa02082959a217ca86>Annotated Jenkinsfiles - Part 2</a></li><li>1.3.1.7: <a href=#pg-ecd6072e7af2bd4a197a1087baeb6c77>Annotated Jenkinsfiles - Part 3</a></li><li>1.3.1.8: <a href=#pg-55c3c60a9f370d11db633ac258e1ebdc>Annotated Jenkinsfiles - Part 4</a></li><li>1.3.1.9: <a href=#pg-e4ae12237c39b5f0feb5a0e7e96b8e95>Annotated Jenkinsfiles - Part 5</a></li><li>1.3.1.10: <a href=#pg-495ca42bdd947744d65cf04377598dfb>Jenkins Recipes and Tips</a></li></ul><li>1.3.2: <a href=#pg-090e63d808738fe249c3bc67d33ff933>How to Write Dockerfiles</a></li><li>1.3.3: <a href=#pg-c004280a8f7cae5b8ff82b147b9cba34>How to Write Docker Compose Files</a></li><li>1.3.4: <a href=#pg-4621b07af9083218e5089816477f1d6d>Saml2Aws Setup</a></li></ul><li>1.4: <a href=#pg-b9067c29ff225f76498ad9ce2b8c0d91>Reference Lists</a></li><ul><li>1.4.1: <a href=#pg-c230d2d89d9e57dde65de7892810c407>Test</a></li><li>1.4.2: <a href=#pg-b0c2b7d40f3fa9fc59273cfbdfee53f8>Web Tools</a></li></ul><li>1.5: <a href=#pg-cf5130bf878cbb73a53d35bbfe95785b>Other Projects</a></li><ul></ul><li>1.6: <a href=#pg-bee86482d428bccb4857fac98ceed2ae>My Documents - Static Site Generation Using Hugo</a></li><li>1.7: <a href=#pg-ea17a438b505000b83a96758c2f7c165>My Documents - Technical Architecture and Documentation Site Implementation</a></li><li>1.8: <a href=#pg-89d09adaad4557c5a3cf18be5dab7166>My Documents - Trigger Reusable Workflow Documentation</a></li></ul></ul><div class=content><div class="pageinfo pageinfo-primary"><p>Welcome to My Documents, a personal collection of notes, guides, and resources on
various topics related to development, testing, and documentation.
This site is organized into several sections, each containing detailed content and
resources to help you explore and learn about different aspects of software
development and documentation.</p></div></div></div><div class=td-content><h1 id=pg-4cdd37113783e47641dd300543c94e1b>1 - Documentation</h1><div class=lead>Comprehensive guides and best practices</div><div class="pageinfo pageinfo-primary"><p>Welcome to the documentation! Browse through guides organized by topic covering Bash scripting,
Docker, Jenkins, and more.</p></div><h2 id=1-browse-documentation>1. Browse Documentation</h2><p>Use the sidebar navigation to explore:</p><ul><li><strong>Bash Scripts</strong> - Best practices for writing efficient Bash scripts</li><li><strong>How-To Guides</strong> - Step-by-step guides for Docker, Jenkins, and other technologies</li><li><strong>Reference Lists</strong> - Curated lists of tools and resources</li><li><strong>Other Projects</strong> - Related documentation sites and tools</li></ul><h2 id=2-getting-started>2. Getting Started</h2><p>Choose a section from the sidebar to begin exploring the documentation. Each section contains
detailed guides, best practices, and real-world examples.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-ea619b912690ef4d28763959e571914b>1.1 - Brainstorming</h1><div class=lead>In-depth brainstorming and analysis of documentation topics and strategies</div><div class="pageinfo pageinfo-primary"><p>This section contains detailed brainstorming and analysis on various documentation topics, strategies,
and technologies.
It serves as a space for exploring ideas, evaluating options, and documenting thought processes related
to the development and maintenance of this documentation site.</p></div><h2 id=1-available-guides>1. Available Guides</h2><ul><li><strong>Static Site Generation Migration Analysis</strong> - Analysis of migrating from Docsify to an SEO-optimized static site generator</li></ul><h2 id=2-getting-started>2. Getting Started</h2><p>Select a guide from the sidebar to begin.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6d62e8a5f4243aec89d15154415c47d2>1.1.1 - Static Site Generation Migration Analysis</h1><div class=lead>Analysis of migrating from Docsify to an SEO-optimized static site generator</div><h1 id=static-site-generator-migration-analysis>Static Site Generator Migration Analysis</h1><p><strong>Date:</strong> 2026-02-17
<strong>Project:</strong> my-documents repository migration and multi-site consolidation
<strong>Goal:</strong> Migrate from Docsify to an SEO-optimized static site generator while maintaining simplicity
and GitHub CI compatibility</p><h2 id=1-executive-summary>1. Executive Summary</h2><p>This document evaluates the current Docsify setup and recommends alternative static site generators
that provide superior SEO performance while maintaining the simplicity and ease of deployment that
made Docsify attractive.</p><p><strong>Current Challenge:</strong> Docsify renders content client-side, which severely limits SEO capabilities
and page load performance. This is critical for a documentation site seeking organic search visibility.</p><h2 id=2-current-solution-analysis-docsify>2. Current Solution Analysis: Docsify</h2><h3 id=21-current-configuration>2.1. Current Configuration</h3><ul><li><strong>Type:</strong> Client-side SPA (Single Page Application)</li><li><strong>Deployment:</strong> Direct to GitHub Pages (no build step)</li><li><strong>Content Format:</strong> Markdown</li><li><strong>Theme:</strong> Simple Dark (customized)</li><li><strong>Search:</strong> Built-in search plugin</li><li><strong>Navigation:</strong> Manual sidebar and navbar configuration</li></ul><h3 id=22-docsify-pros->2.2. Docsify Pros ✅</h3><table><thead><tr><th>Advantage</th><th>Impact</th></tr></thead><tbody><tr><td>Zero build step required</td><td>Instant deployment, minimal CI/CD complexity</td></tr><tr><td>Simple file structure</td><td>Easy to add new documentation files</td></tr><tr><td>No dependencies to manage</td><td>Fewer security concerns, simpler setup</td></tr><tr><td>Client-side rendering</td><td>Works directly with GitHub Pages</td></tr><tr><td>Lightweight theme system</td><td>Easy customization with CSS</td></tr><tr><td>Good for technical audience</td><td>Fast navigation for users familiar with SPAs</td></tr><tr><td>Markdown-first</td><td>Natural for technical documentation</td></tr></tbody></table><h3 id=23-docsify-cons->2.3. Docsify Cons ❌</h3><table><thead><tr><th>Limitation</th><th>Impact</th></tr></thead><tbody><tr><td>Client-side rendering</td><td><strong>Poor SEO</strong> - Search engines struggle to index content</td></tr><tr><td>No static HTML</td><td>No pre-rendered pages for crawlers</td></tr><tr><td>JavaScript dependent</td><td>Requires JS in browser (security consideration)</td></tr><tr><td>Limited meta tags control</td><td>Difficult to optimize individual pages for SEO</td></tr><tr><td>Slow initial page load</td><td>JavaScript bundle must load first</td></tr><tr><td>No built-in sitemap</td><td>Manual sitemap generation needed</td></tr><tr><td>No RSS/feed support</td><td>Hard to distribute content</td></tr><tr><td>Search plugin limitations</td><td>Site search not indexed by external search engines</td></tr><tr><td>No static asset optimization</td><td>All images referenced as relative paths</td></tr><tr><td>Outdated dependency stack</td><td>Uses Vue 2 (Vue 3 available), jQuery, legacy patterns</td></tr></tbody></table><h3 id=24-docsify-seo-score>2.4. Docsify SEO Score</h3><p><strong>Current Estimate: 2/10</strong> ⛔</p><ul><li>❌ No static pre-rendered HTML</li><li>❌ Robot.txt and sitemap not automatically generated</li><li>❌ Limited per-page meta tag control</li><li>❌ No automatic JSON-LD schema generation</li><li>❌ Poor mobile-first Core Web Vitals (JS-heavy)</li><li>⚠️ Possible crawl budget waste</li><li>⚠️ Delayed indexing (content hidden until JS loads)</li></ul><h2 id=3-recommended-migration-path>3. Recommended Migration Path</h2><h3 id=31-phase-1-evaluation-this-phase>3.1. Phase 1: Evaluation (This Phase)</h3><ul><li>Compare alternatives against criteria</li><li>Identify best fit for multi-site architecture</li><li>Plan migration strategy</li></ul><h3 id=32-phase-2-pilot>3.2. Phase 2: Pilot</h3><ul><li>Set up new solution with one repository</li><li>Migrate content and test</li><li>Validate SEO improvements</li></ul><h3 id=33-phase-3-full-migration>3.3. Phase 3: Full Migration</h3><ul><li>Migrate remaining repositories</li><li>Set up CI/CD pipeline</li><li>Monitor performance metrics</li></ul><h3 id=34-phase-4-optimization>3.4. Phase 4: Optimization</h3><ul><li>Fine-tune SEO settings</li><li>Implement analytics</li><li>Monitor search engine indexing</li></ul><h2 id=4-alternative-solutions-comparison>4. Alternative Solutions Comparison</h2><h3 id=41-option-1-hugo--recommended>4.1. Option 1: Hugo ⭐⭐⭐⭐⭐ (RECOMMENDED)</h3><p><strong>Type:</strong> Go-based static site generator
<strong>Build Time:</strong> &lt;1s for most sites
<strong>Theme System:</strong> Flexible with 500+ themes</p><h4 id=411-pros->4.1.1. Pros ✅</h4><ul><li><strong>Extremely fast compilation</strong> - Processes 1000+ pages in milliseconds</li><li><strong>Excellent for documentation</strong> - Purpose-built with documentation sites in mind</li><li><strong>Superior SEO support</strong> - Generates static HTML, sitemaps, feeds, schemas</li><li><strong>Simple setup</strong> - Single binary, no dependency hell</li><li><strong>Markdown + frontmatter</strong> - Natural upgrade from Docsify</li><li><strong>GitHub Actions ready</strong> - Hugo orb/actions available for CI/CD</li><li><strong>Responsive themes</strong> - Many documentation-specific themes (Docsy, Relearn, Book)</li><li><strong>Built-in features</strong> - Search indexes, RSS feeds, JSON-LD support</li><li><strong>Content organization</strong> - Hierarchical content structure with archetypes</li><li><strong>Output optimization</strong> - Image processing, minification, CSS purging</li><li><strong>Flexible routing</strong> - Customize URLs, create custom taxonomies</li><li><strong>Active community</strong> - Large ecosystem, frequent updates</li><li><strong>Multi-language support</strong> - Built-in i18n capability</li></ul><h4 id=412-cons->4.1.2. Cons ❌</h4><ul><li>Learning curve for Go templating (shortcodes, partials)</li><li>Theme customization requires understanding Hugo&rsquo;s page model</li><li>Configuration in TOML/YAML (minor, but different from Docsify)</li><li>Less visual for live preview compared to Docsify</li></ul><h4 id=413-seo-score-910->4.1.3. SEO Score: 9/10 ✅</h4><ul><li>✅ Static HTML pre-rendering</li><li>✅ Automatic sitemap generation</li><li>✅ Per-page meta tags and structured data</li><li>✅ RSS/Atom feeds</li><li>✅ Canonical URLs</li><li>✅ Image optimization</li><li>✅ Performance optimizations (minification, compression)</li><li>⚠️ JSON-LD not automated (requires theme customization)</li></ul><h4 id=414-github-cicd-integration>4.1.4. GitHub CI/CD Integration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># .github/workflows/deploy.yml example</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-hugo@v2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>hugo-version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;latest&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>extended</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>hugo --minify</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.GITHUB_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./public</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=415-migration-effort>4.1.5. Migration Effort</h4><ul><li><strong>Content:</strong> Minimal - Markdown stays same, just add frontmatter</li><li><strong>Structure:</strong> Organize into content sections (easy mapping from Docsify)</li><li><strong>Navigation:</strong> Automatic from directory structure or config</li><li><strong>Customization:</strong> Moderate - Theme customization required</li></ul><h4 id=416-recommended-themes>4.1.6. Recommended Themes</h4><ol><li><strong>Docsy</strong> - Google-created, excellent documentation theme, built-in search</li><li><strong>Relearn</strong> - MkDocs-inspired, sidebar navigation like Docsify</li><li><strong>Book</strong> - Clean, minimal, perfect for tutorials</li><li><strong>Geek Docs</strong> - Modern, fast, developer-friendly</li></ol><h4 id=417-best-for>4.1.7. Best For</h4><p>✅ Technical documentation
✅ Multi-site architecture
✅ SEO-critical sites
✅ GitHub Pages deployment
✅ Content-heavy sites (1000+ pages)</p><hr><h3 id=42-option-2-astro->4.2. Option 2: Astro ⭐⭐⭐⭐</h3><p><strong>Type:</strong> JavaScript/TypeScript-based, island architecture
<strong>Build Time:</strong> &lt;2s typical
<strong>Theme System:</strong> Component-based</p><h4 id=421-pros->4.2.1. Pros ✅</h4><ul><li><strong>Outstanding SEO support</strong> - Static HTML generation, built-in meta tag management</li><li><strong>Zero JavaScript by default</strong> - Only JS needed for interactive components</li><li><strong>Modern stack</strong> - Latest JavaScript patterns, TypeScript support</li><li><strong>Markdown + MDX support</strong> - Markdown with embedded React/Vue components</li><li><strong>Component imports</strong> - Use React, Vue, Svelte components in Markdown</li><li><strong>Fast performance</strong> - Island architecture means minimal JS shipping</li><li><strong>Great for blogs/docs</strong> - Built-in content collections API</li><li><strong>Image optimization</strong> - Automatic image processing and responsive images</li><li><strong>Built-in integrations</strong> - Readily available for analytics, fonts, CSS</li><li><strong>Flexible deployment</strong> - Works with any static host or serverless</li><li><strong>TypeScript first</strong> - Better tooling and IDE support</li><li><strong>Vite-based</strong> - Fast HMR and builds</li></ul><h4 id=422-cons->4.2.2. Cons ❌</h4><ul><li>Newer ecosystem (less battle-tested than Hugo)</li><li>Small learning curve with Astro-specific patterns</li><li>Requires Node.js and npm (dependency management)</li><li>Theme ecosystem smaller than Hugo</li><li>MDX adds complexity if not needed</li></ul><h4 id=423-seo-score-910->4.2.3. SEO Score: 9/10 ✅</h4><ul><li>✅ Static HTML pre-rendering</li><li>✅ Fine-grained meta tag control</li><li>✅ JSON-LD schema support</li><li>✅ Automatic sitemap generation</li><li>✅ RSS/feed support</li><li>✅ Image optimization with AVIF</li><li>✅ Open Graph and Twitter cards</li><li>✅ Performance metrics built-in</li></ul><h4 id=424-github-cicd-integration>4.2.4. GitHub CI/CD Integration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># .github/workflows/deploy.yml example</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm ci</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm run build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.GITHUB_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./dist</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=425-migration-effort>4.2.5. Migration Effort</h4><ul><li><strong>Content:</strong> Minimal - Markdown compatible with optional frontmatter</li><li><strong>Structure:</strong> Convert to Astro collections (straightforward)</li><li><strong>Navigation:</strong> Can use auto-generated from file structure</li><li><strong>Customization:</strong> Moderate - Components offer more flexibility than Hugo</li></ul><h4 id=426-recommended-themestemplates>4.2.6. Recommended Themes/Templates</h4><ol><li><strong>Starlight</strong> - Official Astro docs template, excellent for documentation</li><li><strong>Docs Kit</strong> - Tailored for technical documentation</li><li><strong>Astro Paper</strong> - Blog-focused, highly customizable</li></ol><h4 id=427-best-for>4.2.7. Best For</h4><p>✅ Modern tech stack preference
✅ Need for interactive components
✅ TypeScript-heavy teams
✅ Blogs + Documentation hybrid
✅ SEO + Performance critical</p><hr><h3 id=43-option-3-11ty-eleventy->4.3. Option 3: 11ty (Eleventy) ⭐⭐⭐⭐</h3><p><strong>Type:</strong> JavaScript template engine
<strong>Build Time:</strong> &lt;1s typical
<strong>Theme System:</strong> Template-based</p><h4 id=431-pros->4.3.1. Pros ✅</h4><ul><li><strong>Incredibly flexible</strong> - Supports multiple template languages (Markdown, Nunjucks, Liquid, etc.)</li><li><strong>Lightweight</strong> - Minimal opinion on structure, you decide</li><li><strong>Fast builds</strong> - Blazingly fast incremental builds</li><li><strong>JavaScript-based</strong> - Easier for Node.js teams than Go</li><li><strong>Markdown-first</strong> - Natural Markdown support with plugins</li><li><strong>No locked-in framework</strong> - Use vanilla HTML/CSS or any framework</li><li><strong>Great community</strong> - Excellent documentation and starter projects</li><li><strong>Simple config</strong> - <code>.eleventy.js</code> is readable JavaScript</li><li><strong>Content collections</strong> - Flexible ways to organize content</li><li><strong>Image processing</strong> - Built-in with popular plugins</li><li><strong>GitHub Pages friendly</strong> - Easy integration with GitHub Actions</li><li><strong>Low barrier to entry</strong> - Understand JavaScript, you understand Eleventy</li></ul><h4 id=432-cons->4.3.2. Cons ❌</h4><ul><li>Less opinionated (requires more configuration)</li><li>Smaller pre-built theme ecosystem</li><li>Requires JavaScript knowledge for customization</li><li>No built-in search (needs separate solution)</li><li>Learning curve steeper if unfamiliar with template languages</li></ul><h4 id=433-seo-score-810->4.3.3. SEO Score: 8/10 ✅</h4><ul><li>✅ Static HTML generation</li><li>✅ Manual sitemap generation (simple plugin)</li><li>✅ Per-page meta tag control</li><li>✅ Feed/RSS support (via plugins)</li><li>✅ Image optimization (via plugins)</li><li>⚠️ Schema/JSON-LD (requires custom implementation)</li></ul><h4 id=434-github-cicd-integration>4.3.4. GitHub CI/CD Integration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># .github/workflows/deploy.yml example</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm ci</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm run build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.GITHUB_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./_site</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=435-migration-effort>4.3.5. Migration Effort</h4><ul><li><strong>Content:</strong> Minimal - Markdown files work as-is</li><li><strong>Structure:</strong> Very flexible, custom folder organization</li><li><strong>Navigation:</strong> Can auto-generate from structure or manually configure</li><li><strong>Customization:</strong> High - Maximum control but more work</li></ul><h4 id=436-recommended-starters>4.3.6. Recommended Starters</h4><ol><li><strong>11ty Base Blog</strong> - Simple starting point</li><li><strong>Eleventy High Performance Blog</strong> - Performance-focused</li><li><strong>Slinkity</strong> - Hybrid with component support</li></ol><h4 id=437-best-for>4.3.7. Best For</h4><p>✅ Developers who want full control
✅ Simple, focused documentation
✅ JavaScript/Node.js teams
✅ Performance optimization focus
✅ Unique design requirements</p><hr><h3 id=44-option-4-vuepress-2->4.4. Option 4: VuePress 2 ⭐⭐⭐</h3><p><strong>Type:</strong> Vue 3-based static site generator
<strong>Build Time:</strong> 1-2s typical
<strong>Theme System:</strong> Vue components</p><h4 id=441-pros->4.4.1. Pros ✅</h4><ul><li><strong>Vue ecosystem</strong> - Use Vue components directly in Markdown</li><li><strong>Documentation-first</strong> - Built specifically for docs</li><li><strong>Markdown extensions</strong> - Plugin system for custom Markdown syntax</li><li><strong>Built-in search</strong> - Local search with Algolia option</li><li><strong>Plugin ecosystem</strong> - Rich ecosystem for docs sites</li><li><strong>Good themes</strong> - VuePress Theme Default is solid</li><li><strong>PWA support</strong> - Can work offline (if configured)</li><li><strong>Git history</strong> - Can show last edited time from git</li><li><strong>i18n built-in</strong> - Multi-language support</li><li><strong>Flexible routing</strong> - Customizable URL structure</li></ul><h4 id=442-cons->4.4.2. Cons ❌</h4><ul><li>Vue knowledge required</li><li>Smaller ecosystem than Hugo</li><li>Heavy JavaScript bundle (not as optimized as Astro)</li><li>Less mature than Hugo</li><li>Configuration can be verbose</li><li>Search indexing still client-side primarily</li></ul><h4 id=443-seo-score-610->4.4.3. SEO Score: 6/10 ⚠️</h4><ul><li>✅ Static HTML generation</li><li>✅ Per-page meta tags</li><li>✅ Sitemap support (via plugin)</li><li>⚠️ Search still somewhat client-side</li><li>⚠️ Performance not optimized (Vue overhead)</li><li>⚠️ JSON-LD requires manual setup</li></ul><h4 id=444-github-cicd-integration>4.4.4. GitHub CI/CD Integration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm ci</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm run build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.GITHUB_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./dist</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=445-migration-effort>4.4.5. Migration Effort</h4><ul><li><strong>Content:</strong> Minimal - Markdown compatible</li><li><strong>Structure:</strong> Organized in <code>.vuepress/config.js</code></li><li><strong>Navigation:</strong> Configured in sidebar/navbar config</li><li><strong>Customization:</strong> Moderate - Vue components for complex needs</li></ul><h4 id=446-best-for>4.4.6. Best For</h4><p>✅ Vue-centric teams
✅ Need interactive components
✅ Plugin-heavy customization
✅ Smaller documentation sites
✅ Already using Vue ecosystem</p><hr><h3 id=45-option-5-mkdocs->4.5. Option 5: MkDocs ⭐⭐⭐</h3><p><strong>Type:</strong> Python-based documentation generator
<strong>Build Time:</strong> &lt;1s typical
<strong>Theme System:</strong> Python template-based</p><h4 id=451-pros->4.5.1. Pros ✅</h4><ul><li><strong>Documentation-optimized</strong> - Built by documentation enthusiasts</li><li><strong>Simple configuration</strong> - <code>mkdocs.yml</code> is straightforward</li><li><strong>Markdown-native</strong> - Pure Markdown with extensions</li><li><strong>Great themes</strong> - Material for MkDocs is excellent</li><li><strong>Low overhead</strong> - Minimal learning curve</li><li><strong>Python-based</strong> - Good for Python-heavy teams</li><li><strong>Fast builds</strong> - Quick incremental rebuilds</li><li><strong>Search integration</strong> - Good local search, Algolia-ready</li><li><strong>Git integration</strong> - Edit on GitHub features</li><li><strong>Active community</strong> - Good documentation and examples</li></ul><h4 id=452-cons->4.5.2. Cons ❌</h4><ul><li>Python dependency management</li><li>Smaller ecosystem than Hugo</li><li>Theme customization requires Python knowledge</li><li>Less flexibility than some alternatives</li><li>Setup requires Python environment</li></ul><h4 id=453-seo-score-710->4.5.3. SEO Score: 7/10 ✅</h4><ul><li>✅ Static HTML generation</li><li>✅ Per-page meta tags</li><li>✅ Sitemap support (via plugin)</li><li>⚠️ Schema/JSON-LD minimal</li><li>⚠️ Image optimization requires external tools</li></ul><h4 id=454-github-cicd-integration>4.5.4. GitHub CI/CD Integration</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Set up Python</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>actions/setup-python@v4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>python-version</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;3.11&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>pip install mkdocs mkdocs-material</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>mkdocs build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.GITHUB_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./site</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=455-migration-effort>4.5.5. Migration Effort</h4><ul><li><strong>Content:</strong> Minimal - Markdown files work directly</li><li><strong>Structure:</strong> Configured in <code>mkdocs.yml</code></li><li><strong>Navigation:</strong> Simple hierarchical structure</li><li><strong>Customization:</strong> Easy for theming, harder for core customization</li></ul><h4 id=456-best-for>4.5.6. Best For</h4><p>✅ Documentation-only focus
✅ Python-familiar teams
✅ Minimal configuration needed
✅ Material design preference
✅ Rapid setup priority</p><hr><h3 id=46-option-6-nextjs--vercel->4.6. Option 6: Next.js / Vercel ⭐⭐</h3><p><strong>Type:</strong> React meta-framework
<strong>Build Time:</strong> 5-10s typical
<strong>Theme System:</strong> React components</p><h4 id=461-pros->4.6.1. Pros ✅</h4><ul><li><strong>Powerful frameworks</strong> - React + Node.js backend possibility</li><li><strong>Vercel optimization</strong> - Vercel specialist optimization</li><li><strong>React ecosystem</strong> - Access to millions of components</li><li><strong>SSR capable</strong> - Server-side rendering if needed</li><li><strong>API routes</strong> - Can add serverless functions</li><li><strong>Image optimization</strong> - Automatic image optimization</li><li><strong>Incremental Static Regeneration</strong> - Change content without full rebuild</li><li><strong>TypeScript native</strong> - First-class TypeScript support</li><li><strong>Performance monitoring</strong> - Web vitals built-in</li></ul><h4 id=462-cons->4.6.2. Cons ❌</h4><ul><li><strong>Overkill for static docs</strong> - Too much complexity</li><li><strong>Learning curve steep</strong> - React + Next.js knowledge required</li><li><strong>Build times longer</strong> - Slower than purpose-built SSGs</li><li><strong>More dependencies</strong> - Dependency management complexity</li><li><strong>GitHub Pages less ideal</strong> - Optimized for Vercel deployment</li><li><strong>Maintenance burden</strong> - React team required to maintain</li></ul><h4 id=463-seo-score-810->4.6.3. SEO Score: 8/10 ✅</h4><ul><li>✅ Static generation capability</li><li>✅ Per-page meta tags via next/head</li><li>✅ Sitemap and robots.txt support</li><li>✅ Image optimization</li><li>⚠️ Requires more configuration</li><li>⚠️ Slower builds than dedicated SSGs</li></ul><h4 id=464-github-cicd-integration-docsify-level-complex>4.6.4. GitHub CI/CD Integration (Docsify level: Complex)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Install dependencies</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm ci</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm run build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Static Export</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>npm run export</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v3</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=465-migration-effort>4.6.5. Migration Effort</h4><ul><li><strong>Content:</strong> Moderate - Convert to Next.js structure</li><li><strong>Structure:</strong> Pages directory structure required</li><li><strong>Navigation:</strong> Custom component creation</li><li><strong>Customization:</strong> High complexity</li></ul><h4 id=466-best-for>4.6.6. Best For</h4><p>✅ React-centric teams
✅ Need dynamic functionality
✅ Willing to deploy on Vercel
✅ Complex sites with interactive elements
❌ <strong>NOT recommended for pure documentation</strong></p><hr><h3 id=47-option-7-gatsby->4.7. Option 7: Gatsby ⭐⭐</h3><p><strong>Type:</strong> React-based static site generator
<strong>Build Time:</strong> 10-30s typical
<strong>Theme System:</strong> React components + theme shadowing</p><h4 id=471-pros->4.7.1. Pros ✅</h4><ul><li><strong>Powerful plugin system</strong> - Huge ecosystem</li><li><strong>GraphQL querying</strong> - Flexible content queries</li><li><strong>Performance optimization</strong> - Good performance features</li><li><strong>React components</strong> - Full React power available</li><li><strong>CMS integration</strong> - Works with many headless CMS</li></ul><h4 id=472-cons->4.7.2. Cons ❌</h4><ul><li><strong>Heavy and slow</strong> - Longest build times of alternatives</li><li><strong>High complexity</strong> - Steep learning curve</li><li><strong>Dependency bloat</strong> - Many dependencies to maintain</li><li><strong>Not ideal for docs</strong> - Over-engineered for simple documentation</li><li><strong>GitHub Pages unfriendly</strong> - Best with Netlify</li><li><strong>Overkill</strong> - Too much power for static docs</li></ul><h4 id=473-seo-score-710->4.7.3. SEO Score: 7/10 ✅</h4><ul><li>✅ Static generation</li><li>✅ Good plugin ecosystem for SEO</li><li>⚠️ Heavy JavaScript overhead</li><li>⚠️ Slower builds</li></ul><h4 id=474-best-for>4.7.4. Best For</h4><p>❌ <strong>NOT recommended for documentation migration</strong></p><hr><h2 id=5-comparison-matrix>5. Comparison Matrix</h2><table><thead><tr><th>Criteria</th><th>Hugo</th><th>Astro</th><th>11ty</th><th>VuePress</th><th>MkDocs</th><th>Next.js</th><th>Gatsby</th></tr></thead><tbody><tr><td><strong>SEO Score</strong></td><td>9/10</td><td>9/10</td><td>8/10</td><td>6/10</td><td>7/10</td><td>8/10</td><td>7/10</td></tr><tr><td><strong>Build Speed</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Learning Curve</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐</td><td>⭐</td></tr><tr><td><strong>Customization</strong></td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>GitHub Pages</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Static Output</strong></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td></tr><tr><td><strong>Documentation Focus</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐</td></tr><tr><td><strong>Theme Ecosystem</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>Community Size</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>GitHub Pages Native</strong></td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>✅</td><td>⚠️</td><td>❌</td></tr><tr><td><strong>Multiple Sites</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐</td></tr></tbody></table><h2 id=6-improvements-for-new-solutions>6. Improvements for New Solutions</h2><p>Regardless of which SSG is chosen, implement these SEO improvements:</p><h3 id=61-technical-seo-baseline>6.1. Technical SEO Baseline</h3><ul><li><input disabled type=checkbox> Generate <code>robots.txt</code> automatically</li><li><input disabled type=checkbox> Generate XML sitemap automatically</li><li><input disabled type=checkbox> Implement per-page meta tags (title, description)</li><li><input disabled type=checkbox> Add canonical URLs to prevent duplication</li><li><input disabled type=checkbox> Implement JSON-LD schema (Article, BreadcrumbList, Organization)</li><li><input disabled type=checkbox> Open Graph and Twitter card meta tags</li><li><input disabled type=checkbox> Mobile-first responsive design</li><li><input disabled type=checkbox> Fast page load (Core Web Vitals: LCP, CLS, FID)</li><li><input disabled type=checkbox> Image optimization and lazy loading</li><li><input disabled type=checkbox> Minify and compress assets</li></ul><h3 id=62-content-structure>6.2. Content Structure</h3><ul><li><input disabled type=checkbox> Implement breadcrumb navigation (visual + schema)</li><li><input disabled type=checkbox> Hierarchical heading structure (H1, H2, H3)</li><li><input disabled type=checkbox> Internal linking strategy</li><li><input disabled type=checkbox> Related content suggestions</li><li><input disabled type=checkbox> Table of contents for long articles</li><li><input disabled type=checkbox> Reading time estimates</li><li><input disabled type=checkbox> Last updated timestamps</li></ul><h3 id=63-performance-optimizations>6.3. Performance Optimizations</h3><ul><li><input disabled type=checkbox> Code splitting and lazy loading</li><li><input disabled type=checkbox> Image optimization (WebP, AVIF formats)</li><li><input disabled type=checkbox> CSS/JS minification</li><li><input disabled type=checkbox> Critical CSS inline</li><li><input disabled type=checkbox> Service worker for offline access</li><li><input disabled type=checkbox> Asset caching strategies</li><li><input disabled type=checkbox> Compression (gzip/brotli)</li><li><input disabled type=checkbox> CDN integration</li></ul><h3 id=64-search-and-indexing>6.4. Search and Indexing</h3><ul><li><input disabled type=checkbox> Submit sitemap to Google Search Console</li><li><input disabled type=checkbox> Monitor indexing status</li><li><input disabled type=checkbox> Fix crawl errors</li><li><input disabled type=checkbox> Optimize Core Web Vitals</li><li><input disabled type=checkbox> Monitor search appearance (ratings, rich results)</li><li><input disabled type=checkbox> Use Google Search Console to identify improvements</li></ul><h3 id=65-advanced-seo>6.5. Advanced SEO</h3><ul><li><input disabled type=checkbox> Implement full-text search with ranking</li><li><input disabled type=checkbox> Add RSS/Atom feeds for content discovery</li><li><input disabled type=checkbox> Implement structured data for articles</li><li><input disabled type=checkbox> Add FAQ schema for common questions</li><li><input disabled type=checkbox> Breadcrumb schema implementation</li><li><input disabled type=checkbox> Organization/website schema</li><li><input disabled type=checkbox> Add &ldquo;edit on GitHub&rdquo; links for engagement signals</li></ul><h3 id=66-analytics-and-monitoring>6.6. Analytics and Monitoring</h3><ul><li><input disabled type=checkbox> Google Analytics 4 integration</li><li><input disabled type=checkbox> Search Console monitoring</li><li><input disabled type=checkbox> Core Web Vitals tracking</li><li><input disabled type=checkbox> Error tracking (Sentry/similar)</li><li><input disabled type=checkbox> Performance monitoring dashboard</li><li><input disabled type=checkbox> Keyword ranking tracking</li><li><input disabled type=checkbox> Traffic Analysis</li></ul><h3 id=67-github-cicd-improvements>6.7. GitHub CI/CD Improvements</h3><ul><li><input disabled type=checkbox> Semantic versioning for releases</li><li><input disabled type=checkbox> Link checker in CI pipeline</li><li><input disabled type=checkbox> SEO audit in CI (Lighthouse, lighthouse-ci)</li><li><input disabled type=checkbox> Spell checker (already implemented)</li><li><input disabled type=checkbox> Broken internal link detection</li><li><input disabled type=checkbox> Mobile-first testing</li><li><input disabled type=checkbox> Accessibility testing (a11y)</li><li><input disabled type=checkbox> Build time monitoring</li><li><input disabled type=checkbox> Automated lighthouse reports</li></ul><h2 id=7-hugo-specific-recommendations>7. Hugo-Specific Recommendations</h2><p>If Hugo is chosen (recommended), implement:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># config.yaml example improvements</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Collection of my documents on various subjects&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;bash,best practices,learn,docker,jenkins&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>openGraph</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>twitterCards</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>jsonLD</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>outputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>home</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>HTML</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>JSON</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>RSS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>section</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>HTML</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>JSON</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>RSS</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>taxonomies</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>category</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>categories</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>tag</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>tags</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>mediaTypes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>application/json</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>suffixes</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#000>json</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>outputFormats</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>JSON</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>isPlainText</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>mediaType</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>application/json</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=8-astro-specific-recommendations>8. Astro-Specific Recommendations</h2><p>If Astro is chosen, implement:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-javascript data-lang=javascript><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>// astro.config.mjs example improvements
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>export</span> <span style=color:#204a87;font-weight:700>default</span> <span style=color:#000>defineConfig</span><span style=color:#000;font-weight:700>({</span>
</span></span><span style=display:flex><span>  <span style=color:#000>integrations</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#000>sitemap</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>robotsTxt</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>react</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000>vue</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>image</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>remotePatterns</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[{</span> <span style=color:#000>protocol</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https&#34;</span> <span style=color:#000;font-weight:700>}],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>vite</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>plugins</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000>sitemap</span><span style=color:#000;font-weight:700>(),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>],</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>});</span>
</span></span></code></pre></div><h2 id=9-migration-strategy-for-multiple-sites>9. Migration Strategy for Multiple Sites</h2><h3 id=91-with-hugo-recommended-approach>9.1. With Hugo (Recommended Approach)</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>github-sites-monorepo/
</span></span><span style=display:flex><span>├── myDocuments/
</span></span><span style=display:flex><span>│   ├── content/
</span></span><span style=display:flex><span>│   ├── themes/
</span></span><span style=display:flex><span>│   └── config.yaml
</span></span><span style=display:flex><span>├── bashToolsFramework/
</span></span><span style=display:flex><span>│   ├── content/
</span></span><span style=display:flex><span>│   ├── themes/
</span></span><span style=display:flex><span>│   └── config.yaml
</span></span><span style=display:flex><span>├── bashTools/
</span></span><span style=display:flex><span>│   ├── content/
</span></span><span style=display:flex><span>│   ├── themes/
</span></span><span style=display:flex><span>│   └── config.yaml
</span></span><span style=display:flex><span>└── bashCompiler/
</span></span><span style=display:flex><span>    ├── content/
</span></span><span style=display:flex><span>    ├── themes/
</span></span><span style=display:flex><span>    └── config.yaml
</span></span></code></pre></div><p><strong>CI/CD Strategy:</strong></p><ul><li>Single workflow builds all sites</li><li>Each site has separate output directory</li><li>Deploy to respective GitHub Pages branches</li><li>Shared theme for consistency (git submodule or package)</li><li>Single dependency management file</li></ul><h2 id=10-risk-assessment-and-mitigation>10. Risk Assessment and Mitigation</h2><table><thead><tr><th>Risk</th><th>Hugo</th><th>Astro</th><th>11ty</th><th>MkDocs</th><th>VuePress</th></tr></thead><tbody><tr><td><strong>Breaking changes</strong></td><td>⚠️ Low</td><td>⚠️ Medium</td><td>✅ Low</td><td>✅ Low</td><td>⚠️ Medium</td></tr><tr><td><strong>Ecosystem longevity</strong></td><td>✅ Very High</td><td>⚠️ High</td><td>✅ Very High</td><td>✅ High</td><td>⚠️ Medium</td></tr><tr><td><strong>Theme support</strong></td><td>✅ Excellent</td><td>⚠️ Good</td><td>⚠️ Good</td><td>✅ Good</td><td>⚠️ Good</td></tr><tr><td><strong>GitHub Pages</strong></td><td>✅ Perfect</td><td>✅ Perfect</td><td>✅ Perfect</td><td>✅ Perfect</td><td>⚠️ Works</td></tr><tr><td><strong>Team skills</strong></td><td>⚠️ Go required</td><td>⚠️ JS required</td><td>✅ JS (low level)</td><td>✅ Python/Markdown</td><td>⚠️ Vue required</td></tr><tr><td><strong>Maintenance burden</strong></td><td>✅ Low</td><td>⚠️ Medium</td><td>⚠️ Medium</td><td>✅ Low</td><td>⚠️ Medium</td></tr></tbody></table><h2 id=11-final-recommendation-hugo>11. Final Recommendation: Hugo</h2><h3 id=111-justification>11.1. Justification</h3><ol><li><strong>SEO Excellence</strong> - 9/10 score meets all objectives</li><li><strong>Simplicity</strong> - Single Go binary, no dependency management</li><li><strong>Performance</strong> - &lt;1s builds, scales to thousands of pages</li><li><strong>Documentation-First</strong> - Built for exactly this use case</li><li><strong>GitHub Pages Native</strong> - Zero friction deployment</li><li><strong>Multi-Site Scalability</strong> - Perfect for multiple repositories</li><li><strong>Community</strong> - Largest documentation site generator community</li><li><strong>Proven</strong> - 1000+ major documentation sites use it</li><li><strong>Themes</strong> - Docsy, Relearn excellent for technical docs</li><li><strong>Future-Proof</strong> - Stable, active development</li></ol><h3 id=112-hugo-implementation-plan>11.2. Hugo Implementation Plan</h3><p><strong>Phase 1: Setup (1-2 weeks)</strong></p><ul><li>Install Hugo and select Docsy or Relearn theme</li><li>Create content structure</li><li>Configure SEO baseline</li><li>Set up GitHub Actions workflow</li><li>Test locally</li></ul><p><strong>Phase 2: Migration (2-3 weeks)</strong></p><ul><li>Convert Markdown files (minimal changes)</li><li>Migrate sidebar structure to Hugo config</li><li>Update internal links</li><li>Test all links and navigation</li><li>Performance testing</li></ul><p><strong>Phase 3: SEO Optimization (1-2 weeks)</strong></p><ul><li>Implement schema markup</li><li>Configure sitemaps and feeds</li><li>Submit to Google Search Console</li><li>Baseline performance metrics</li><li>Optimize Core Web Vitals</li></ul><p><strong>Phase 4: Deployment (1 week)</strong></p><ul><li>Validate all tests pass</li><li>Deploy to production</li><li>Monitor indexing and performance</li><li>Gather feedback</li></ul><h2 id=12-alternative-astro-for-modern-setup>12. Alternative: Astro for Modern Setup</h2><p>If your team prefers JavaScript/TypeScript and wants maximum flexibility with modern tooling,
<strong>Astro with Starlight</strong> is the secondary recommendation:</p><ul><li>Excellent SEO (equal to Hugo)</li><li>More flexible for custom components</li><li>Modern JavaScript ecosystem</li><li>Better DX with TypeScript</li><li>Slightly longer build times acceptable</li><li>GitHub Pages deployment straightforward</li></ul><h2 id=13-not-recommended>13. NOT Recommended</h2><ul><li>❌ <strong>Docsify</strong> - Keep for simple internal documentation only, not public sites</li><li>❌ <strong>Next.js</strong> - Overcomplicated for documentation, not ideal for GitHub Pages</li><li>❌ <strong>Gatsby</strong> - Slow builds, high complexity, deprecated</li></ul><h2 id=14-conclusion>14. Conclusion</h2><p>Migrate to <strong>Hugo with Docsy theme</strong> for optimal balance of simplicity, SEO performance, and
documentation focus. This will:</p><ul><li>Improve SEO from 2/10 to 9/10</li><li>Reduce page load times significantly</li><li>Provide static pre-rendered pages for crawlers</li><li>Scale to multiple sites easily</li><li>Maintain simplicity in CI/CD</li><li>Future-proof your documentation infrastructure</li></ul><p><strong>Next Steps:</strong></p><ol><li>Review this analysis with relevant stakeholders</li><li>Set up pilot Hugo site with one repository</li><li>Validate SEO improvements with Search Console</li><li>Plan full migration timeline</li><li>Document Hugo best practices for team</li></ol></div><div class=td-content style=page-break-before:always><h1 id=pg-56d2ab02e267eeddf83eefa58f6669e5>1.2 - Bash Scripts</h1><div class=lead>Best practices for writing Bash scripts</div><div class="pageinfo pageinfo-primary"><p>Learn how to write efficient, maintainable, and robust Bash scripts with these comprehensive
guides covering basic practices, Linux commands, and testing.</p></div><h2 id=1-what-youll-learn>1. What You&rsquo;ll Learn</h2><p>This section covers:</p><ul><li><strong>Basic Best Practices</strong> - Foundational best practices for writing Bash scripts</li><li><strong>Linux Commands Best Practices</strong> - Effective use of Linux commands in scripts</li><li><strong>Bats Testing Framework</strong> - Testing Bash scripts with the Bats framework</li></ul><h2 id=2-getting-started>2. Getting Started</h2><p>Choose a topic from the sidebar to begin learning about Bash scripting best practices.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ef26c14a02482638bf4859504252d1d>1.2.1 - Basic Best Practices</h1><div class=lead>Foundational best practices for writing Bash scripts</div><ul><li><a href=#1-external-references>1. External references</a></li><li><a href=#2-general-best-practices>2. General best practices</a></li><li><a href=#3-escape-quotes>3. escape quotes</a></li><li><a href=#4-bash-environment-options>4. Bash environment options</a><ul><li><a href=#41-errexit-set--e--set--o-errexit>4.1. errexit (set -e | set -o errexit)</a><ul><li><a href=#411-caveats-with-command-substitution>4.1.1. Caveats with command substitution</a></li><li><a href=#412-caveats-with-process-substitution>4.1.2. Caveats with process substitution</a></li><li><a href=#413-process-substitution-is-asynchronous>4.1.3. Process substitution is asynchronous</a></li></ul></li><li><a href=#42-pipefail-set--o-pipefail>4.2. pipefail (set -o pipefail)</a></li><li><a href=#43-errtrace-set--e--set--o-errtrace>4.3. errtrace (set -E | set -o errtrace)</a></li><li><a href=#44-nounset-set--u--set--o-nounset>4.4. nounset (set -u | set -o nounset)</a></li><li><a href=#45-inherit-error-exit-code-in-sub-shells>4.5. inherit error exit code in sub shells</a></li><li><a href=#46-posix-set--o-posix>4.6. posix (set -o posix)</a></li></ul></li><li><a href=#5-main-function>5. Main function</a></li><li><a href=#6-arguments>6. Arguments</a></li><li><a href=#7-some-commands-default-options-to-use>7. some commands default options to use</a></li><li><a href=#8-variables>8. Variables</a><ul><li><a href=#81-variable-declaration>8.1. Variable declaration</a></li><li><a href=#82-variable-naming-convention>8.2. variable naming convention</a></li><li><a href=#83-variable-expansion>8.3. Variable expansion</a><ul><li><a href=#831-examples>8.3.1. Examples</a></li></ul></li><li><a href=#84-check-if-a-variable-is-defined>8.4. Check if a variable is defined</a></li><li><a href=#85-variable-default-value>8.5. Variable default value</a></li><li><a href=#86-passing-variable-by-reference-to-function>8.6. Passing variable by reference to function</a><ul><li><a href=#861-example-1>8.6.1. Example 1</a></li><li><a href=#862-example-2>8.6.2. Example 2</a></li></ul></li></ul></li><li><a href=#9-capture-output>9. Capture output</a><ul><li><a href=#91-capture-output-and-test-result>9.1. Capture output and test result</a></li><li><a href=#92-capture-output-and-retrieve-status-code>9.2. Capture output and retrieve status code</a></li></ul></li><li><a href=#10-array>10. Array</a></li><li><a href=#11-temporary-directory>11. Temporary directory</a></li><li><a href=#12-traps>12. Traps</a></li><li><a href=#13-deal-with-sigpipe---exit-code-141>13. Deal with SIGPIPE - exit code 141</a></li><li><a href=#14-performances-analysis>14. Performances analysis</a></li><li><a href=#15-bash-performance-tips>15. Bash Performance tips</a><ul><li><a href=#151-arraywrap2-performance-improvement>15.1. Array::wrap2 performance improvement</a></li></ul></li></ul><h2 id=1-external-references>1. External references</h2><ul><li><a href="https://github.com/dylanaraps/pure-bash-bible?tab=readme-ov-file">pure bash bible</a></li><li><a href="https://github.com/dylanaraps/pure-sh-bible?tab=readme-ov-file">pure sh(posix) bible</a></li></ul><h2 id=2-general-best-practices>2. General best practices</h2><ul><li><p><code>cat &lt;&lt; 'EOF'</code> avoid to interpolate variables</p></li><li><p>use <code>builtin cd</code> instead of <code>cd</code>, <code>builtin pwd</code> instead of <code>pwd</code>, &mldr; to avoid using customized aliased commands by
the user In this framework, I added the command <code>unalias -a || true</code> to remove all eventual aliases and also ensure to
disable aliases expansion by using <code>shopt -u expand_aliases</code>. Because aliases have a very special way to load. In a
script file changing an alias doesn&rsquo;t occur immediately, it depends if script evaluated has been parsed yet or not.
And alias changed in a function, will be applied outside of the function. But I experienced some trouble with this
last rule, so I give up using aliases.</p></li><li><p>use the right shebang, avoid <code>#!/bin/bash</code> as bash binary could be in another folder (especially on alpine), use this
instead <code>#!/usr/bin/env bash</code></p></li><li><p>prefer to use printf vs echo</p></li><li><p>avoid global variables whenever possible, prefer using local</p><ul><li>check that every lowercase variable is used as local in functions<ul><li><a href=https://github.com/bats-core/bats-core/issues/726>https://github.com/bats-core/bats-core/issues/726</a></li><li><a href=https://github.com/koalaman/shellcheck/issues/1395>https://github.com/koalaman/shellcheck/issues/1395</a></li><li><a href=https://github.com/koalaman/shellcheck/issues/468>https://github.com/koalaman/shellcheck/issues/468</a></li></ul></li></ul></li><li><p>avoid to export variables whenever possible</p></li></ul><h2 id=3-escape-quotes>3. escape quotes</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>help</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;quiet mode, doesn&#39;</span><span style=color:#4e9a06>\&#39;</span><span style=color:#4e9a06>&#39;t display any output&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># alternative</span>
</span></span><span style=display:flex><span><span style=color:#000>help</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;quiet mode, doesn&#39;t display any output&#34;</span>
</span></span></code></pre></div><h2 id=4-bash-environment-options>4. Bash environment options</h2><p>See <a href=https://www.gnu.org/software/bash/manual/html_node/The-Set-Builtin.html>Set bash builtin documentation</a></p><p>This framework uses these mode by default:</p><ul><li>errexit</li><li>pipefail</li><li>errtrace</li></ul><h3 id=41-errexit-set--e--set--o-errexit>4.1. errexit (set -e | set -o errexit)</h3><p>Check official doc but it can be summarized like this:</p><blockquote><p>Exit immediately command returns a non-zero status.</p></blockquote><p>I was considering this as a best practice because every non controlled command failure will stop your program. But
actually</p><ul><li>sometimes you need or expect a command to fail</li></ul><p><strong>Eg1</strong>: delete a folder that actually doesn&rsquo;t exists. Use <code>|| true</code> to ignore the error.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>rm -Rf folder <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span></code></pre></div><p><strong>Eg2</strong>: a command that expects to fail if conditions are not met. Using <code>if</code> will not stop the program on non-zero exit
code.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>if</span> git diff-index --quiet HEAD --<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  Log::displayInfo <span style=color:#4e9a06>&#34;Pull git repository &#39;</span><span style=color:#4e9a06>${</span><span style=color:#000>dir</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39; as no changes detected&#34;</span>
</span></span><span style=display:flex><span>  git pull --progress
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>else</span>
</span></span><span style=display:flex><span>  Log::displayWarning <span style=color:#4e9a06>&#34;Pulling git repository &#39;</span><span style=color:#4e9a06>${</span><span style=color:#000>dir</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39; avoided as changes detected&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><ul><li><p>actually this feature is not well implemented everywhere</p><ul><li>sometimes some commands that should fail doesn&rsquo;t fail</li><li>the feature is not homogeneous across implementations</li><li>some commands expects to have non zero exit code</li><li>some commands exits with non zero error code but does not necessarily needs the program to exit</li></ul></li><li><p>Finally it is preferable to check every command status code manually instead of relying to an automatic management.</p></li></ul><h4 id=411-caveats-with-command-substitution>4.1.1. Caveats with command substitution</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#204a87>set</span> -o errexit
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>exit</span> 1<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#000>$?</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div><p>it is because echo has succeeded. the same result occurs even with <code>shopt -s inherit_errexit</code> (see below).</p><p>The <strong>best practice</strong> is to always assign command substitution to variable:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#204a87>set</span> -o errexit
</span></span><span style=display:flex><span><span style=color:#204a87>declare</span> cmdOut
</span></span><span style=display:flex><span><span style=color:#000>cmdOut</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>exit</span> 1<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>cmdOut</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#000>$?</span>
</span></span></code></pre></div><p>Outputs nothing because the script stopped before variable affectation, return code is 1.</p><h4 id=412-caveats-with-process-substitution>4.1.2. Caveats with process substitution</h4><p>Consider this example that reads each line of the output of the command passed using process substitution in <code>&lt;(...)</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>parse<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>scriptFile</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$1</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> implementDirective
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000>IFS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&#39;</span> <span style=color:#204a87>read</span> -r implementDirective<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>implementDirective</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>done</span> &lt; &lt;<span style=color:#ce5c00;font-weight:700>(</span>grep -E -e <span style=color:#4e9a06>&#34;^# IMPLEMENT .*</span>$<span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>scriptFile</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>If we execute this command with a non existent file, even if errexit, pipefail and inherit_errexit are set, the command
will actually succeed.</p><p>It is because process substitution launch the command as as separated process. I didn&rsquo;t find any clean way to manage
this using process substitution (only workaround I found was to pass by file to pass the exit code to parent process).</p><p>So here the solution removing process substitution</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>parse<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>scriptFile</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$1</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> implementDirective
</span></span><span style=display:flex><span>  grep -E -e <span style=color:#4e9a06>&#34;^# IMPLEMENT .*</span>$<span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>scriptFile</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000>IFS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&#39;</span> <span style=color:#204a87>read</span> -r implementDirective<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>implementDirective</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>But how to use readarray without using process substitution. Old code was:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>declare</span> -a interfacesFunctions
</span></span><span style=display:flex><span>readarray -t interfacesFunctions &lt; &lt;<span style=color:#ce5c00;font-weight:700>(</span>Compiler::Implement::mergeInterfacesFunctions <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>Compiler::Implement::validateInterfaceFunctions <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>INPUT_FILE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>interfacesFunctions</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p>I first think about doing this</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>declare</span> -a interfacesFunctions
</span></span><span style=display:flex><span>Compiler::Implement::mergeInterfacesFunctions <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> readarray -t interfacesFunctions
</span></span></code></pre></div><p>But interfacesFunctions was empty because readarray is run in another process, to avoid this issue, I could have used
<code>shopt -s lastpipe</code></p><p>But I finally transformed it to (the array in the same sub-shell so no issue):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>Compiler::Implement::mergeInterfacesFunctions <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>declare</span> -a interfacesFunctions
</span></span><span style=display:flex><span>  readarray -t interfacesFunctions
</span></span><span style=display:flex><span>  Compiler::Implement::validateInterfaceFunctions <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>INPUT_FILE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>interfacesFunctions</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>The issue with this previous solution is that commands runs in a sub-shell but using <code>shopt -s lastpipe</code> could solve this
issue.</p><p>Another solution would be to simply read the array from stdin:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>declare</span> -a interfacesFunctions
</span></span><span style=display:flex><span>readarray -t interfacesFunctions <span style=color:#ce5c00;font-weight:700>&lt;&lt;&lt;</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>
</span></span><span style=display:flex><span>  Compiler::Implement::mergeInterfacesFunctions <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>Compiler::Implement::validateInterfaceFunctions <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>COMPILED_FILE2</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>INPUT_FILE</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>interfacesFunctions</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h4 id=413-process-substitution-is-asynchronous>4.1.3. Process substitution is asynchronous</h4><p>it is why you cannot retrieve the status code, a way to do that is to wait the process to finish</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>while</span> <span style=color:#204a87>read</span> -r line<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$line</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>done</span> &lt; &lt;<span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  sleep <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>  sleep <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>77</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>could be rewritten in</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>mapfile -t lines &lt; &lt;<span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  sleep <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#0000cf;font-weight:700>2</span>
</span></span><span style=display:flex><span>  sleep <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>77</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>wait</span> <span style=color:#000>$!</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>for</span> line in <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>lines</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>do</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$line</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>&amp;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>done</span>
</span></span><span style=display:flex><span>sleep <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#204a87>wait</span> <span style=color:#000>$!</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#204a87;font-weight:700>done</span>
</span></span></code></pre></div><h3 id=42-pipefail-set--o-pipefail>4.2. pipefail (set -o pipefail)</h3><p><a href=https://dougrichardson.us/notes/fail-fast-bash-scripting.html>https://dougrichardson.us/notes/fail-fast-bash-scripting.html</a></p><blockquote><p>If set, the return value of a pipeline is the value of the last (rightmost) command to exit with a non-zero status, or
zero if all commands in the pipeline exit successfully. This option is disabled by default.</p></blockquote><p>It is complementary with errexit, as if it not activated, the failure of command in pipe could hide the error.</p><p><strong>Eg</strong>: without <code>pipefail</code> this command succeed</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#204a87>set</span> -o errexit
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> +o pipefail <span style=color:#8f5902;font-style:italic># deactivate pipefail mode</span>
</span></span><span style=display:flex><span>foo <span style=color:#000;font-weight:700>|</span> <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;a&#34;</span>  <span style=color:#8f5902;font-style:italic># &#39;foo&#39; is a non-existing command</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Output:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># a</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># bash: foo: command not found</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># echo $? # exit code is 0</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># 0</span>
</span></span></code></pre></div><h3 id=43-errtrace-set--e--set--o-errtrace>4.3. errtrace (set -E | set -o errtrace)</h3><p><a href=https://dougrichardson.us/notes/fail-fast-bash-scripting.html>https://dougrichardson.us/notes/fail-fast-bash-scripting.html</a></p><blockquote><p>If set, any trap on ERR is inherited by shell functions, command substitutions, and commands executed in a subShell
environment. The ERR trap is normally not inherited in such cases.</p></blockquote><h3 id=44-nounset-set--u--set--o-nounset>4.4. nounset (set -u | set -o nounset)</h3><p><a href=https://dougrichardson.us/notes/fail-fast-bash-scripting.html>https://dougrichardson.us/notes/fail-fast-bash-scripting.html</a></p><blockquote><p>Treat unset variables and parameters other than the special parameters ‘@’ or ‘<em>’, or array variables subscripted with
‘@’ or ‘</em>’, as an error when performing parameter expansion. An error message will be written to the standard error,
and a non-interactive shell will exit.</p></blockquote><h3 id=45-inherit-error-exit-code-in-sub-shells>4.5. inherit error exit code in sub shells</h3><p><a href=https://dougrichardson.us/notes/fail-fast-bash-scripting.html>https://dougrichardson.us/notes/fail-fast-bash-scripting.html</a></p><p>let&rsquo;s see why using <code>shopt -s inherit_errexit</code> ?</p><p>set -e does not affect subShells created by Command Substitution. This rule is stated in Command Execution Environment:</p><blockquote><p>subShells spawned to execute command substitutions inherit the value of the -e option from the parent shell. When not
in POSIX mode, Bash clears the -e option in such subShells.</p></blockquote><p>This rule means that the following script will run to completion, in spite of INVALID_COMMAND.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># command-substitution.sh</span>
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span><span style=color:#000>MY_VAR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> -n Start
</span></span><span style=display:flex><span>  INVALID_COMMAND
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> -n End
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;MY_VAR is </span><span style=color:#000>$MY_VAR</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>./command-substitution.sh: line 4: INVALID_COMMAND: <span style=color:#204a87>command</span> not found
</span></span><span style=display:flex><span>MY_VAR is StartEnd
</span></span></code></pre></div><p><code>shopt -s inherit_errexit</code>, added in Bash 4.4 allows you to have command substitution parameters inherit your set -e
from the parent script.</p><p>From the Shopt Builtin documentation:</p><blockquote><p>If set, command substitution inherits the value of the errexit option, instead of unsetting it in the subShell
environment. This option is enabled when POSIX mode is enabled.</p></blockquote><p>So, modifying command-substitution.sh above, we get:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># command-substitution-inherit_errexit.sh</span>
</span></span><span style=display:flex><span><span style=color:#204a87>set</span> -e
</span></span><span style=display:flex><span><span style=color:#204a87>shopt</span> -s inherit_errexit
</span></span><span style=display:flex><span><span style=color:#000>MY_VAR</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> -n Start
</span></span><span style=display:flex><span>  INVALID_COMMAND
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> -n End
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;MY_VAR is </span><span style=color:#000>$MY_VAR</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>./command-substitution-inherit_errexit.sh: line 5: INVALID_COMMAND: <span style=color:#204a87>command</span> not found
</span></span></code></pre></div><h3 id=46-posix-set--o-posix>4.6. posix (set -o posix)</h3><blockquote><p>Change the behavior of Bash where the default operation differs from the POSIX standard to match the standard (see
<a href=https://www.gnu.org/software/bash/manual/html_node/Bash-POSIX-Mode.html>Bash POSIX Mode</a>). This is intended to make
Bash behave as a strict superset of that standard.</p></blockquote><h2 id=5-main-function>5. Main function</h2><p>An important best practice is to always encapsulate all your script inside a main function. One reason for this
technique is to make sure the script does not accidentally do anything nasty in the case where the script is truncated.
I often had this issue because when I change some of my bash framework functions, the pre-commit runs buildBinFiles
command that can be recompiled itself. In this case the script fails.</p><p><a href=https://unix.stackexchange.com/a/537397>another reason for doing this</a> is to not execute the file at all if there is a
syntax error.</p><p>Additionally you can add a snippet in order to avoid your function to be executed in the case where it is being source.
The following code will execute main function if called as a script passing arguments, or will just import the main
function if the script is sourced. See <a href=https://stackoverflow.com/a/47613477>this stack overflow for more details</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env bash
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>main<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># main script</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>set</span> -eo pipefail
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>BASH_SOURCE</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;.</span><span style=color:#000>$0</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;.</span><span style=color:#000>$0</span><span style=color:#4e9a06>&#34;</span> !<span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;.</span><span style=color:#000>$BASH_SOURCE</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span> <span style=color:#ce5c00;font-weight:700>||</span> main <span style=color:#4e9a06>&#34;</span><span style=color:#000>$@</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h2 id=6-arguments>6. Arguments</h2><ul><li>to construct complex command line, prefer to use an array<ul><li><code>declare -a cmd=(git push origin :${branch})</code></li><li>then you can display the result using echo <code>"${cmd[*]}"</code></li><li>you can execute the command using <code>"${cmd[@]}"</code></li></ul></li><li>boolean arguments, to avoid seeing some calls like this <code>myFunction 0 1 0</code> with 3 boolean values. prefer to provide
constants(using readonly) to make the call more clear like <code>myFunction arg1False arg2True arg3False</code> of course
replacing argX with the real argument name. Eg: <code>Filters::directive "${FILTER_DIRECTIVE_REMOVE_HEADERS}"</code> You have to
prefix all your constants to avoid conflicts.</li><li>instead of adding a new arg to the function with a default value, consider using an env variable that can be easily
overridden before calling the function. Eg: <code>SUDO=sudo Github::upgradeRelease ...</code> It avoids to have to pass previous
arguments that were potentially defaulted.</li></ul><h2 id=7-some-commands-default-options-to-use>7. some commands default options to use</h2><p><a href=/HowTo/HowTo-Write-Bash-Scripts/10-LinuxCommands-BestPractices.md>Check out 10-LinuxCommands-BestPractices.md</a></p><h2 id=8-variables>8. Variables</h2><h3 id=81-variable-declaration>8.1. Variable declaration</h3><ul><li>ensure we don&rsquo;t have any globals, all variables should be passed to the functions</li><li>declare all variables as local in functions to avoid making them global</li><li>local or declare multiple local a z</li><li><code>export readonly</code> does not work, first <code>readonly</code> then <code>export</code></li><li>avoid using export most of the times, export is needed only when variables has to be passed to child process.</li></ul><h3 id=82-variable-naming-convention>8.2. variable naming convention</h3><ul><li>env variable that aims to be exported should be capitalized with underscore</li><li>local variables should conform to camelCase</li></ul><h3 id=83-variable-expansion>8.3. Variable expansion</h3><p><a href=https://www.gnu.org/software/bash/manual/html_node/Shell-Parameter-Expansion.html>Shell Parameter Expansion</a></p><p><code>${PARAMETER:-WORD}</code> vs <code>${PARAMETER-WORD}</code>:</p><p>If the parameter PARAMETER is unset (was never defined) or null (empty), <code>${PARAMETER:-WORD}</code> expands to WORD, otherwise
it expands to the value of PARAMETER, as if it just was ${PARAMETER}.</p><p>If you omit the <code>:</code>(colon) like in <code>${PARAMETER-WORD}</code>, the default value is only used when the parameter is unset, not
when it was empty.</p><blockquote><p>:warning: use this latter syntax when using function arguments in order to be able to reset a value to empty string,
otherwise default value would be applied.</p></blockquote><h4 id=831-examples>8.3.1. Examples</h4><p>Extract directory from full file path: <code>directory="${REAL_SCRIPT_FILE%/*}"</code></p><p>Extract file name from full file path: <code>fileName="${REAL_SCRIPT_FILE##*/}"</code></p><h3 id=84-check-if-a-variable-is-defined>8.4. Check if a variable is defined</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> -z <span style=color:#4e9a06>${</span><span style=color:#000>varName</span><span style=color:#000;font-weight:700>+xxx</span><span style=color:#4e9a06>}</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># varName is not set</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fi</span>
</span></span></code></pre></div><p>Alternatively you can use this framework function <code>Assert::varExistsAndNotEmpty</code></p><h3 id=85-variable-default-value>8.5. Variable default value</h3><p>Always consider to set a default value to the variable that you are using.</p><p><strong>Eg.</strong>: Let&rsquo;s see this dangerous example</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Don&#39;t Do that !!!!</span>
</span></span><span style=display:flex><span>rm -Rf <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/etc&#34;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span></code></pre></div><p>This could end very badly if your script runs as root and if <code>${TMPDIR}</code> is not set, this script will result to do a
<code>rm -Rf /etc</code></p><p>Instead you can do that</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>rm -Rf <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000;font-weight:700>/tmp</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/etc&#34;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span></code></pre></div><h3 id=86-passing-variable-by-reference-to-function>8.6. Passing variable by reference to function</h3><p>Always &ldquo;scope&rdquo; variables passed by reference. Scoping in bash means to find a name that is a low probability that the
caller of the method names the parameter with the same name as in the function.</p><h4 id=861-example-1>8.6.1. Example 1</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>Array::setArray<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -n <span style=color:#000>arr</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>IFS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span> -
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># set no glob feature</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>set</span> -f
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># shellcheck disable=SC2206,SC2034</span>
</span></span><span style=display:flex><span>  <span style=color:#000>arr</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#000>$3</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Array::setArray arr , <span style=color:#4e9a06>&#34;1,2,3,&#34;</span>
</span></span></code></pre></div><p>this example results to the following error messages</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>bash: local: warning: arr: circular name reference
</span></span><span style=display:flex><span>bash: warning: arr: circular name reference
</span></span><span style=display:flex><span>bash: warning: arr: circular name reference
</span></span></code></pre></div><p>Tis example should be fixed by renaming local arr to a more &ldquo;scoped&rdquo; name.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>Array::setArray<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -n <span style=color:#000>setArray_array</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>IFS</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span> -
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># set no glob feature</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>set</span> -f
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># shellcheck disable=SC2206,SC2034</span>
</span></span><span style=display:flex><span>  <span style=color:#000>setArray_array</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#000>$3</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Array::setArray arr , <span style=color:#4e9a06>&#34;1,2,3,&#34;</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># declare -p arr</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># # output: declare -a arr=([0]=&#34;1&#34; [1]=&#34;2&#34; [2]=&#34;3&#34;)</span>
</span></span></code></pre></div><h4 id=862-example-2>8.6.2. Example 2</h4><p>A more tricky example, here the references array is affected to local array, this local array has a conflicting name.
This example does not produce any error messages.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>Postman::Model::getValidCollectionRefs<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>configFile</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$1</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -n <span style=color:#000>getValidCollectionRefs</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>shift</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -a <span style=color:#000>refs</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$@</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># ...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getValidCollectionRefs</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>refs</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>local</span> -a refs
</span></span><span style=display:flex><span>Postman::Model::getValidCollectionRefs <span style=color:#4e9a06>&#34;file&#34;</span> refs a b c
</span></span><span style=display:flex><span><span style=color:#204a87>declare</span> -p refs <span style=color:#8f5902;font-style:italic># =&gt; declare -a refs</span>
</span></span></code></pre></div><p>In Previous example, getValidCollectionRefs is well &ldquo;scoped&rdquo; but there is a conflict with the local refs array inside
the function resulting in affectation not working. The correct way to do it is to scope also the variables affected to
referenced variables</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>Postman::Model::getValidCollectionRefs<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>configFile</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$1</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -n <span style=color:#000>getValidCollectionRefsResult</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$2</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>shift</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> -a <span style=color:#000>getValidCollectionRefsSelection</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#4e9a06>&#34;</span><span style=color:#000>$@</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># ...</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getValidCollectionRefsResult</span><span style=color:#ce5c00;font-weight:700>=(</span><span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>getValidCollectionRefsSelection</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87>local</span> -a refs
</span></span><span style=display:flex><span>Postman::Model::getValidCollectionRefs <span style=color:#4e9a06>&#34;file&#34;</span> refs a b c
</span></span><span style=display:flex><span><span style=color:#204a87>declare</span> -p refs <span style=color:#8f5902;font-style:italic># =&gt; declare -a refs=([0]=&#34;a&#34; [1]=&#34;b&#34; [2]=&#34;c&#34;)</span>
</span></span></code></pre></div><h2 id=9-capture-output>9. Capture output</h2><p>You can use
<a href=https://www.gnu.org/savannah-checkouts/gnu/bash/manual/bash.html#Command-Substitution>command substitution</a>.</p><p>Eg:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>local</span> output
</span></span><span style=display:flex><span><span style=color:#000>output</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>functionThatOutputSomething <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>arg1</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h3 id=91-capture-output-and-test-result>9.1. Capture output and test result</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>local</span> output
</span></span><span style=display:flex><span><span style=color:#000>output</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span>functionThatOutputSomething <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>arg1</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;error&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=92-capture-output-and-retrieve-status-code>9.2. Capture output and retrieve status code</h3><p>It&rsquo;s advised to put it on the same line using <code>;</code>. If it was on 2 lines, other commands could be put between the command
and the status code retrieval, the status would not be the same command status.</p><p><img src=example1.sh alt="Capture output and retrieve status code example"></p><h2 id=10-array>10. Array</h2><ul><li>read each line of a file to an array <code>readarray -t var &lt; /path/to/filename</code></li></ul><h2 id=11-temporary-directory>11. Temporary directory</h2><p>use <code>${TMPDIR:-/tmp}</code>, TMPDIR variable does not always exist. or when mktemp is available, use
<code>dirname $(mktemp -u --tmpdir)</code></p><p>The variable TMPDIR is initialized in <code>src/_includes/_commonHeader.sh</code> used by all the binaries used in this framework.</p><h2 id=12-traps>12. Traps</h2><p>when trapping EXIT do not forget to throw back same exit code otherwise exit code of last command executed in the trap
is thrown</p><p>In this example rc variable contains the original exit code</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>cleanOnExit<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>local</span> <span style=color:#000>rc</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$?</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>[[</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>KEEP_TEMP_FILES</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000>0</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;1&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    Log::displayInfo <span style=color:#4e9a06>&#34;KEEP_TEMP_FILES=1 temp files kept here &#39;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#ce5c00;font-weight:700>[[</span> -n <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#000;font-weight:700>+xxx</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#ce5c00;font-weight:700>]]</span><span style=color:#000;font-weight:700>;</span> <span style=color:#204a87;font-weight:700>then</span>
</span></span><span style=display:flex><span>    Log::displayDebug <span style=color:#4e9a06>&#34;KEEP_TEMP_FILES=0 removing temp files &#39;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;&#34;</span>
</span></span><span style=display:flex><span>    rm -Rf <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>TMPDIR</span><span style=color:#204a87;font-weight:700>:-</span><span style=color:#000;font-weight:700>/tmp/fake</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> &gt;/dev/null 2&gt;<span style=color:#000;font-weight:700>&amp;</span><span style=color:#0000cf;font-weight:700>1</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>fi</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>exit</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>rc</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87>trap</span> cleanOnExit EXIT HUP QUIT ABRT TERM
</span></span></code></pre></div><h2 id=13-deal-with-sigpipe---exit-code-141>13. Deal with SIGPIPE - exit code 141</h2><p><a href=https://stackoverflow.com/questions/19120263/why-exit-code-141-with-grep-q>related stackoverflow post</a></p><p><code>set -o pipefail</code> makes exit code 141 being sent in some cases</p><p>Eg: with grep</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>bin/postmanCli --help <span style=color:#000;font-weight:700>|</span> grep -q DESCRIPTION
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#000>$?</span><span style=color:#4e9a06> </span><span style=color:#4e9a06>${</span><span style=color:#000>PIPESTATUS</span><span style=color:#000;font-weight:700>[@]</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p>This is because grep -q exits immediately with a zero status as soon as a match is found. The zfs command is still
writing to the pipe, but there is no reader (because grep has exited), so it is sent a SIGPIPE signal from the kernel
and it exits with a status of 141.</p><p>Eg: or with head</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>longMultilineString</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span> <span style=color:#000;font-weight:700>|</span> head -n <span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><p>Finally I found this elegant <a href=https://unix.stackexchange.com/a/709880/582856>stackoverflow solution</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>handle_pipefail<span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># ignore exit code 141 from simple command pipes</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic># - use with: cmd1 | cmd2 || handle_pipefail $?</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>((</span><span style=color:#000>$1</span> <span style=color:#ce5c00;font-weight:700>==</span> 141<span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>$1</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># then use it or test it as:</span>
</span></span><span style=display:flex><span>yes <span style=color:#000;font-weight:700>|</span> head -n <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#ce5c00;font-weight:700>||</span> handle_pipefail <span style=color:#000>$?</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;ec=</span><span style=color:#000>$?</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><p>I added <code>handle_pipefail</code> as <code>Bash::handlePipelineFailure</code> in bash-tools-framework.</p><h2 id=14-performances-analysis>14. Performances analysis</h2><p>generate a csv file with milliseconds measures</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>codeToMeasureStart</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>date +%s%3N<span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># ... the code to measure</span>
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> &gt;<span style=color:#000;font-weight:700>&amp;</span><span style=color:#0000cf;font-weight:700>2</span> <span style=color:#4e9a06>&#34;printCurrentLine;</span><span style=color:#204a87;font-weight:700>$(($(</span>date +%s%3N<span style=color:#204a87;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>-</span> codeToMeasureStart<span style=color:#204a87;font-weight:700>))</span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h2 id=15-bash-performance-tips>15. Bash Performance tips</h2><h3 id=151-arraywrap2-performance-improvement>15.1. Array::wrap2 performance improvement</h3><p><a href=https://github.com/fchastanet/bash-tools-framework/commit/2f52d3af27170b7fff5284b5ad2793ae58af21e1>Commit with performance improvement</a></p><p>manualTests/Array::wrap2Perf.sh:</p><ul><li>displaying 12 lines (558 characters) 100 times</li><li>passed from ~10s to &lt;1s (improved by 90%)</li></ul><p>performance improvement using:</p><ul><li>echo instead of string concatenation</li><li>string substitution instead of calling sed on each element</li><li>echo -e removed the need to do a loop on each character to parse ansi code and the need of Filters::removeAnsiCodes</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-95d2544e96fb3b262007c120f8333ac8>1.2.2 - Linux Commands Best Practices</h1><div class=lead>Best practices for using Linux commands in Bash scripts</div><ul><li><a href=#1-some-commands-default-options-to-use>1. some commands default options to use</a></li><li><a href=#2-bash-and-grep-regular-expressions>2. Bash and grep regular expressions</a></li></ul><h2 id=1-some-commands-default-options-to-use>1. some commands default options to use</h2><ul><li><a href=https://dougrichardson.us/notes/fail-fast-bash-scripting.html>https://dougrichardson.us/notes/fail-fast-bash-scripting.html</a> but set -o nounset is not usable because empty array
are considered unset</li><li>always use <code>sed -E</code></li><li>avoid using grep -P as it is not supported on alpine, prefer using -E</li></ul><h2 id=2-bash-and-grep-regular-expressions>2. <a name=regularExpressions></a>Bash and grep regular expressions</h2><ul><li>grep regular expression <code>[A-Za-z]</code> matches by default accentuated character, if you don&rsquo;t want to match them, use the
environment variable <code>LC_ALL=POSIX</code>,<ul><li>Eg: <code>LC_ALL=POSIX grep -E -q '^[A-Za-z_0-9:]+$'</code></li><li>I added <code>export LC_ALL=POSIX</code> in all my headers, it can be overridden using a subShell</li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-68381a72b7319e266b81540193a71450>1.2.3 - Bats Testing Framework</h1><div class=lead>Best practices for testing Bash scripts with Bats framework</div><ul><li><a href=#1-use-of-default-temp-directory-created-by-bats>1. use of default temp directory created by bats</a></li><li><a href=#2-avoid-boilerplate-code>2. avoid boilerplate code</a></li><li><a href=#3-override-an-environment-variable-when-using-bats-run>3. Override an environment variable when using bats run</a></li><li><a href=#4-override-a-bash-framework-function>4. Override a bash framework function</a></li></ul><h2 id=1-use-of-default-temp-directory-created-by-bats>1. use of default temp directory created by bats</h2><p>Instead of creating yourself your temp directory, you can use the special variable <code>BATS_TEST_TMPDIR</code>, this directory is
automatically destroyed at the end of the test except if the option <code>--no-tempdir-cleanup</code> is provided to bats command.</p><p><strong>Exception</strong>: if you are testing bash traps, you would need to create your own directories to avoid unexpected errors.</p><h2 id=2-avoid-boilerplate-code>2. avoid boilerplate code</h2><p>using this include, includes most of the features needed when using bats</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># shellcheck source=src/batsHeaders.sh</span>
</span></span><span style=display:flex><span><span style=color:#204a87>source</span> <span style=color:#4e9a06>&#34;</span><span style=color:#204a87;font-weight:700>$(</span><span style=color:#204a87>cd</span> <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>BATS_TEST_DIRNAME</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/..&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#204a87>pwd</span><span style=color:#204a87;font-weight:700>)</span><span style=color:#4e9a06>/batsHeaders.sh&#34;</span>
</span></span></code></pre></div><p>It sets those bash features:</p><ul><li>set -o errexit</li><li>set -o pipefail</li></ul><p>It imports several common files like some additional bats features.</p><p>And makes several variables available:</p><ul><li>BASH_TOOLS_ROOT_DIR</li><li>vendorDir</li><li>srcDir</li><li>FRAMEWORK_ROOT_DIR (same as BASH_TOOLS_ROOT_DIR but used by some bash framework functions)</li><li>LC_ALL=POSIX see
<a href=/HowTo/HowTo-Write-Bash-Scripts/10-LinuxCommands-BestPractices.md#regularExpressions>Bash and grep regular expressions best practices</a></li></ul><h2 id=3-override-an-environment-variable-when-using-bats-run>3. Override an environment variable when using bats run</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>SUDO</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;&#34;</span> run Linux::Apt::update
</span></span></code></pre></div><h2 id=4-override-a-bash-framework-function>4. Override a bash framework function</h2><p>using stub is not possible because it does not support executable with special characters like <code>::</code>. So the solution is
just to override the function inside your test function without importing the original function of course. In tearDown
method do not forget to use <code>unset -f yourFunction</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-17b81e141eb8ac7e0af38775813b1152>1.3 - How-To Guides</h1><div class=lead>Step-by-step guides for various technologies</div><div class="pageinfo pageinfo-primary"><p>In-depth tutorials and how-to guides for Docker, Jenkins, and other development technologies.</p></div><h2 id=1-available-guides>1. Available Guides</h2><ul><li><strong>How to Write Dockerfiles</strong> - Best practices for efficient Dockerfiles</li><li><strong>How to Write Docker Compose Files</strong> - Organizing multi-container applications</li><li><strong>How to Write Jenkinsfiles</strong> - Complete Jenkins pipeline guide (10 articles)</li><li><strong>Saml2Aws Setup</strong> - AWS access with SAML authentication</li></ul><h2 id=2-getting-started>2. Getting Started</h2><p>Select a guide from the sidebar to begin.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6cc9860e9db2740aab81c482809a4042>1.3.1 - How to Write Jenkinsfiles</h1><div class=lead>Comprehensive guide to writing Jenkins pipelines and Jenkinsfiles</div><p>This section provides comprehensive guides for writing Jenkinsfiles and working with Jenkins
pipelines.</p><div class="pageinfo pageinfo-primary"><p>This is a complete guide covering Jenkins architecture, pipeline syntax, shared libraries, best
practices, and annotated examples.</p></div><h2 id=1-what-youll-learn>1. What You&rsquo;ll Learn</h2><ul><li>How Jenkins works and its architecture</li><li>Declarative and scripted pipeline syntax</li><li>Creating and using Jenkins shared libraries</li><li>Jenkins best practices and configuration</li><li>Real-world Jenkinsfile examples with detailed annotations</li><li>Common recipes and troubleshooting tips</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-6971fa357af9d063f9640ffefd5beb05>1.3.1.1 - How Jenkins Works</h1><div class=lead>Understanding Jenkins architecture and concepts</div><ul><li><a href=#1-jenkins-master-slave-architecture>1. Jenkins Master Slave Architecture</a><ul><li><a href=#11-jenkins-controllerjenkins-master-node>1.1. Jenkins controller/Jenkins master node</a></li><li><a href=#12-nodes>1.2. Nodes</a></li><li><a href=#13-agents>1.3. Agents</a></li><li><a href=#14-executors>1.4. Executors</a></li><li><a href=#15-jobs>1.5. Jobs</a></li></ul></li><li><a href=#2-jenkins-dynamic-node>2. Jenkins dynamic node</a></li></ul><p>Source: <a href=https://www.jenkins.io/doc/book/managing/nodes/>https://www.jenkins.io/doc/book/managing/nodes/</a></p><p>Source glossary: <a href=https://www.jenkins.io/doc/book/glossary/>https://www.jenkins.io/doc/book/glossary/</a></p><h2 id=1-jenkins-master-slave-architecture>1. Jenkins Master Slave Architecture</h2><p><img src="https://i0.wp.com/digitalvarys.com/wp-content/uploads/2019/05/image-4.png?resize=920%2C581" alt="Jenkins Master Slave Architecture"></p><p>The Jenkins <strong>controller</strong> is the <strong>master node</strong> which is able to launch <strong>jobs</strong> on different <strong>nodes</strong> (machines)
directed by an <strong>Agent</strong>. The Agent can the use one or several <strong>executors</strong> to execute the job(s) depending on
configuration.</p><p>Jenkins is using Master/Slave architecture with the following components:</p><h3 id=11-jenkins-controllerjenkins-master-node>1.1. Jenkins controller/Jenkins master node</h3><blockquote><p>The central, coordinating process which stores configuration, loads plugins, and renders the various user interfaces
for Jenkins.</p></blockquote><p>The Jenkins controller is the Jenkins service itself and is where Jenkins is installed. It is a webserver that also acts
as a &ldquo;brain&rdquo; for deciding how, when and where to run tasks. Management tasks (configuration, authorization, and
authentication) are executed on the controller, which serves HTTP requests. Files written when a Pipeline executes are
written to the filesystem on the controller unless they are off-loaded to an artifact repository such as Nexus or
Artifactory.</p><h3 id=12-nodes>1.2. Nodes</h3><blockquote><p>A machine which is part of the Jenkins environment and capable of executing
<a href=https://www.jenkins.io/doc/book/glossary/#pipeline>Pipelines</a> or
<a href=https://www.jenkins.io/doc/book/glossary/#job>jobs</a>. Both the
<a href=https://www.jenkins.io/doc/book/glossary/#controller>Controller</a> and
<a href=https://www.jenkins.io/doc/book/glossary/#agent>Agents</a> are considered to be Nodes.</p></blockquote><p>Nodes are the &ldquo;<strong>machines</strong>&rdquo; on which build agents run. Jenkins monitors each attached node for disk space, free temp
space, free swap, clock time/sync and response time. A node is taken offline if any of these values go outside the
configured threshold.</p><p>The Jenkins controller itself runs on a special <em>built-in node</em>. It is possible to run agents and executors on this
built-in node although this can degrade performance, reduce scalability of the Jenkins instance, and create serious
security problems and is strongly discouraged, especially for production environments.</p><h3 id=13-agents>1.3. Agents</h3><blockquote><p>An agent is typically a machine, or container, which connects to a Jenkins controller and executes tasks when directed
by the controller.</p></blockquote><p>Agents manage the task execution on behalf of the Jenkins controller by using executors. An agent is actually a small
(170KB single jar) Java client process that connects to a Jenkins controller and is assumed to be unreliable. An agent
can use any operating system that supports Java. Tools required for builds and tests are installed on the node where the
agent runs; they can be installed directly or in a container (Docker or Kubernetes). Each agent is effectively a process
with its own PID (Process Identifier) on the host machine.</p><blockquote><p>In practice, nodes and agents are essentially the same but it is good to remember that they are conceptually distinct.</p></blockquote><h3 id=14-executors>1.4. Executors</h3><blockquote><p>A slot for execution of work defined by a <a href=https://www.jenkins.io/doc/book/glossary/#pipeline>Pipeline</a> or
<a href=https://www.jenkins.io/doc/book/glossary/#job>job</a> on a <a href=https://www.jenkins.io/doc/book/glossary/#node>Node</a>. A
Node may have zero or more Executors configured which corresponds to how many concurrent Jobs or Pipelines are able to
execute on that Node.</p></blockquote><p>An executor is a slot for execution of tasks; effectively, it is a thread in the agent. The number of executors on a
node defines the number of concurrent tasks that can be executed on that node at one time. In other words, this
determines the number of concurrent Pipeline stages that can execute on that node at one time.</p><p>The proper number of executors per build node must be determined based on the resources available on the node and the
resources required for the workload. When determining how many executors to run on a node, consider CPU and memory
requirements as well as the amount of I/O and network activity:</p><ul><li>One executor per node is the safest configuration.</li><li>One executor per CPU core may work well if the tasks being run are small.</li><li>Monitor I/O performance, CPU load, memory usage, and I/O throughput carefully when running multiple executors on a
node.</li></ul><h3 id=15-jobs>1.5. Jobs</h3><blockquote><p>A user-configured description of work which Jenkins should perform, such as building a piece of software, etc.</p></blockquote><h2 id=2-jenkins-dynamic-node>2. Jenkins dynamic node</h2><p>Jenkins has static slave nodes and can trigger the generation of dynamic slave nodes</p><p><img src=images/JenkinsMasterSlave.png alt="Jenkins Master/slave architecture"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-9869243d0d83c4e5b661966a7578774f>1.3.1.2 - Jenkins Pipelines</h1><div class=lead>Declarative and scripted pipeline syntax</div><ul><li><a href=#1-what-is-a-pipeline->1. What is a pipeline ?</a></li><li><a href=#2-pipeline-creation-via-ui>2. Pipeline creation via UI</a></li><li><a href=#3-groovy>3. Groovy</a></li><li><a href=#4-difference-between-scripted-pipeline-freestyle-and-declarative-pipeline-syntax>4. Difference between scripted pipeline (freestyle) and declarative pipeline syntax</a></li><li><a href=#5-declarative-pipeline-example>5. Declarative pipeline example</a></li><li><a href=#6-scripted-pipeline-example>6. Scripted pipeline example</a></li><li><a href=#7-why-pipeline>7. Why Pipeline?</a></li></ul><h2 id=1-what-is-a-pipeline->1. What is a pipeline ?</h2><p><a href=https://www.jenkins.io/doc/book/pipeline/>https://www.jenkins.io/doc/book/pipeline/</a></p><blockquote><p>Jenkins Pipeline (or simply &ldquo;Pipeline&rdquo; with a capital &ldquo;P&rdquo;) is a suite of plugins which supports implementing and
integrating <em>continuous delivery pipelines</em> into Jenkins.</p><p>A <em>continuous delivery (CD) pipeline</em> is an automated expression of your process for getting software from version
control right through to your users and customers. Every change to your software (committed in source control) goes
through a complex process on its way to being released. This process involves building the software in a reliable and
repeatable manner, as well as progressing the built software (called a &ldquo;build&rdquo;) through multiple stages of testing and
deployment.</p><p>Pipeline provides an extensible set of tools for modeling simple-to-complex delivery pipelines &ldquo;as code&rdquo; via the
<a href=https://www.jenkins.io/doc/book/pipeline/syntax>Pipeline domain-specific language (DSL) syntax</a>.
<a href=https://www.jenkins.io/doc/book/pipeline/#_footnotedef_1 title="View footnote.">View footnote 1</a></p><p>The definition of a Jenkins Pipeline is written into a text file (called a
<a href=https://www.jenkins.io/doc/book/pipeline/jenkinsfile><code>Jenkinsfile</code></a>) which in turn can be committed to a project’s
source control repository.
<a href=https://www.jenkins.io/doc/book/pipeline/#_footnotedef_2 title="View footnote.">View footnote 2</a> This is the foundation of
&ldquo;Pipeline-as-code&rdquo;; treating the CD pipeline a part of the application to be versioned and reviewed like any other
code.</p></blockquote><h2 id=2-pipeline-creation-via-ui>2. Pipeline creation via UI</h2><p>it&rsquo;s not recommended but it&rsquo;s possible to create a pipeline via the UI.</p><p>There are several drawbacks:</p><ul><li>no code revision</li><li>difficult to read, understand</li></ul><h2 id=3-groovy>3. Groovy</h2><p>Scripted and declarative pipelines are using groovy language.</p><p>Checkout <a href=https://www.guru99.com/groovy-tutorial.html>https://www.guru99.com/groovy-tutorial.html</a> to have a quick
overview of this derived language check <a href=https://en.wikipedia.org/wiki/Apache_Groovy>Wikipedia</a></p><h2 id=4-difference-between-scripted-pipeline-freestyle-and-declarative-pipeline-syntax>4. Difference between scripted pipeline (freestyle) and declarative pipeline syntax</h2><p>What are the main differences ? Here are some of the most important things you should know:</p><ul><li>Basically, declarative and scripted pipelines differ in terms of the programmatic approach. One uses a declarative
programming model and the second uses an imperative programming mode.</li><li>Declarative pipelines break down stages into multiple steps, while in scripted pipelines there is no need for this.
Example below</li></ul><p>Declarative and Scripted Pipelines are constructed fundamentally differently. <strong>Declarative Pipeline is a more recent
feature of Jenkins Pipeline</strong> which:</p><ul><li>provides richer syntactical features over Scripted Pipeline syntax, and</li><li>is designed to make writing and reading Pipeline code easier.</li><li>By default automatically checkout stage</li></ul><p>Many of the individual syntactical components (or &ldquo;steps&rdquo;) written into a <code>Jenkinsfile</code>, however, are common to both
Declarative and Scripted Pipeline. Read more about how these two types of syntax differ in
<a href=https://www.jenkins.io/doc/book/pipeline/#pipeline-concepts>Pipeline concepts</a> and
<a href=https://www.jenkins.io/doc/book/pipeline/#pipeline-syntax-overview>Pipeline syntax overview</a>.</p><h2 id=5-declarative-pipeline-example>5. Declarative pipeline example</h2><p><a href=https://www.jenkins.io/doc/book/pipeline/syntax/>Pipeline syntax documentation</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span> <span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>// executed on an executor with the label &#39;some-label&#39;
</span></span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>// or &#39;docker&#39;, the label normally specifies:
</span></span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>// - the size of the machine to use
</span></span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>//   (eg.: Docker-C5XLarge used for build that needs a powerful machine)
</span></span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>// - the features you want in your machine
</span></span></span><span style=display:flex><span>     <span style=color:#8f5902;font-style:italic>//   (eg.: docker-base-ubuntu an image with docker command available)
</span></span></span><span style=display:flex><span>     <span style=color:#000>label</span> <span style=color:#4e9a06>&#34;some-label&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>     <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;foo&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#8f5902;font-style:italic>// variable assignment and Complex global
</span></span></span><span style=display:flex><span>         <span style=color:#8f5902;font-style:italic>// variables (with properties or methods)
</span></span></span><span style=display:flex><span>         <span style=color:#8f5902;font-style:italic>// can only be done in a script block
</span></span></span><span style=display:flex><span>         <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>           <span style=color:#000>foo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>image</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;ubuntu&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>           <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>bar</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${foo.imageName()}&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;foo: ${foo.imageName()}&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>       <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>     <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>     <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;bar&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>       <span style=color:#000>steps</span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>         <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;bar: ${env.bar}&#34;</span>
</span></span><span style=display:flex><span>         <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;foo: ${foo.imageName()}&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>     <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=6-scripted-pipeline-example>6. Scripted pipeline example</h2><p>Scripted pipelines permit a developer to inject code, while the declarative Jenkins pipeline doesn’t. <strong>should be
avoided actually, try to use jenkins library instead</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>git</span> <span style=color:#f57900>url:</span> <span style=color:#4e9a06>&#39;https://github.com/jfrogdev/project-examples.git&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Get Artifactory server instance, defined in the Artifactory Plugin
</span></span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// administration page.
</span></span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>server</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Artifactory</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>server</span> <span style=color:#4e9a06>&#34;SERVER_ID&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Read the upload spec and upload files to Artifactory.
</span></span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>downloadSpec</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>       <span style=color:#4e9a06>&#39;&#39;&#39;{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       &#34;files&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>         {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;pattern&#34;: &#34;libs-snapshot-local/*.zip&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;target&#34;: &#34;dependencies/&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;props&#34;: &#34;p1=v1;p2=v2&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>         }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       ]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   }&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buildInfo1</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>server</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>download</span> <span style=color:#f57900>spec:</span> <span style=color:#000>downloadSpec</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Read the upload spec which was downloaded from github.
</span></span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>uploadSpec</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>     <span style=color:#4e9a06>&#39;&#39;&#39;{
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>     &#34;files&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;pattern&#34;: &#34;resources/Kermit.*&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;target&#34;: &#34;libs-snapshot-local&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;props&#34;: &#34;p1=v1;p2=v2&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       },
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       {
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;pattern&#34;: &#34;resources/Frogger.*&#34;,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;target&#34;: &#34;libs-snapshot-local&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>       }
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      ]
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>   }&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Upload to Artifactory.
</span></span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>buildInfo2</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>server</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>upload</span> <span style=color:#f57900>spec:</span> <span style=color:#000>uploadSpec</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Merge the upload and download build-info objects.
</span></span></span><span style=display:flex><span>  <span style=color:#000>buildInfo1</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>append</span> <span style=color:#000>buildInfo2</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Publish the build to Artifactory
</span></span></span><span style=display:flex><span>  <span style=color:#000>server</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>publishBuildInfo</span> <span style=color:#000>buildInfo1</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=7-why-pipeline>7. Why Pipeline?</h2><p>Jenkins is, fundamentally, an automation engine which supports a number of automation patterns. Pipeline adds a powerful
set of automation tools onto Jenkins, supporting use cases that span from simple continuous integration to comprehensive
CD pipelines. By modeling a series of related tasks, users can take advantage of the many features of Pipeline:</p><ul><li><strong>Code</strong>: Pipelines are implemented in code and typically checked into source control, giving teams the ability to
edit, review, and iterate upon their delivery pipeline.</li><li><strong>Durable</strong>: Pipelines can survive both planned and unplanned restarts of the Jenkins controller.</li><li><strong>Pausable</strong>: Pipelines can optionally stop and wait for human input or approval before continuing the Pipeline run.</li><li><strong>Versatile</strong>: Pipelines support complex real-world CD requirements, including the ability to fork/join, loop, and
perform work in parallel.</li><li><strong>Extensible</strong>: The Pipeline plugin supports custom extensions to its DSL
<a href=https://www.jenkins.io/doc/book/pipeline/#_footnotedef_1>see jenkins doc</a> and multiple options for integration with
other plugins.</li></ul><p>While Jenkins has always allowed rudimentary forms of chaining Freestyle Jobs together to perform sequential tasks,
<a href=https://www.jenkins.io/doc/book/pipeline/#_footnotedef_4>see jenkins doc</a> Pipeline makes this concept a first-class
citizen in Jenkins.</p><p>More information on <a href=https://www.jenkins.io/doc/book/pipeline/>Official jenkins documentation - Pipeline</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-8eb985311f27db5ec418f1717f4e0622>1.3.1.3 - Jenkins Library</h1><div class=lead>Creating and using Jenkins shared libraries</div><ul><li><a href=#1-what-is-a-jenkins-shared-library->1. What is a jenkins shared library ?</a></li><li><a href=#2-loading-libraries-dynamically>2. Loading libraries dynamically</a></li><li><a href=#3-jenkins-library-directory-structure>3. jenkins library directory structure</a></li><li><a href=#4-jenkins-library>4. Jenkins library</a></li><li><a href=#5-jenkins-library-structure>5. Jenkins library structure</a></li><li><a href=#6-external-resource-usage>6. external resource usage</a></li></ul><h2 id=1-what-is-a-jenkins-shared-library->1. What is a jenkins shared library ?</h2><blockquote><p>As Pipeline is adopted for more and more projects in an organization, common patterns are likely to emerge. Oftentimes
it is useful to share parts of Pipelines between various projects to reduce redundancies and keep code &ldquo;DRY&rdquo;</p></blockquote><p>for more information check <a href=https://www.jenkins.io/doc/book/pipeline/shared-libraries/>pipeline shared libraries</a></p><h2 id=2-loading-libraries-dynamically>2. Loading libraries dynamically</h2><p>As of version 2.7 of the <em>Pipeline: Shared Groovy Libraries</em> plugin, there is a new option for loading (non-implicit)
libraries in a script: a <code>library</code> step that loads a library <em>dynamically</em>, at any time during the build.</p><p>If you are only interested in using global variables/functions (from the <code>vars/</code> directory), the syntax is quite simple:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>library</span> <span style=color:#4e9a06>&#39;my-shared-library&#39;</span>
</span></span></code></pre></div><p>Thereafter, any global variables from that library will be accessible to the script.</p><h2 id=3-jenkins-library-directory-structure>3. jenkins library directory structure</h2><p>The directory structure of a Shared Library repository is as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>(root)
</span></span><span style=display:flex><span>+- src        # Groovy source files
</span></span><span style=display:flex><span>|   +- org
</span></span><span style=display:flex><span>|       +- foo
</span></span><span style=display:flex><span>|           +- Bar.groovy  # for org.foo.Bar class
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>+- vars       # The vars directory hosts script
</span></span><span style=display:flex><span>              # files that are exposed as a variable in Pipelines
</span></span><span style=display:flex><span>|   +- foo.groovy          # for global &#39;foo&#39; variable
</span></span><span style=display:flex><span>|   +- foo.txt             # help for &#39;foo&#39; variable
</span></span><span style=display:flex><span>|
</span></span><span style=display:flex><span>+- resources  # resource files (external libraries only)
</span></span><span style=display:flex><span>|   +- org
</span></span><span style=display:flex><span>|      +- foo
</span></span><span style=display:flex><span>|         +- bar.json      # static helper data for org.foo.Bar
</span></span></code></pre></div><h2 id=4-jenkins-library>4. Jenkins library</h2><p>remember that jenkins library code is executed on master node</p><p>if you want to execute code on the node, you need to use jenkinsExecutor</p><p>usage of jenkins executor</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>String</span> <span style=color:#000>credentialsId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;babee6c1-14fe-4d90-9da0-ffa7068c69af&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>lib</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>library</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>identifier:</span> <span style=color:#4e9a06>&#39;jenkins_library@v1.0&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>retriever:</span> <span style=color:#000>modernSCM</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>        <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;GitSCMSource&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>remote:</span> <span style=color:#4e9a06>&#39;git@github.com:fchastanet/jenkins-library.git&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>credentialsId:</span> <span style=color:#000>credentialsId</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// this is the jenkinsExecutor instance
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>docker</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>Then in the library, it is used like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>status</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>jenkinsExecutor</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sh</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>script:</span> <span style=color:#4e9a06>&#34;docker pull ${cacheTag}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>returnStatus:</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=5-jenkins-library-structure>5. Jenkins library structure</h2><p>I remarked that a lot of code was duplicated between all my Jenkinsfiles so I created this library
<a href=https://github.com/fchastanet/jenkins-library>https://github.com/fchastanet/jenkins-library</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>(root)
</span></span><span style=display:flex><span>+- doc    # markdown files automatically generated
</span></span><span style=display:flex><span>          # from groovy files by generateDoc.sh
</span></span><span style=display:flex><span>+- src    # Groovy source files
</span></span><span style=display:flex><span>|   +- fchastanet
</span></span><span style=display:flex><span>|       +- Cloudflare.groovy     # zonePurge
</span></span><span style=display:flex><span>|       +- Docker.groovy         # getTagCompatibleFromBranch
</span></span><span style=display:flex><span>                                 # pullBuildPushImage, ...
</span></span><span style=display:flex><span>|       +- Git.groovy            # getRepoURL, getCommitSha,
</span></span><span style=display:flex><span>                                 # getLastPusherEmail,
</span></span><span style=display:flex><span>                                 # updateConditionalGithubCommitStatus
</span></span><span style=display:flex><span>|       +- Kubernetes.groovy     # deployHelmChart, ...
</span></span><span style=display:flex><span>|       +- Lint.groovy           # dockerLint,
</span></span><span style=display:flex><span>                                 # transform lighthouse report
</span></span><span style=display:flex><span>                                 # to Warnings NG issues format
</span></span><span style=display:flex><span>|       +- Mail.groovy           # sendTeamsNotification,
</span></span><span style=display:flex><span>                                 # sendConditionalEmail, ...
</span></span><span style=display:flex><span>|       +- Utils.groovy          # deepMerge, isCollectionOrArray,
</span></span><span style=display:flex><span>                                 # deleteDirAsRoot,
</span></span><span style=display:flex><span>                                 # initAws (could be moved to Aws class)
</span></span><span style=display:flex><span>+- vars   # The vars directory hosts script files that
</span></span><span style=display:flex><span>          # are exposed as a variable in Pipelines
</span></span><span style=display:flex><span>|   +- dockerPullBuildPush.groovy #
</span></span><span style=display:flex><span>|   +- whenOrSkip.groovy          #
</span></span></code></pre></div><h2 id=6-external-resource-usage>6. external resource usage</h2><p>If you need you check out how I used this repository <a href=https://github.com/fchastanet/jenkins-library-resources>https://github.com/fchastanet/jenkins-library-resources</a> in
jenkins_library (Linter) that hosts some resources to parse result files.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7468762d46626d9a543656cc02eabce8>1.3.1.4 - Jenkins Best Practices</h1><div class=lead>Best practices for Jenkins configuration</div><ul><li><a href=#1-pipeline-best-practices>1. Pipeline best practices</a></li><li><a href=#2-shared-library-best-practices>2. Shared library best practices</a></li></ul><h2 id=1-pipeline-best-practices>1. Pipeline best practices</h2><p><a href=https://www.jenkins.io/doc/book/pipeline/pipeline-best-practices/#general>Official Jenkins pipeline best practices</a></p><p>Summary:</p><ul><li>Make sure to use Groovy code in Pipelines as glue</li><li>Externalize shell scripts from Jenkins Pipeline<ul><li>for better jenkinsfile readability</li><li>in order to test the scripts isolated from jenkins</li></ul></li><li>Avoid complex Groovy code in Pipelines<ul><li>Groovy code <strong>always</strong> executes on controller which means using controller resources(memory and CPU)<ul><li>it is not the case for shell scripts</li></ul></li><li>eg1: prefer using <strong>jq</strong> inside shell script instead of groovy JsonSlurper</li><li>eg2: prefer calling <strong>curl</strong> instead of groovy http request</li></ul></li><li>Reducing repetition of similar Pipeline steps (eg: one sh step instead of severals)<ul><li>group similar steps together to avoid step creation/destruction overhead</li></ul></li><li>Avoiding calls to Jenkins.getInstance</li></ul><h2 id=2-shared-library-best-practices>2. Shared library best practices</h2><p><a href=https://www.jenkins.io/doc/book/pipeline/pipeline-best-practices/#using-shared-libraries>Official Jenkins shared libraries best practices</a></p><p>Summary:</p><ul><li>Do not override built-in Pipeline steps</li><li>Avoiding large global variable declaration files</li><li>Avoiding very large shared libraries</li></ul><p>And:</p><ul><li>import jenkins library using a tag<ul><li>like in docker build, npm package with package-lock.json or python pip lock, it&rsquo;s advised to target a given version
of the library<ul><li>because some changes could break</li></ul></li></ul></li><li>The missing part: we miss on this library unit tests<ul><li>but each pipeline is a kind of integration test</li></ul></li><li>Because a pipeline can be
<a href=https://www.jenkins.io/doc/book/pipeline/pipeline-best-practices/#avoiding-notserializableexception>resumed</a>, your
library&rsquo;s classes should implement Serializable class and the following attribute has to be provided:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>private</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>final</span> <span style=color:#204a87;font-weight:700>long</span> <span style=color:#000>serialVersionUID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1L</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-0f486b9cd450314fe64a457617932115>1.3.1.5 - Annotated Jenkinsfiles - Part 1</h1><div class=lead>Detailed Jenkinsfile examples with annotations</div><p><a href=https://www.jenkins.io/doc/book/pipeline/#pipeline-example>Pipeline example</a></p><h2 id=1-simple-one>1. Simple one</h2><p>This build is used to generate docker images used to build production code and launch phpunit tests. This pipeline is
parameterized in the Jenkins UI directly with the parameters:</p><ul><li>branch (git branch to use)</li><li>environment(select with 3 options: build, phpunit or all)<ul><li>it would have been better to use simply 2 checkboxes phpunit/build</li></ul></li><li>project_branch</li></ul><p>Here the source code with inline comments:</p><p><strong>Annotated jenkinsfile</strong> Expand source</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>// This method allows to convert the branch name to a docker image tag.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This method is generally used by most of my jenkins pipelines, it&#39;s why it has been added to https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Docker.groovy#L31
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>getTagCompatibleFromBranch</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>branchName</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>tag</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>branchName</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toLowerCase</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>tag</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>tag</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>replaceAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;^origin/&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>tag</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>replaceAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;/&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;_&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// we declare here some variables that will be used in next stages
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>deploymentBranchTagCompatible</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// the pipeline is executed on a machine with docker daemon
</span></span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// available
</span></span></span><span style=display:flex><span>            <span style=color:#000>label</span> <span style=color:#4e9a06>&#39;docker-ubuntu&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stage</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;checkout&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// this command is actually not necessary because checkout is
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// done automatically when using declarative pipeline
</span></span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;echo &#34;pulling ... ${GIT_BRANCH#origin/}&#34;&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>checkout</span> <span style=color:#000>scm</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// this particular build needs to access to some private github
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// repositories, so here we are copying the ssh key
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// it would be better to use new way of injecting ssh key
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// inside docker using sshagent
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// check https://stackoverflow.com/a/66897280
</span></span></span><span style=display:flex><span>                <span style=color:#000>withCredentials</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>sshUserPrivateKey</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                      <span style=color:#f57900>credentialsId:</span> <span style=color:#4e9a06>&#39;855aad9f-1b1b-494c-aa7f-4de881c7f659&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                      <span style=color:#f57900>keyFileVariable:</span> <span style=color:#4e9a06>&#39;sshKeyFile&#39;</span>
</span></span><span style=display:flex><span>                   <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// best practice similar steps should be merged into one
</span></span></span><span style=display:flex><span>                    <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;rm -f ./phpunit/id_rsa&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;rm -f ./build/id_rsa&#39;</span>
</span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// here we are escaping &#39;$&#39; so the variable will be
</span></span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// interpolated on the jenkins slave and not the jenkins
</span></span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// master node instead of escaping, we could have used
</span></span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// single quotes
</span></span></span><span style=display:flex><span>                    <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;cp \$sshKeyFile ./phpunit/id_rsa&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;cp \$sshKeyFile ./build/id_rsa&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>                <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// as actually scm is already done before executing the
</span></span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// first step, this call could have been done during
</span></span></span><span style=display:flex><span>                    <span style=color:#8f5902;font-style:italic>// declaration of this variable
</span></span></span><span style=display:flex><span>                    <span style=color:#000>deploymentBranchTagCompatible</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>getTagCompatibleFromBranch</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;build Build env&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// the build can be launched with the parameter environment
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// defined in the configuration of the jenkins job, these
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// parameters could have been defined directly in the pipeline
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// see https://www.jenkins.io/doc/book/pipeline/syntax/#parameters
</span></span></span><span style=display:flex><span>                <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>environment</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#34;phpunit&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// here we could have launched all this commands in the same sh
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// directive
</span></span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker build --build-arg BRANCH=${params.project_branch} -t build build&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// use a constant for dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com
</span></span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker tag build dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com/build:${deploymentBranchTagCompatible}&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker push dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com/build:${deploymentBranchTagCompatible}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;build PHPUnit env&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// it would have been cleaner to use
</span></span></span><span style=display:flex><span>                <span style=color:#8f5902;font-style:italic>// expression { return params.environment = &#34;phpunit&#34;}
</span></span></span><span style=display:flex><span>                <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>environment</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#34;build&#34;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker build --build-arg BRANCH=${params.project_branch} -t phpunit phpunit&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker tag phpunit dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com/phpunit:${deploymentBranchTagCompatible}&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker push dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com/phpunit:${deploymentBranchTagCompatible}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>without seeing the Dockerfile files, we can advise :</p><ul><li>to build these images in the same pipeline where build and phpunit are run<ul><li>the images are built at the same time so we are sure that we are using the right version</li></ul></li><li>apparently the docker build depend on the branch of the project, this should be avoided</li><li>ssh key is used in docker image, that could lead to a <strong>security issue</strong> as ssh key is still in the history of images
layers even if it has been removed in subsequent layers, check <a href=https://stackoverflow.com/a/66897280>https://stackoverflow.com/a/66897280</a> for information
on how to use ssh-agent instead</li><li>we could use a single Dockerfile with 2 stages:<ul><li>one stage to generate production image</li><li>one stage that inherits production stage, used to execute phpunit</li><li>it has the following advantages :<ul><li>reduce the total image size because of the reuse different docker image layers</li><li>only one Dockerfile to maintain</li></ul></li></ul></li></ul><h2 id=2-more-advanced-and-annotated-jenkinsfiles>2. More advanced and annotated Jenkinsfiles</h2><ul><li><a href=05-01-Annotated-Jenkinsfiles.md>php project with helm push</a></li><li><a href=05-02-Annotated-Jenkinsfiles.md>javascript project with docker build and S3 push</a></li><li><a href=05-03-Annotated-Jenkinsfiles.md>browser extension build and deployment</a></li><li><a href=05-04-Annotated-Jenkinsfiles.md>jenkins library - reusable pipeline generation</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-4fc294def0f6cdaa02082959a217ca86>1.3.1.6 - Annotated Jenkinsfiles - Part 2</h1><div class=lead>More annotated Jenkinsfile examples</div><h2 id=1-introduction>1. Introduction</h2><p>This example is missing the use of parameters, jenkins library in order to reuse common code</p><p>This example uses :</p><ul><li>post conditions
<a href=https://www.jenkins.io/doc/book/pipeline/syntax/#post>https://www.jenkins.io/doc/book/pipeline/syntax/#post</a></li><li>github plugin to set commit status indicating the result of the build</li><li>usage of <strong>several jenkins plugins</strong>, you can check here to get the full list installed on your server and even
<strong>generate code snippets</strong> by adding <strong>pipeline-syntax/</strong> to your jenkins server url</li></ul><p>But it misses:</p><ul><li>usage of <a href=https://www.jenkins.io/doc/book/pipeline/syntax/#parameters>inline parameters</a></li><li>usage of jenkins library to reuse common code<ul><li><a href=https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Git.groovy#L156>Git updateConditionalGithubCommitStatus</a></li><li><a href=https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Docker.groovy#L46>Docker pullBuildPushImage</a></li></ul></li></ul><p>check <a href=https://www.jenkins.io/doc/book/pipeline/syntax/>Pipeline syntax documentation</a></p><h2 id=2-annotated-jenkinsfile>2. Annotated Jenkinsfile</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>// Define variables for QA environment
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>registry_id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;awsAccountId&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>registry_url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>registry_id</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.dkr.ecr.us-east-1.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>image_name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;project&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>image_fqdn_master</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>registry_url</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;/&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>image_name</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;:master&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>image_fqdn_current_branch</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>image_fqdn_master</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// this method is used by several of my pipelines and has been added
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// to jenkins_library &lt;https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Git.groovy#L156&gt;
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>publishStatusToGithub</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>step</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;GitHubCommitStatusSetter&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>reposSource:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;ManuallyEnteredRepositorySource&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>url:</span> <span style=color:#4e9a06>&#34;https://github.com/fchastanet/project&#34;</span><span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>errorHandlers:</span> <span style=color:#ce5c00;font-weight:700>[[</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;ShallowAnyErrorHandler&#39;</span><span style=color:#ce5c00;font-weight:700>]],</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>statusResultSource:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;ConditionalStatusResultSource&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>results:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;AnyBuildResult&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>state:</span> <span style=color:#000>status</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>]);</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// bad practice: try to indicate in your node labels, which feature it
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// includes for example, here we need docker, label could have been
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// &#39;eks-nonprod-docker&#39;
</span></span></span><span style=display:flex><span>      <span style=color:#000>label</span> <span style=color:#4e9a06>&#39;eks-nonprod&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Checkout&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// checkout is not necessary as it is automatically done
</span></span></span><span style=display:flex><span>        <span style=color:#000>checkout</span> <span style=color:#000>scm</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// &#39;wrap&#39; allows to inject some useful variables like BUILD_USER,
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// BUILD_USER_FIRST_NAME
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// see https://www.jenkins.io/doc/pipeline/steps/build-user-vars-plugin/
</span></span></span><span style=display:flex><span>          <span style=color:#000>wrap</span><span style=color:#ce5c00;font-weight:700>([</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;BuildUser&#39;</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#${currentBuild.number}_${BRANCH}_${BUILD_USER}_${DEPLOYMENT}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// params could have been defined inside the pipeline directly
</span></span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// instead of defining them in jenkins build configuration
</span></span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;staging&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${displayName}_${INSTANCE}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// next line allows to change the build name, check addHtmlBadge
</span></span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// plugin function for more advanced usage of this feature, you
</span></span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// check this jenkinsfile 05-02-Annotated-Jenkinsfiles.md
</span></span></span><span style=display:flex><span>            <span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>displayName</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Run tests&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// all these sh directives could have been merged into one
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// it is best to use a separated sh file that could take some parameters
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// as it is simpler to read and to eventually test separately
</span></span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;docker build -t project-test &#34;$PWD&#34;/docker/test&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;cp &#34;$PWD&#34;/app/config/parameters.yml.dist &#34;$PWD&#34;/app/config/parameters.yml&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// for better readability and if separated script is not possible, use
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// continuation line for better readability
</span></span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;docker run -i --rm -v &#34;$PWD&#34;:/var/www/html/ -w /var/www/html/ project-test  /bin/bash -c &#34;composer install -a &amp;&amp; ./bin/phpunit -c /var/www/html/app/phpunit.xml --coverage-html /var/www/html/var/logs/coverage/ --log-junit /var/www/html/var/logs/phpunit.xml  --coverage-clover /var/www/html/var/logs/clover_coverage.xml&#34;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// Run the steps in the post section regardless of the completion status
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// of the Pipeline’s or stage’s run.
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// see https://www.jenkins.io/doc/book/pipeline/syntax/#post
</span></span></span><span style=display:flex><span>      <span style=color:#000>post</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>always</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// report unit test reports (unit test should generate result using
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// using junit format)
</span></span></span><span style=display:flex><span>          <span style=color:#000>junit</span> <span style=color:#4e9a06>&#39;var/logs/phpunit.xml&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// generate coverage page from test results
</span></span></span><span style=display:flex><span>          <span style=color:#000>step</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>            <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;CloverPublisher&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>cloverReportDir:</span> <span style=color:#4e9a06>&#39;var/logs/&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>cloverReportFileName:</span> <span style=color:#4e9a06>&#39;clover_coverage.xml&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// publish html page with the result of the coverage
</span></span></span><span style=display:flex><span>          <span style=color:#000>publishHTML</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>target:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>allowMissing:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>alwaysLinkToLastBuild:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>keepAll:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>reportDir:</span> <span style=color:#4e9a06>&#39;var/logs/coverage/&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>reportFiles:</span> <span style=color:#4e9a06>&#39;index.html&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>reportName:</span> <span style=color:#4e9a06>&#34;Coverage Report&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// this stage will be executed only if previous stage is successful
</span></span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Build image&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// this stage is executed only if these conditions returns true
</span></span></span><span style=display:flex><span>        <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>return</span>
</span></span><span style=display:flex><span>            <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;staging&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;prod&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;origin/master&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// this code is used in most of the pipeline and has been centralized
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// in https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Git.groovy#L39
</span></span></span><span style=display:flex><span>          <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>IMAGE_TAG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_COMMIT</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>substring</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>7</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// Update variable for production environment
</span></span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;prod&#39;</span> <span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>registry_id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;awsDockerRegistryId&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>registry_url</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>registry_id</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.dkr.ecr.eu-central-1.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>image_fqdn_master</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>registry_url</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;/&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>image_name</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;:master&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#000>image_fqdn_current_branch</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>registry_url</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;/&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>image_name</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;:&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>IMAGE_TAG</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// As jenkins slave machine can be constructed on demand,
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// it doesn&#39;t always contains all docker image cache
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// here to avoid building docker image from scratch, we are trying to
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// pull an existing version of the docker image on docker registry
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// and then build using this image as cache, so all layers not updated
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// in Dockerfile will not be built again (gain of time)
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// It is again a recurrent usage in most of the pipelines
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// so the next 8 lines could be replaced by the call to this method
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Docker
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// pullBuildPushImage https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Docker.groovy#L46
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Pull the master from repository (|| true avoids errors if the image
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// hasn&#39;t been pushed before)
</span></span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;docker pull ${image_fqdn_master} || true&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Build the image using pulled image as cache
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// instead of using concatenation, it is more readable to use variable interpolation
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// Eg: &#34;docker build --cache-from ${image_fqdn_master} -t ...&#34;
</span></span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;docker build \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --cache-from &#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>image_fqdn_master</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -t &#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>image_name</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -f &#34;$PWD/docker/prod/Dockerfile&#34; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            .&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Deploy image (Staging)&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;staging&#34;</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// Actually we should always push the image in order to be able to
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// feed the docker cache for next builds
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// Again the method Docker pullBuildPushImage https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Docker.groovy#L46
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// solves this issue and could be used instead of the next 6 lines
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// and &#34;Push image (Prod)&#34; stage
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// If building master, we should push the image with the tag master
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// to benefit from docker cache
</span></span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;origin/master&#39;</span> <span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Tag the image as master&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                 <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker tag ${image_name} ${image_fqdn_master}&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Push the image as master&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                 <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker push ${image_fqdn_master}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Tag the image&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker tag ${image_name} ${image_fqdn_current_branch}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Push the image&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker push ${image_fqdn_current_branch}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// use variable interpolation instead of concatenation
</span></span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Deploy on cluster&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          helm3 upgrade project-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>INSTANCE</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34; -i \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --namespace project-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>INSTANCE</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --create-namespace \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --cleanup-on-fail \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --atomic \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -f helm/values_files/values-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>INSTANCE</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;.yaml \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --set deployment.php_container.image.pullPolicy=Always \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            --set image.tag=&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>IMAGE_TAG</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            ./helm&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Push image (Prod)&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>DEPLOYMENT</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;prod&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;origin/master&#39;</span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// The method Docker pullBuildPushImage https://github.com/fchastanet/jenkins-library/blob/master/src/fchastanet/Docker.groovy#L46
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// provides a generic way of managing the pull, build, push of the docker
</span></span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// images, by managing also a common way of tagging docker images
</span></span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Tag the image as master&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker tag ${image_name} ${image_fqdn_current_branch}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#f57900>label:</span><span style=color:#4e9a06>&#34;Push the image as master&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>script:</span><span style=color:#4e9a06>&#34;docker push ${image_fqdn_current_branch}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>post</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>always</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// mark github commit as built
</span></span></span><span style=display:flex><span>      <span style=color:#000>publishStatusToGithub</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;${currentBuild.currentResult}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>This directive is really difficult to read and eventually debug it</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;docker run -i --rm -v &#34;$PWD&#34;:/var/www/html/ -w /var/www/html/ project-test  /bin/bash -c &#34;composer install -a &amp;&amp; ./bin/phpunit -c /var/www/html/app/phpunit.xml --coverage-html /var/www/html/var/logs/coverage/ --log-junit /var/www/html/var/logs/phpunit.xml  --coverage-clover /var/www/html/var/logs/clover_coverage.xml&#34;&#39;</span>
</span></span></code></pre></div><p>Another way to write previous directive is to:</p><ul><li>use continuation line</li><li>avoid &lsquo;&&&rsquo; as it can mask errors, use &lsquo;;&rsquo; instead</li><li>use &lsquo;set -o errexit&rsquo; to fail on first error</li><li>use &lsquo;set -o pipefail&rsquo; to fail if eventual piped command is failing</li><li>&lsquo;set -x&rsquo; allows to trace every command executed for better debugging</li></ul><p>Here a possible refactoring:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  docker run -i --rm \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    -v &#34;$PWD&#34;:/var/www/html/ \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    -w /var/www/html/ \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    project-test \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    /bin/bash -c &#34;\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      set -x ;\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      set -o errexit ;\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      set -o pipefail ;\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      composer install -a ;\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>      ./bin/phpunit \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        -c /var/www/html/app/phpunit.xml \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        --coverage-html /var/www/html/var/logs/coverage/ \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        --log-junit /var/www/html/var/logs/phpunit.xml  \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        --coverage-clover /var/www/html/var/logs/clover_coverage.xml
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#39;&#39;&#39;</span>
</span></span></code></pre></div><p>Note however it is best to use a separated sh file(s) that could take some parameters as it is simpler to read and to
eventually test separately. Here a refactoring using a separated sh file:</p><p>runTests.sh</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#204a87>set</span> -x -o errexit -o pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>composer install -a
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>./bin/phpunit <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -c /var/www/html/app/phpunit.xml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --coverage-html /var/www/html/var/logs/coverage/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --log-junit /var/www/html/var/logs/phpunit.xml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --coverage-clover /var/www/html/var/logs/clover_coverage.xml
</span></span></code></pre></div><p>jenkinsRunTests.sh</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#204a87>set</span> -x -o errexit -o pipefail
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker build -t project-test <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>PWD</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>/docker/test&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run -i --rm <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -v <span style=color:#4e9a06>&#34;</span><span style=color:#4e9a06>${</span><span style=color:#000>PWD</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>:/var/www/html/&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  -w /var/www/html/ <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  project-test <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  runTests.sh
</span></span></code></pre></div><p>Then the sh directive becomes simply</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;jenkinsRunTests.sh&#39;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ecd6072e7af2bd4a197a1087baeb6c77>1.3.1.7 - Annotated Jenkinsfiles - Part 3</h1><div class=lead>Additional Jenkinsfile pattern examples</div><h2 id=1-introduction>1. Introduction</h2><p>This build will:</p><ul><li>pull/build/push docker image used to generate project files</li><li>lint</li><li>run Unit tests with coverage</li><li>build the SPA</li><li>run accessibility tests</li><li>build story book and deploy it</li><li>deploy spa on s3 bucket and refresh cloudflare cache</li></ul><p>It allows to build for production and qa stages allowing different instances. Every build contains:</p><ul><li>a summary of the build<ul><li>git branch</li><li>git revision</li><li>target environment</li></ul></li><li>all the available Urls:<ul><li>spa url</li><li>storybook url</li></ul></li></ul><h2 id=2-annotated-jenkinsfile>2. Annotated Jenkinsfile</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>// anonymized parameters
</span></span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>credentialsId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;jenkinsCredentialId&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>lib</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>library</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>identifier:</span> <span style=color:#4e9a06>&#39;jenkins_library@v1.0&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>retriever:</span> <span style=color:#000>modernSCM</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>    <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;GitSCMSource&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>remote:</span> <span style=color:#4e9a06>&#39;git@github.com:fchastanet/jenkins-library.git&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>credentialsId:</span> <span style=color:#000>credentialsId</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>docker</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>git</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mail</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Mail</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>utils</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Utils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>cloudflare</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Cloudflare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// anonymized parameters
</span></span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>CLOUDFLARE_ZONE_ID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cloudflareZoneId&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>CLOUDFLARE_ZONE_ID_PROD</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;cloudflareZoneIdProd&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>REGISTRY_ID_QA</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;dockerRegistryId&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>REACT_APP_PENDO_API_KEY</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;pendoApiKey&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>REGISTRY_QA</span>  <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>REGISTRY_ID_QA</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.dkr.ecr.us-east-1.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>IMAGE_NAME_SPA</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;project-ui&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>STAGING_API_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;https://api.host&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>INSTANCE_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;https://${params.instanceName}.host&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>REACT_APP_API_BASE_URL_PROD</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;https://ui.host&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>REACT_APP_PENDO_SOURCE_DOMAIN</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;https://cdn.eu.pendo.io&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>buildBucketPrefix</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>S3_PUBLIC_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;qa-spa.s3.amazonaws.com/project&#39;</span>
</span></span><span style=display:flex><span><span style=color:#000>String</span> <span style=color:#000>S3_PROD_PUBLIC_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;spa.s3.amazonaws.com/project&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>instanceChoices</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>..</span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>collect</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#4e9a06>&#39;project&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>it</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>Map</span> <span style=color:#000>buildInfo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>apiUrl:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>storyBookAvailable:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>storyBookUrl:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>storyBookDocsUrl:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>spaAvailable:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>spaUrl:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>instanceName:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// add information on summary page
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>addBuildInfo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>deployInfo</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>spaAvailable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>String</span> <span style=color:#000>formatInstanceName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instanceName</span> <span style=color:#ce5c00;font-weight:700>?</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34; (${buildInfo.instanceName})&#34;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deployInfo</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#4e9a06>&#34;&lt;a href=&#39;${buildInfo.spaUrl}&#39;&gt;SPA${formatInstanceName}&lt;/a&gt;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>storyBookAvailable</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deployInfo</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#4e9a06>&#34; / &lt;a href=&#39;${buildInfo.storyBookUrl}&#39;&gt;Storybook&lt;/a&gt;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>deployInfo</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#4e9a06>&#34; / &lt;a href=&#39;${buildInfo.storyBookDocsUrl}&#39;&gt;Storybook docs&lt;/a&gt;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>summaryHtml</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &lt;b&gt;branch : &lt;/b&gt;${GIT_BRANCH}&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &lt;b&gt;revision : &lt;/b&gt;${GIT_COMMIT}&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    &lt;b&gt;target env : &lt;/b&gt;${params.targetEnv}&lt;br/&gt;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    ${deployInfo}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>removeHtmlBadges</span> <span style=color:#f57900>id:</span> <span style=color:#4e9a06>&#34;htmlBadge${currentBuild.number}&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addHtmlBadge</span> <span style=color:#f57900>html:</span> <span style=color:#000>summaryHtml</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>id:</span> <span style=color:#4e9a06>&#34;htmlBadge${currentBuild.number}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// this image has the features docker and lighthouse
</span></span></span><span style=display:flex><span>      <span style=color:#000>label</span> <span style=color:#4e9a06>&#39;docker-base-ubuntu-lighthouse&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>parameters</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>gitParameter</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>branchFilter:</span> <span style=color:#4e9a06>&#39;origin/(.*)&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>defaultValue:</span> <span style=color:#4e9a06>&#39;main&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>quickFilterEnabled:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>sortMode:</span> <span style=color:#4e9a06>&#39;ASCENDING_SMART&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;BRANCH&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>type:</span> <span style=color:#4e9a06>&#39;PT_BRANCH&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>choice</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;targetEnv&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>choices:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;testing&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;production&#39;</span><span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Where it should be deployed to? (Default: none - No deploy)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>booleanParam</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;buildStorybook&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>defaultValue:</span> <span style=color:#204a87;font-weight:700>false</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Build Storybook (will only apply if selected targetEnv is testing)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>choice</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;instanceName&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>choices:</span> <span style=color:#000>instanceChoices</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Instance name to deploy the revision&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Build SPA image&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// set build status to pending on github commit
</span></span></span><span style=display:flex><span>          <span style=color:#000>step</span><span style=color:#ce5c00;font-weight:700>([</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;GitHubSetCommitStatusBuilder&#39;</span><span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span>          <span style=color:#000>wrap</span><span style=color:#ce5c00;font-weight:700>([</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;BuildUser&#39;</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#${currentBuild.number}_${BRANCH}_${BUILD_USER}_${targetEnv}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#000>branchName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTagCompatibleFromBranch</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>shortSha</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getShortCommitSha</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;production&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildBucketPrefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>GIT_COMMIT</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>apiUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>REACT_APP_API_BASE_URL_PROD</span>
</span></span><span style=display:flex><span>            <span style=color:#000>s3BaseUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;s3://project-spa/project&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildBucketPrefix</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instanceName</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instanceName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instanceName</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>spaUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${INSTANCE_URL}/index.html&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>apiUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>STAGING_API_URL</span>
</span></span><span style=display:flex><span>            <span style=color:#000>s3BaseUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;s3://project-qa-spa/project&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>storyBookUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${INSTANCE_URL}/storybook/index.html&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>storyBookDocsUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${INSTANCE_URL}/storybook-docs/index.html&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#000>addBuildInfo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// Setup .env
</span></span></span><span style=display:flex><span>          <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            set -x
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            echo &#34;REACT_APP_API_BASE_URL = &#39;${buildInfo.apiUrl}&#39;&#34; &gt; ./.env
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            echo &#34;REACT_APP_PENDO_SOURCE_DOMAIN = &#39;${REACT_APP_PENDO_SOURCE_DOMAIN}&#39;&#34; &gt;&gt; ./.env
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            echo &#34;REACT_APP_PENDO_API_KEY = &#39;${REACT_APP_PENDO_API_KEY}&#39;&#34; &gt;&gt; ./.env
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#000>withCredentials</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>            <span style=color:#000>sshUserPrivateKey</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>credentialsId:</span> <span style=color:#4e9a06>&#39;sshCredentialsId&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>keyFileVariable:</span> <span style=color:#4e9a06>&#39;sshKeyFile&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>pullBuildPushImage</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>buildDirectory:</span>   <span style=color:#000>pwd</span><span style=color:#ce5c00;font-weight:700>(),</span>
</span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// use safer way to inject ssh key during docker build
</span></span></span><span style=display:flex><span>              <span style=color:#f57900>buildArgs:</span> <span style=color:#4e9a06>&#34;--ssh default=\$sshKeyFile --build-arg USER_ID=\$(id -u)&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>registryImageUrl:</span> <span style=color:#4e9a06>&#34;${REGISTRY_QA}/${IMAGE_NAME_SPA}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tagPrefix:</span>        <span style=color:#4e9a06>&#34;${IMAGE_NAME_SPA}:&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>localTagName:</span>     <span style=color:#4e9a06>&#34;latest&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#000>shortSha</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#000>branchName</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>pullTags:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;main&#39;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Linting&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          docker run --rm \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -v ${env.WORKSPACE}:/app \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -v /app/node_modules \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            ${IMAGE_NAME_SPA} \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            npm run lint
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;UT&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;docker run --rm  \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -v ${env.WORKSPACE}:/app \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            -v /app/node_modules \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            ${IMAGE_NAME_SPA} \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            npm run test:coverage -- --ci
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#000>junit</span> <span style=color:#4e9a06>&#39;output/junit.xml&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// https://plugins.jenkins.io/clover/
</span></span></span><span style=display:flex><span>          <span style=color:#000>step</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>            <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;CloverPublisher&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>cloverReportDir:</span> <span style=color:#4e9a06>&#39;output/coverage&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>cloverReportFileName:</span> <span style=color:#4e9a06>&#39;clover.xml&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#f57900>healthyTarget:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>methodCoverage:</span> <span style=color:#0000cf;font-weight:700>70</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>conditionalCoverage:</span> <span style=color:#0000cf;font-weight:700>70</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>statementCoverage:</span> <span style=color:#0000cf;font-weight:700>70</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// build will not fail but be set as unhealthy if coverage goes
</span></span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// below 60%
</span></span></span><span style=display:flex><span>            <span style=color:#f57900>unhealthyTarget:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>methodCoverage:</span> <span style=color:#0000cf;font-weight:700>60</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>conditionalCoverage:</span> <span style=color:#0000cf;font-weight:700>60</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>statementCoverage:</span> <span style=color:#0000cf;font-weight:700>60</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>// build will fail if coverage goes below 50%
</span></span></span><span style=display:flex><span>            <span style=color:#f57900>failingTarget:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>methodCoverage:</span> <span style=color:#0000cf;font-weight:700>50</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>conditionalCoverage:</span> <span style=color:#0000cf;font-weight:700>50</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>statementCoverage:</span> <span style=color:#0000cf;font-weight:700>50</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Build SPA&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            docker run --rm \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              -v ${env.WORKSPACE}:/app \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              -v /app/node_modules \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              ${IMAGE_NAME_SPA}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Accessibility tests&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// the pa11y-ci could have been made available in the node image
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// to avoid installation each time, the build is launched
</span></span></span><span style=display:flex><span>          <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            sudo npm install -g serve pa11y-ci
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            serve -s build &gt; /dev/null 2&gt;&amp;1 &amp;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            pa11y-ci --threshold 5 http://127.0.0.1:3000
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>          &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Build Storybook&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>          <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;testing&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>buildStorybook</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              docker run --rm \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                -v ${env.WORKSPACE}:/app \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                -v /app/node_modules \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                ${IMAGE_NAME_SPA} \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                sh -c &#39;npm run storybook:build -- --output-dir build/storybook \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  &amp;&amp; npm run storybook:build-docs -- --output-dir build/storybook-docs&#39;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>            &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>storyBookAvailable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Artifacts to S3&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;production&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>utils</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>initAws</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;arn:aws:iam::awsIamId:role/JenkinsSlave&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;aws s3 cp ${env.WORKSPACE}/build ${s3BaseUrl}/${buildBucketPrefix} --recursive --no-progress&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;aws s3 cp ${env.WORKSPACE}/build ${s3BaseUrl}/project1 --recursive --no-progress&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;production&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>echo</span> <span style=color:#4e9a06>&#39;project SPA packages have been pushed to production bucket.&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>echo</span> <span style=color:#4e9a06>&#39;&#39;&#39;You can refresh the production indexes with the CD
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              production pipeline.&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>cloudflare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>zonePurge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>CLOUDFLARE_ZONE_ID_PROD</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#f57900>prefixes:</span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${S3_PROD_PUBLIC_URL}/project1/&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>]])</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>cloudflare</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>zonePurge</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>CLOUDFLARE_ZONE_ID</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#f57900>prefixes:</span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${S3_PUBLIC_URL}/${buildBucketPrefix}/&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>]])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>              <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>spaAvailable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>              <span style=color:#000>publishChecks</span> <span style=color:#f57900>detailsURL:</span> <span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>spaUrl</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;projectSpaUrl&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#f57900>title:</span> <span style=color:#4e9a06>&#39;project SPA url&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>addBuildInfo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>buildInfo</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>post</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>always</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateConditionalGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000>mail</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sendConditionalEmail</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-55c3c60a9f370d11db633ac258e1ebdc>1.3.1.8 - Annotated Jenkinsfiles - Part 4</h1><div class=lead>Complex Jenkinsfile scenarios</div><h2 id=1-introduction>1. introduction</h2><p>The project aim is to create a browser extension available on chrome and firefox</p><p>This build allows to:</p><ul><li>lint the project using megalinter and phpstorm inspection</li><li>build necessary docker images</li><li>build firefox and chrome extensions</li><li>deploy firefox extension on s3 bucket</li><li>deploy chrome extension on google play store</li></ul><h2 id=2-annotated-jenkinsfile>2. Annotated Jenkinsfile</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>credentialsId</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;jenkinsSshCredentialsId&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>lib</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>library</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>identifier:</span> <span style=color:#4e9a06>&#39;jenkins_library&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#f57900>retriever:</span> <span style=color:#000>modernSCM</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>        <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;GitSCMSource&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>remote:</span> <span style=color:#4e9a06>&#39;git@github.com:fchastanet/jenkins-library.git&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>credentialsId:</span> <span style=color:#000>credentialsId</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>docker</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>git</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mail</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>lib</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>fchastanet</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Mail</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>new</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>deploymentBranchTagCompatible</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>gitShortSha</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>REGISTRY_URL</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;dockerRegistryId.dkr.ecr.eu-west-1.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>ECR_BROWSER_EXTENSION_BUILD</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;browser_extension_lint&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>BUILD_TAG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;build&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>PHPSTORM_TAG</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;phpstorm-inspections&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>REFERENCE_JOB_NAME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;Browser_extension_deploy&#39;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>FIREFOX_S3_BUCKET</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;browser-extensions&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// it would have been easier to use checkboxes to avoid &#39;both&#39;/&#39;none&#39;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// complexity
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>DEPLOY_CHROME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetStore</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;both&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetStore</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;chrome&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>DEPLOY_FIREFOX</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetStore</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;both&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetStore</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;firefox&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>label</span> <span style=color:#4e9a06>&#39;docker-base-ubuntu&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>parameters</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>gitParameter</span> <span style=color:#f57900>branchFilter:</span> <span style=color:#4e9a06>&#39;origin/(.*)&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>defaultValue:</span> <span style=color:#4e9a06>&#39;master&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>quickFilterEnabled:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>sortMode:</span> <span style=color:#4e9a06>&#39;ASCENDING_SMART&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;BRANCH&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>type:</span> <span style=color:#4e9a06>&#39;PT_BRANCH&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>choice</span> <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;targetStore&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>choices:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;both&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;chrome&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;firefox&#39;</span><span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Where it should be deployed to? (Default: none, has effect only on master branch)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>environment</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>GOOGLE_CREDS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>credentials</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;GoogleApiChromeExtension&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>GOOGLE_TOKEN</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>credentials</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;GoogleApiChromeExtensionCode&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>GOOGLE_APP_ID</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;googleAppId&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// provided by https://addons.mozilla.org/en-US/developers/addon/api/key/
</span></span></span><span style=display:flex><span>    <span style=color:#000>FIREFOX_CREDS</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>credentials</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;MozillaApiFirefoxExtension&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>FIREFOX_APP_ID</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;{d4ce8a6f-675a-4f74-b2ea-7df130157ff4}&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Init&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>deploymentBranchTagCompatible</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getTagCompatibleFromBranch</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>gitShortSha</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getShortCommitSha</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Branch ${env.GIT_BRANCH}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Docker tag = ${deploymentBranchTagCompatible}&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;git short sha = ${gitShortSha}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;echo StrictHostKeyChecking=no &gt;&gt; ~/.ssh/config&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Lint&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>docker</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>image</span> <span style=color:#4e9a06>&#39;megalinter/megalinter-javascript:v5&#39;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>args</span> <span style=color:#4e9a06>&#34;-u root -v ${WORKSPACE}:/tmp/lint --entrypoint=&#39;&#39;&#34;</span>
</span></span><span style=display:flex><span>          <span style=color:#000>reuseNode</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;npm install stylelint-config-rational-order&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>sh</span> <span style=color:#4e9a06>&#39;/entrypoint.sh&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Build docker images&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// whenOrSkip directive is defined in https://github.com/fchastanet/jenkins-library/blob/master/vars/whenOrSkip.groovy
</span></span></span><span style=display:flex><span>        <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentResult</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;SUCCESS&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>docker</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>pullBuildPushImage</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>buildDirectory:</span>   <span style=color:#4e9a06>&#39;build&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>registryImageUrl:</span> <span style=color:#4e9a06>&#34;${REGISTRY_URL}/${ECR_BROWSER_EXTENSION_BUILD}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tagPrefix:</span>        <span style=color:#4e9a06>&#34;${ECR_BROWSER_EXTENSION_BUILD}:&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${BUILD_TAG}_${gitShortSha}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${BUILD_TAG}_${deploymentBranchTagCompatible}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>pullTags:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;${BUILD_TAG}_master&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Build firefox/chrome extensions&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentResult</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;SUCCESS&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                docker run \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  -v \$(pwd):/deploy \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  --rm &#39;${ECR_BROWSER_EXTENSION_BUILD}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  /deploy/build/build-extensions.sh
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>              &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// multiple git statuses can be set on a given commit
</span></span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// you can configure github to authorize pull request merge
</span></span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// based on the presence of one or more github statuses
</span></span></span><span style=display:flex><span>              <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;BUILD_OK&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Deploy extensions&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#8f5902;font-style:italic>// deploy both extensions in parallel
</span></span></span><span style=display:flex><span>      <span style=color:#000>parallel</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Deploy chrome&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentResult</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;SUCCESS&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>DEPLOY_CHROME</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// do not fail the entire build if this stage fail
</span></span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// so firefox stage can be executed
</span></span></span><span style=display:flex><span>              <span style=color:#000>catchError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#f57900>buildResult:</span> <span style=color:#4e9a06>&#39;SUCCESS&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>stageResult:</span> <span style=color:#4e9a06>&#39;FAILURE&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                  <span style=color:#8f5902;font-style:italic>// best practice: complex sh files have been created outside
</span></span></span><span style=display:flex><span>                  <span style=color:#8f5902;font-style:italic>// of this jenkinsfile deploy-chrome-extension.sh
</span></span></span><span style=display:flex><span>                  <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  docker run \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -v \$(pwd):/deploy \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e APP_CREDS_USR=&#39;${GOOGLE_CREDS_USR}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e APP_CREDS_PSW=&#39;${GOOGLE_CREDS_PSW}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e APP_TOKEN=&#39;${GOOGLE_APP_TOKEN}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e APP_ID=&#39;${GOOGLE_APP_ID}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      --rm &#39;${ECR_BROWSER_EXTENSION_BUILD}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      /deploy/build/deploy-chrome-extension.sh
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;CHROME_DEPLOYED&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Deploy firefox&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>whenOrSkip</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>currentResult</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;SUCCESS&#34;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>DEPLOY_FIREFOX</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>catchError</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#f57900>buildResult:</span> <span style=color:#4e9a06>&#39;SUCCESS&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>stageResult:</span> <span style=color:#4e9a06>&#39;FAILURE&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                  <span style=color:#8f5902;font-style:italic>// best practice: complex sh files have been created outside
</span></span></span><span style=display:flex><span>                  <span style=color:#8f5902;font-style:italic>// of this jenkinsfile deploy-firefox-extension.sh
</span></span></span><span style=display:flex><span>                  <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    docker run \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -v \$(pwd):/deploy \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e FIREFOX_JWT_ISSUER=&#39;${FIREFOX_CREDS_USR}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e FIREFOX_JWT_SECRET=&#39;${FIREFOX_CREDS_PSW}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      -e FIREFOX_APP_ID=&#39;${FIREFOX_APP_ID}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      --rm &#39;${ECR_BROWSER_EXTENSION_BUILD}&#39; \
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                      /deploy/build/deploy-firefox-extension.sh
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000>sh</span> <span style=color:#4e9a06>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    set -x
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    set -o errexit
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    extensionVersion=&#34;\$(jq -r .version &lt; package.json)&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    extensionFilename=&#34;tools-\${extensionVersion}-an+fx.xpi&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    echo &#34;Upload new extension \${extensionFilename} to s3 bucket ${FIREFOX_S3_BUCKET}&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3 cp &#34;\$(pwd)/packages/\${extensionFilename}&#34; &#34;s3://${FIREFOX_S3_BUCKET}&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3api put-object-acl --bucket &#34;${FIREFOX_S3_BUCKET}&#34; --key &#34;\${extensionFilename}&#34; --acl public-read
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    # url is https://tools.s3.eu-west-1.amazonaws.com/tools-2.5.6-an%2Bfx.xpi
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    echo &#34;Upload new version as current version&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3 cp &#34;\$(pwd)/packages/\${extensionFilename}&#34; &#34;s3://${FIREFOX_S3_BUCKET}/tools-an+fx.xpi&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3api put-object-acl --bucket &#34;${FIREFOX_S3_BUCKET}&#34; --key &#34;tools-an+fx.xpi&#34; --acl public-read
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    # url is https://tools.s3.eu-west-1.amazonaws.com/tools-an%2Bfx.xpi
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    echo &#34;Upload updates.json file&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3 cp &#34;\$(pwd)/packages/updates.json&#34; &#34;s3://${FIREFOX_S3_BUCKET}&#34;
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    aws s3api put-object-acl --bucket &#34;${FIREFOX_S3_BUCKET}&#34; --key &#34;updates.json&#34; --acl public-read
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                    # url is https://tools.s3.eu-west-1.amazonaws.com/updates.json
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;FIREFOX_DEPLOYED&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>post</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>always</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>archiveArtifacts</span> <span style=color:#f57900>artifacts:</span> <span style=color:#4e9a06>&#39;report/mega-linter.log&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>archiveArtifacts</span> <span style=color:#f57900>artifacts:</span> <span style=color:#4e9a06>&#39;report/linters_logs/*&#39;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>archiveArtifacts</span> <span style=color:#f57900>artifacts:</span> <span style=color:#4e9a06>&#39;packages/*&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>fingerprint:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>allowEmptyArchive:</span> <span style=color:#204a87;font-weight:700>true</span>
</span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// send email to the builder and culprits of the current commit
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic>// culprits are the committers since the last commit successfully built
</span></span></span><span style=display:flex><span>        <span style=color:#000>mail</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sendConditionalEmail</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#000>git</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateConditionalGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>success</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetStore</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;none&#39;</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;origin/master&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// send an email to a teams channel so every collaborators knows
</span></span></span><span style=display:flex><span>          <span style=color:#8f5902;font-style:italic>// when a production ready extension has been deployed
</span></span></span><span style=display:flex><span>          <span style=color:#000>mail</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sendSuccessfulEmail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;teamsChannelId.onmicrosoft.com@amer.teams.ms&#39;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-e4ae12237c39b5f0feb5a0e7e96b8e95>1.3.1.9 - Annotated Jenkinsfiles - Part 5</h1><div class=lead>Advanced Jenkinsfile techniques</div><h2 id=1-introduction>1. introduction</h2><p>In jenkins library you can create your own directive that allows to generate jenkinsfile code. Here we will use this
feature to generate a complete Jenkinsfile.</p><h2 id=2-annotated-jenkinsfile>2. Annotated Jenkinsfile</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>library</span> <span style=color:#f57900>identifier:</span> <span style=color:#4e9a06>&#39;jenkins_library@v1.0&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#f57900>retriever:</span> <span style=color:#000>modernSCM</span><span style=color:#ce5c00;font-weight:700>([</span>
</span></span><span style=display:flex><span>      <span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;GitSCMSource&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>remote:</span> <span style=color:#4e9a06>&#39;git@github.com:fchastanet/jenkins-library.git&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#f57900>credentialsId:</span> <span style=color:#4e9a06>&#39;jenkinsCredentialsId&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>djangoApiPipeline</span> <span style=color:#f57900>repoUrl:</span> <span style=color:#4e9a06>&#39;git@github.com:fchastanet/django_api_project.git&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#f57900>imageName:</span> <span style=color:#4e9a06>&#39;django_api&#39;</span>
</span></span></code></pre></div><h2 id=3-annotated-library-custom-directive>3. Annotated library custom directive</h2><p>In the jenkins library just add a file named <code>vars/djangoApiPipeline.groovy</code> with the following content</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env groovy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>call</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// content of your pipeline
</span></span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=4-annotated-library-custom-directive-djangoapipipelinegroovy>4. Annotated library custom directive djangoApiPipeline.groovy</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>#!/usr/bin/env groovy</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>call</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Map</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>gitUtil</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Git</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>mailUtil</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Mail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>dockerUtil</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Docker</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>kubernetesUtil</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Kubernetes</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>testUtil</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Tests</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>this</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>workerLabelNonProd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>workerLabelNonProd</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#4e9a06>&#39;eks-nonprod&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>workerLabelProd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>workerLabelProd</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#4e9a06>&#39;docker-ubuntu-prod-eks&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>awsRegionNonProd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>workerLabelNonProd</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;eks-nonprod&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#4e9a06>&#39;us-east-1&#39;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;eu-west-1&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>awsRegionProd</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;eu-central-1&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>regionName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;prod&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#000>awsRegionProd</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>awsRegionNonProd</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>teamsEmail</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>teamsEmail</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#4e9a06>&#39;teamsChannel.onmicrosoft.com@amer.teams.ms&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>String</span> <span style=color:#000>helmDirectory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>helmDirectory</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#4e9a06>&#39;./helm&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Boolean</span> <span style=color:#000>sendCortexMetrics</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>sendCortexMetrics</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Boolean</span> <span style=color:#000>skipTests</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>skipTests</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#204a87;font-weight:700>false</span>
</span></span><span style=display:flex><span>  <span style=color:#000>List</span> <span style=color:#000>environments</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>environments</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;none&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;qa&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;prod&#39;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Short</span> <span style=color:#000>skipBuild</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>pipeline</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>agent</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>node</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>label</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;prod&#39;</span> <span style=color:#ce5c00;font-weight:700>?</span> <span style=color:#000>workerLabelProd</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>workerLabelNonProd</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>parameters</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>gitParameter</span> <span style=color:#f57900>branchFilter:</span> <span style=color:#4e9a06>&#39;origin/(.*)&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#f57900>defaultValue:</span> <span style=color:#4e9a06>&#39;main&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#f57900>quickFilterEnabled:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#f57900>sortMode:</span> <span style=color:#4e9a06>&#39;ASCENDING_SMART&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;BRANCH&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                    <span style=color:#f57900>type:</span> <span style=color:#4e9a06>&#39;PT_BRANCH&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>choice</span> <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;targetEnv&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>choices:</span> <span style=color:#000>environments</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Where it should be deployed to? (Default: none - No deploy)&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>string</span> <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;instance&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>defaultValue:</span> <span style=color:#4e9a06>&#39;1&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;&#39;&#39;The instance ID to define which QA instance it should
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        be deployed to (Will only apply if targetEnv is qa). Default is 1 for
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        CK and 01 for Darwin&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>booleanParam</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;suspendCron&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>defaultValue:</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;Suspend cron jobs scheduling&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>choice</span> <span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>name:</span> <span style=color:#4e9a06>&#39;upStreamImage&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>choices:</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#39;latest&#39;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#39;beta&#39;</span><span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>        <span style=color:#f57900>description:</span> <span style=color:#4e9a06>&#39;&#39;&#39;Select beta to check if your build works with the
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        future version of the upstream image&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stages</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Checkout from SCM&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Checking out from origin/${BRANCH} branch&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>gitUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>branchCheckout</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#4e9a06>&#39;&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#4e9a06>&#39;babee6c1-14fe-4d90-9da0-ffa7068c69af&#39;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>repoUrl</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#4e9a06>&#39;${BRANCH}&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>wrap</span><span style=color:#ce5c00;font-weight:700>([</span><span style=color:#000>$class</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;BuildUser&#39;</span><span style=color:#ce5c00;font-weight:700>])</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>String</span> <span style=color:#000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;#${currentBuild.number}_${BRANCH}_${BUILD_USER}_${targetEnv}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>              <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;qa&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;qe&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${displayName}_${instance}&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>              <span style=color:#000>currentBuild</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>displayName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>displayName</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>BUILD_TAG</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>toLowerCase</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>            <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>buildDirectory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>buildDirectory</span> <span style=color:#ce5c00;font-weight:700>?</span>
</span></span><span style=display:flex><span>              <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>buildDirectory</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;/&#34;</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>runCoverage</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>runCoverage</span>
</span></span><span style=display:flex><span>            <span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>shortSha</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>gitUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getShortCommitSha</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>env</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>GIT_BRANCH</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>skipBuild</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>dockerUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>checkImage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>shortSha</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Build&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>skipBuild</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>registryUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;dockerRegistryId.dkr.ecr.&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>              <span style=color:#000>awsRegionNonProd</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>String</span> <span style=color:#000>buildDirectory</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>?.</span><span style=color:#c4a000>buildDirectory</span> <span style=color:#ce5c00;font-weight:700>?:</span> <span style=color:#000>pwd</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;prod&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>registryUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;dockerRegistryId.dkr.ecr.&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>awsRegionProd</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>dockerUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>pullBuildImage</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>registryImageUrl:</span> <span style=color:#4e9a06>&#34;${registryUrl}/${args.imageName}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>pullTags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${params.targetEnv}&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>buildDirectory:</span> <span style=color:#4e9a06>&#34;${buildDirectory}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>buildArgs:</span> <span style=color:#4e9a06>&#34;--build-arg UPSTREAM_VERSION=${params.upStreamImage}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tagPrefix:</span> <span style=color:#4e9a06>&#34;${env.imageName}:&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${env.shortSha}&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Test&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>skipBuild</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>skipTests</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#204a87;font-weight:700>false</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>testUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>execTests</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#39;Push&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;none&#39;</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#8f5902;font-style:italic>//pipeline execution starting time for CD part
</span></span></span><span style=display:flex><span>            <span style=color:#000>Map</span> <span style=color:#000>argsMap</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[:]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;prod&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>registryUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;registryIdProd.dkr.ecr.&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>                <span style=color:#000>awsRegionProd</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>registryUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#39;registryIdNonProd.dkr.ecr.&#39;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>                <span style=color:#000>awsRegionNonProd</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;.amazonaws.com&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#000>argsMap</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>registryImageUrl:</span> <span style=color:#4e9a06>&#34;${registryUrl}/${args.imageName}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>pullTags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${env.shortSha}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>],</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tagPrefix:</span> <span style=color:#4e9a06>&#34;${registryUrl}/${args.imageName}:&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>localTagName:</span> <span style=color:#4e9a06>&#34;${env.shortSha}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>tags:</span> <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;${params.targetEnv}&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>skipBuild</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>dockerUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>promoteTag</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>argsMap</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>argsMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>remove</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;pullTags&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#000>argsMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;tagPrefix&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;${env.imageName}:&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#000>argsMap</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>put</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;tags&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;${env.shortSha}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span><span style=color:#4e9a06>&#34;${params.targetEnv}&#34;</span><span style=color:#ce5c00;font-weight:700>])</span>
</span></span><span style=display:flex><span>              <span style=color:#000>dockerUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>tagPushImage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>argsMap</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>stage</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Deploy to Kubernetes&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>when</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>expression</span> <span style=color:#ce5c00;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#39;none&#39;</span> <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>steps</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;prod&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// not sure it is a good practice as it forces the operator to
</span></span></span><span style=display:flex><span>              <span style=color:#8f5902;font-style:italic>// wait for build to reach this stage
</span></span></span><span style=display:flex><span>              <span style=color:#000>timeout</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#f57900>time:</span> <span style=color:#0000cf;font-weight:700>300</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#f57900>unit:</span> <span style=color:#4e9a06>&#34;SECONDS&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>input</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>                  <span style=color:#f57900>message:</span> <span style=color:#4e9a06>&#34;&#34;&#34;Do you want go ahead with ${env.shortSha}
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>                  image tag for prod helm deploy?&#34;&#34;&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                  <span style=color:#f57900>ok:</span> <span style=color:#4e9a06>&#39;Yes&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>CHART_NAME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>contains</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;_&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>?</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span><span style=color:#ce5c00;font-weight:700>).</span><span style=color:#c4a000>replaceAll</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;_&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-&#34;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>              <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>imageName</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;qa&#39;</span> <span style=color:#ce5c00;font-weight:700>||</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;qe&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>helmValueFilePath</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${helmDirectory}&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;/value_files/values-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>                <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instance</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;.yaml&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>NAMESPACE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${CHART_NAME}-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>instance</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>helmValueFilePath</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${helmDirectory}&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>                <span style=color:#4e9a06>&#34;/value_files/values-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;.yaml&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#000>NAMESPACE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;${CHART_NAME}-&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#000>ingressUrl</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>kubernetesUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getIngressUrl</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>helmValueFilePath</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Deploying into k8s..&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Helm release: ${CHART_NAME}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Target env: ${params.targetEnv}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;Url: ${ingressUrl}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>echo</span> <span style=color:#4e9a06>&#34;K8s namespace: ${NAMESPACE}&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#000>kubernetesUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>deployHelmChart</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>chartName:</span> <span style=color:#000>CHART_NAME</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>nameSpace:</span> <span style=color:#000>NAMESPACE</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>imageTag:</span> <span style=color:#4e9a06>&#34;${env.shortSha}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>helmDirectory:</span> <span style=color:#4e9a06>&#34;${helmDirectory}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>              <span style=color:#f57900>helmValueFilePath:</span> <span style=color:#000>helmValueFilePath</span>
</span></span><span style=display:flex><span>            <span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>post</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>always</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>script</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#000>gitUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>updateGithubCommitStatus</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;${currentBuild.currentResult}&#34;</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#4e9a06>&#34;${env.WORKSPACE}&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#000>mailUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sendConditionalEmail</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>params</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>targetEnv</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#39;prod&#39;</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>              <span style=color:#000>mailUtil</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>sendTeamsNotification</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>teamsEmail</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>          <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=5-final-thoughts-about-this-technique>5. Final thoughts about this technique</h2><p>This technique is really useful when you have a lot of similar projects reusing over and over the same pipeline. It
allows:</p><ul><li>code reuse</li><li>avoid duplicated code</li><li>easier maintenance</li></ul><p>However it has the following drawbacks:</p><ul><li>some projects using this generic pipeline could have specific needs<ul><li>eg 1: not the same way to run unit tests, to overcome that issue the method <code>testUtil.execTests</code> is used allowing to
run a specific sh file if it exists</li><li>eg 2: more complex way to launch docker environment</li><li>&mldr;</li></ul></li><li><strong>be careful</strong>, when you upgrade this jenkinsfile as all the projects using it will be upgraded at once<ul><li>it could be seen as an advantage, but it is also a big risk as it could impact all the prod environment at once</li><li>to overcome that issue I suggest to use library versioning when using the jenkins library in your project pipeline
Eg: check <a href=#2-annotated-jenkinsfile>Annotated Jenkinsfile</a> <code>@v1.0</code> when cloning library project</li></ul></li><li>I highly suggest to use a unit test framework of the library to avoid at most bad surprises</li></ul><p>In conclusion, I&rsquo;m still not sure it is a best practice to generate pipelines like this.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-495ca42bdd947744d65cf04377598dfb>1.3.1.10 - Jenkins Recipes and Tips</h1><div class=lead>Common recipes and troubleshooting tips</div><ul><li><a href=#1-jenkins-snippet-generator>1. Jenkins snippet generator</a></li><li><a href=#2-declarative-pipeline-allows-you-to-restart-a-build-from-a-given-stage>2. Declarative pipeline allows you to restart a build from a given stage</a></li><li><a href=#3-replay-a-pipeline>3. Replay a pipeline</a></li><li><a href=#4-vs-code-jenkinsfile-validation>4. VS code Jenkinsfile validation</a></li><li><a href=#5-how-to-chain-pipelines->5. How to chain pipelines ?</a></li><li><a href=#6-viewing-pipelines-hierarchy>6. Viewing pipelines hierarchy</a></li></ul><h2 id=1-jenkins-snippet-generator>1. Jenkins snippet generator</h2><p>Use jenkins snippet generator by adding <code>/pipeline-syntax/</code> to your jenkins pipeline. to allow you to generate jenkins
pipeline code easily with inline doc. It also list the available variables.</p><p><img src=images/snippetGenerator.png alt="jenkins snippet generator"></p><h2 id=2-declarative-pipeline-allows-you-to-restart-a-build-from-a-given-stage>2. Declarative pipeline allows you to restart a build from a given stage</h2><p><img src=images/restartFromStage.png alt="restart from stage"></p><h2 id=3-replay-a-pipeline>3. Replay a pipeline</h2><p>Replaying a pipeline allows you to update your jenkinsfile before replaying the pipeline, easier debugging !
<img src=images/replayPipeline.png alt="replay a pipeline"></p><h2 id=4-vs-code-jenkinsfile-validation>4. VS code Jenkinsfile validation</h2><p>Please follow this documentation
<a href=https://github.com/fchastanet/coding_dojo_jenkins/blob/master/Exercise03%20-%20Full%20pipeline.md#step-01b---enable-jenkins-pipeline-linter-in-vscode>enable jenkins pipeline linter in vscode</a></p><h2 id=5-how-to-chain-pipelines->5. How to chain pipelines ?</h2><p>Simply use the <code>build</code> directive followed by the name of the build to launch</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-groovy data-lang=groovy><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>build</span> <span style=color:#4e9a06>&#39;OtherBuild&#39;</span>
</span></span></code></pre></div><h2 id=6-viewing-pipelines-hierarchy>6. Viewing pipelines hierarchy</h2><p>The <a href=https://plugins.jenkins.io/downstream-buildview/>downstream-buildview plugin</a> allows to view the full chain of
dependent builds.</p><p><img src=https://raw.githubusercontent.com/jenkins-infra/plugins-wiki-docs/master/downstream-buildview/docs/images/downstream-buildview_screen1.JPG alt="Jenkins Downstream Build Pipeline Visualization"></p></div><div class=td-content style=page-break-before:always><h1 id=pg-090e63d808738fe249c3bc67d33ff933>1.3.2 - How to Write Dockerfiles</h1><div class=lead>Best practices for writing efficient and secure Dockerfiles</div><ul><li><a href=#1-dockerfile-best-practices>1. Dockerfile best practices</a></li><li><a href=#2-basic-best-practices>2. Basic best practices</a><ul><li><a href=#21-best-practice-1-merge-the-image-layers>2.1. Best Practice #1: Merge the image layers</a><ul><li><a href=#211-bad-practice-1>2.1.1. Bad practice #1</a></li><li><a href=#212-best-practice-1>2.1.2. Best practice #1</a></li></ul></li><li><a href=#22-best-practice-2-trace-commands-and-fail-on-error>2.2. Best Practice #2: trace commands and fail on error</a><ul><li><a href=#221-bad-practice-2>2.2.1. Bad practice #2</a></li><li><a href=#222-best-practice-2>2.2.2. Best Practice #2</a></li></ul></li><li><a href=#23-best-practice-3-packages-ordering-and-versions>2.3. Best practice #3: packages ordering and versions</a><ul><li><a href=#231-bad-practice-3>2.3.1. Bad practice #3</a></li><li><a href=#232-best-practice-3>2.3.2. Best Practice #3</a><ul><li><a href=#2321-order-packages-alphabetically-and-one-package-by-line>2.3.2.1. Order packages alphabetically and one package by line</a></li><li><a href=#2322-always-specify-packages-versions>2.3.2.2. Always specify packages versions</a></li><li><a href=#2323-ensure-non-interactive>2.3.2.3. Ensure non interactive</a></li></ul></li></ul></li><li><a href=#24-best-practice-4-ensure-image-receives-latest-security-updates>2.4. Best practice #4: ensure image receives latest security updates</a><ul><li><a href=#241-bad-practice-4>2.4.1. Bad practice #4</a></li><li><a href=#242-best-practice-4>2.4.2. Best Practice #4</a></li></ul></li><li><a href=#25-conclusion-image-size-comparison>2.5. Conclusion: image size comparison</a><ul><li><a href=#251-dockerfile-without-best-practices>2.5.1. Dockerfile without best practices</a></li><li><a href=#252-dockerfile-with-all-optimizations>2.5.2. Dockerfile with all optimizations</a></li></ul></li></ul></li><li><a href=#3-docker-buildx-best-practices>3. Docker Buildx best practices</a><ul><li><a href=#31-optimize-image-size>3.1. Optimize image size</a><ul><li><a href=#311-dockerfile-not-optimized>3.1.1. Dockerfile not optimized</a></li><li><a href=#312-dockerfile-optimized>3.1.2. Dockerfile optimized</a></li></ul></li></ul></li></ul><h2 id=1-dockerfile-best-practices>1. Dockerfile best practices</h2><p>Follow <a href=https://docs.docker.com/develop/develop-images/dockerfile_best-practices/>official best practices</a> and you can
follow these specific best practices</p><ul><li><p>But <a href=https://pythonspeed.com/articles/security-updates-in-docker/>The worst so-called “best practice” for Docker</a></p><p><a href=/archives/TheWorstSoCalledBestPracticeForDocker.pdf>Backup</a>, explains why you should actually also use
<code>apt-get upgrade</code></p></li><li><p>Use <code>hadolint</code></p></li><li><p>Use <code>;\</code> to separate each command line</p><ul><li>some Dockerfiles are using <code>&&</code> to separate commands in the same RUN instruction (I was doing it too ;-), but I
strongly discourage it because it breaks the checks done by <code>set -o errexit</code></li><li><code>set -o errexit</code> makes the whole RUN instruction to fail if one of the commands has failed, but it is not the same
when using <code>&&</code></li></ul></li><li><p>One package by line, packages sorted alphabetically to ease readability and merges</p></li><li><p>Always specify the most exact version possible of your packages (to avoid to get major version that would break your
build or software)</p></li><li><p>do not usage docker image with latest tag, always specify the right version to use</p></li></ul><h2 id=2-basic-best-practices>2. Basic best practices</h2><h3 id=21-best-practice-1-merge-the-image-layers>2.1. Best Practice #1: Merge the image layers</h3><p>in a Dockerfile each RUN command will create an image layer.</p><h4 id=211-bad-practice-1>2.1.1. Bad practice #1</h4><p>Here a bad practice that you shouldn&rsquo;t follow</p><p><img src=HowTo-Write-Dockerfile-DockerCompose/images/dockerfileLayersBestPractices.png alt="avoid layer cache issue"></p><h4 id=212-best-practice-1>2.1.2. Best practice #1</h4><p><strong>Best practice #1</strong> merge the RUN layers to avoid cache issue and gain on total image size</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt-get install -y apache2 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=22-best-practice-2-trace-commands-and-fail-on-error>2.2. Best Practice #2: trace commands and fail on error</h3><p>from previous example we want to trace each command that is executed</p><h4 id=221-bad-practice-2>2.2.1. Bad practice #2</h4><p>when building complex layer and one of the command fails, it&rsquo;s interesting to know which command makes the build to fail</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#ce5c00;font-weight:700>[</span> -d badFolder <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> apt-get install -y apache2 <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><p><code>docker build .</code>  gives the following
<a href=HowTo-Write-Dockerfile-DockerCompose/badPractice2.log>log output(partly truncated)</a></p><p>Not easy here to know that the command <code>[ -d badFolder ]</code> makes the build failing</p><p>Without the best practice #2, the following code build successfully</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#204a87>set</span> -x <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>[</span> -d badFolder <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    ls -al<span style=color:#a40000>
</span></span></span></code></pre></div><h4 id=222-best-practice-2>2.2.2. Best Practice #2</h4><p><strong>Best Practice #2</strong>: Override SHELL options of the RUN command and use <code>;\</code> instead of <code>&&</code></p><p>The following options are set on the shell to override the default behavior:</p><ul><li><code>set -o pipefail</code>: The return status of a pipeline is the exit status of the last command, unless the pipefail option
is enabled.<ul><li>If pipefail is enabled, the pipeline&rsquo;s return status is the value of the last (rightmost) command to exit with a
non-zero status, or zero if all commands exit successfully.</li><li>without it, a command failure could be masked by the command piped after it</li></ul></li><li><code>set -o errexit</code> (same as <code>set -e</code>): Exit immediately if a pipeline (which may consist of a single simple command), a
list, or a compound command (see SHELL GRAMMAR above), exits with a non-zero status.</li><li><code>set -o xtrace</code>(same as <code>set -x</code>):  After  expanding  each  simple  command, for command, case command, select
command, or arithmetic for command, display the expanded value of PS4, followed by the command and its expanded
arguments or associated word list.</li></ul><p>Those options are not mandatory but are strongly advised. Although there are some workaround to know:</p><ul><li>if a command can fail and you want to ignore it, you can use<ul><li>commandThatCanFail || true</li></ul></li></ul><p><strong>These options can be used with /bin/sh as well.</strong></p><p>Also it is strongly advised to use <code>;\</code> to separate commands because it could happen that some errors are ignored when
<code>&&</code> is used in conjunction with <code>||</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># The SHELL instructions will be applied to all the subsequent RUN instructions</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>[</span> -d  badFolder <span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y apache2 <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><p><code>docker build .</code>  gives the following
<a href=HowTo-Write-Dockerfile-DockerCompose/bestPractice2.log>log output(partly truncated)</a></p><p>Here the command line displayed just above the error indicates <strong>clearly</strong> from where the error comes from:</p><pre tabindex=0><code class=language-log data-lang=log>#5 6.172 + &#39;[&#39; -d badFolder &#39;]&#39;
</code></pre><h3 id=23-best-practice-3-packages-ordering-and-versions>2.3. Best practice #3: packages ordering and versions</h3><p><strong>Best Practice #3</strong>: order packages alphabetically, always specify packages versions, ensure non interactive</p><p>From previous example we want to install several packages</p><h4 id=231-bad-practice-3>2.3.1. Bad practice #3</h4><p>let&rsquo;s add some packages on our previous example (errors removed)</p><p>The following docker has the following issues:</p><ul><li>it doesn&rsquo;t set the package versions</li><li>the installation will install also the recommended packages</li><li>it&rsquo;s using apt instead of apt-get (hadolint warning <a href=https://github.com/hadolint/hadolint/wiki/DL3027>DL3027</a> Do not
use apt as it is meant to be a end-user tool, use <code>apt-get</code> or <code>apt-cache</code> instead)</li><li>the packages are not ordered alphabetically</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt install -y php7.4 apache2 php7.4-curl redis-tools <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>          /usr/share/doc/*  <span style=color:#a40000>
</span></span></span></code></pre></div><h4 id=232-best-practice-3>2.3.2. Best Practice #3</h4><p><strong>Best Practice #3</strong>: order packages alphabetically, always specify packages versions, ensure non interactive</p><h5 id=2321-order-packages-alphabetically-and-one-package-by-line>2.3.2.1. Order packages alphabetically and one package by line</h5><p>one package by line allows packages to be simpler ordered alphabetically</p><p>one package by line and ordering alphabetically allows :</p><ul><li>to merge branches changes more easily</li><li>to detect redundancies more easily</li><li>to improve readability</li></ul><h5 id=2322-always-specify-packages-versions>2.3.2.2. Always specify packages versions</h5><p>over the time your build&rsquo;s dependencies could be updated on the remote repositories and your packages be unattended
upgraded to the latest version making your software breaks because it doesn&rsquo;t manage the changes of the new package.</p><p>It happens several times for me, for example, in 2021, xdebug has been automatically upgraded on one of my docker image
from version 2.8 to 3.0 making all the dev environments broken. It happens also on a build pipeline with a version of
npm gulp that has been upgraded to latest version. In both cases we resolved the issue by downgrading the version to the
one we were using.</p><h5 id=2323-ensure-non-interactive>2.3.2.3. Ensure non interactive</h5><p>some apt-get packages could ask for interactive questions, you can avoid this using the env variable
<code>DEBIAN_FRONTEND=noninteractive</code></p><p><strong>Note:</strong> ARG instruction allows to set env variable available only during build time</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Mind to use quotes to avoid shell to try to expand * with some files</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>        <span style=color:#000>apache2</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;2.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4-curl<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        <span style=color:#8f5902;font-style:italic># Notice the &#39;:&#39;(colon)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>        redis-tools<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;5:5.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># cleaning</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get -y clean <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># use the following command to know the current version of the packages</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># using another RUN instead of using previous one will avoid the whole</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># previous layer to be rebuilt</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># RUN apt-cache policy \</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># apache2 \</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># php7.4 \</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># php7.4-curl \</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># redis-tools</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Gives the following output</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.387 + apt-cache policy apache2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399 apache2:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399   Installed: 2.4.41-4ubuntu3.14</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399   Candidate: 2.4.41-4ubuntu3.14</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399   Version table:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399  *** 2.4.41-4ubuntu3.14 100</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.399         100 /var/lib/dpkg/status</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.400 + apt-cache policy php7.4</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409 php7.4:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409   Installed: 7.4.3-4ubuntu2.18</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409   Candidate: 7.4.3-4ubuntu2.18</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409   Version table:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409  *** 7.4.3-4ubuntu2.18 100</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409         100 /var/lib/dpkg/status</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.409 + apt-cache policy php7.4-curl</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.420 php7.4-curl:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.420   Installed: 7.4.3-4ubuntu2.18</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.420   Candidate: 7.4.3-4ubuntu2.18</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.420   Version table:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.420  *** 7.4.3-4ubuntu2.18 100</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.421         100 /var/lib/dpkg/status</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.421 + apt-cache policy redis-tools</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.431 redis-tools:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.431   Installed: 5:5.0.7-2ubuntu0.1</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.431   Candidate: 5:5.0.7-2ubuntu0.1</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.431   Version table:</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.431  *** 5:5.0.7-2ubuntu0.1 100</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#6 0.432         100 /var/lib/dpkg/status</span><span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=24-best-practice-4-ensure-image-receives-latest-security-updates>2.4. Best practice #4: ensure image receives latest security updates</h3><p>from previous example we want to ensure the image receives the latest security updates</p><h4 id=241-bad-practice-4>2.4.1. Bad practice #4</h4><p>registry image are not always updated and latest apt security updates are not installed</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        <span style=color:#000>apache2</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;2.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4-curl<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        redis-tools<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;5:5.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># cleaning</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get -y clean <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><h4 id=242-best-practice-4>2.4.2. Best Practice #4</h4><p>be sure to <a href=https://pythonspeed.com/articles/security-updates-in-docker/>apply latest security updates</a>, to install the
latest security updates in the image, keep sure to call <code>apt-get upgrade -y</code></p><p>Here the updated Dockerfile:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># be sure to apply latest security updates</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># https://pythonspeed.com/articles/security-updates-in-docker/</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get upgrade -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        <span style=color:#000>apache2</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;2.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4-curl<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        redis-tools<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;5:5.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># cleaning</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get -y clean <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><h3 id=25-conclusion-image-size-comparison>2.5. Conclusion: image size comparison</h3><p>from previous example we want to ensure the image receives the latest security updates</p><h4 id=251-dockerfile-without-best-practices>2.5.1. Dockerfile without best practices</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get install -y apache2 php7.4 php7.4-curl redis-tools<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># cleaning</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get -y clean <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><h4 id=252-dockerfile-with-all-optimizations>2.5.2. Dockerfile with all optimizations</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get upgrade -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        <span style=color:#000>apache2</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;2.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        php7.4-curl<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;7.4.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        redis-tools<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;5:5.*&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># cleaning</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get -y clean <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/lib/apt/lists/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /var/tmp/* <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        /usr/share/doc/*<span style=color:#a40000>
</span></span></span></code></pre></div><h2 id=3-docker-buildx-best-practices>3. Docker Buildx best practices</h2><h3 id=31-optimize-image-size>3.1. Optimize image size</h3><p>Source:
<a href=https://askubuntu.com/questions/628407/removing-man-pages-on-ubuntu-docker-installation>https://askubuntu.com/questions/628407/removing-man-pages-on-ubuntu-docker-installation</a></p><p>Let&rsquo;s consider this example</p><h4 id=311-dockerfile-not-optimized>3.1.1. Dockerfile not optimized</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage1</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        htop<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage1</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># here we just test that the ARG DEBIAN_FRONTEND has been inherited from</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># previous stage (it is the case)</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;DEBIAN_FRONTEND=</span><span style=color:#4e9a06>${</span><span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Now let&rsquo;s build and check the image size, the best way to do this is to export the image to a file</p><p><strong>docker build and save</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>docker build -f Dockerfile1 -t test1 .
</span></span><span style=display:flex><span>docker save test1 -o test1.tar
</span></span></code></pre></div><p>Now we will optimize this image by removing man pages (you can still find man pages on the web) and removing apt cache</p><h4 id=312-dockerfile-optimized>3.1.2. Dockerfile optimized</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>ubuntu:20.04</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage1</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>ARG</span> <span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#ce5c00;font-weight:700>=</span>noninteractive
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>COPY</span> 01-noDoc /etc/dpkg/dpkg.cfg.d/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>COPY</span> 02-aptNoCache /etc/apt/apt.conf.d/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># remove apt cache and man/doc</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    rm -rf /var/cache/apt/archives /usr/share/<span style=color:#ce5c00;font-weight:700>{</span>doc,man,locale<span style=color:#ce5c00;font-weight:700>}</span>/ <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get update <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    apt-get install -y -q --no-install-recommends <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>        htop <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic># clean apt packages</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span>    apt-get autoremove -y <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    ls -al /var/cache/apt <span style=color:#000;font-weight:700>;</span><span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/doc/*<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage1</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>as</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>stage2</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>SHELL</span> <span style=color:#000;font-weight:700>[</span><span style=color:#4e9a06>&#34;/bin/bash&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;pipefail&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;errexit&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-o&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;xtrace&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#34;-c&#34;</span><span style=color:#000;font-weight:700>]</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>    <span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;DEBIAN_FRONTEND=</span><span style=color:#4e9a06>${</span><span style=color:#000>DEBIAN_FRONTEND</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#34;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Here the content of <code>/etc/dpkg/dpkg.cfg.d/01-noDoc</code>, it will tell apt to not install man docs and translations</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-cfg data-lang=cfg><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># /etc/dpkg/dpkg.cfg.d/01_nodoc</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Delete locales</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>path-exclude</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/usr/share/locale/*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Delete man pages</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>path-exclude</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/usr/share/man/*</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Delete docs</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>path-exclude</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/usr/share/doc/*</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>path-include</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>/usr/share/doc/*/copyright</span>
</span></span></code></pre></div><p>Here the content of <code>/etc/apt/apt.conf.d/02-aptNoCache</code>, it will instruct apt to not store any cache (note that apt-get
clean will not work after that change but you don&rsquo;t need to use it anymore)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-cfg data-lang=cfg><span style=display:flex;background-color:#dfdfdf><span><span style=color:#c4a000>Dir::Cache &#34;&#34;;</span>
</span></span><span style=display:flex><span><span style=color:#c4a000>Dir::Cache::archives &#34;&#34;;</span>
</span></span></code></pre></div><p>Now let&rsquo;s build and check the image size, the best way to do this is to export the image to a file</p><p><strong>docker build and save</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>docker build -f Dockerfile2 -t test2 .
</span></span><span style=display:flex><span>docker save test2 -o test2.tar
</span></span></code></pre></div><p>Here the size of the files</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>test1.tar 117 020 672 bytes
</span></span><span style=display:flex><span>test2.tar  76 560 896 bytes
</span></span></code></pre></div><p>We passed from ~117MB to ~76MB so we gain ~41MB Please note also that we used <code>--no-install-recommends</code> option in both
example that allows us to save some other MB</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c004280a8f7cae5b8ff82b147b9cba34>1.3.3 - How to Write Docker Compose Files</h1><div class=lead>Guide to writing and organizing Docker Compose files</div><ul><li><a href=#1-platform>1. platform</a></li></ul><h2 id=1-platform>1. platform</h2><p>as not everyone is using the same environment (some are using MacOS for example which is targeting arm64 instead of
amd64), it is advised to add this option to target the right architecture</p><p><strong>docker-compose platform</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>services</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>serviceName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>platform</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>linux/x86_64</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># ...</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4621b07af9083218e5089816477f1d6d>1.3.4 - Saml2Aws Setup</h1><div class=lead>Guide to setting up and using Saml2Aws for AWS access</div><p>Configure saml2aws accounts</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>saml2aws configure <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --idp-account<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;account_alias&gt;&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --idp-provider<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;AzureAD&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --mfa<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;Auto&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --profile<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;profile&gt;&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --url<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;https://account.activedirectory.windowsazure.com&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --username<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;username&gt;@microsoft.com&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --app-id<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#39;&lt;app_id&gt;&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  --skip-prompt
</span></span></code></pre></div><ul><li><code>&lt;app_id></code> is a unique identifier for the application we want credentials for (in this case an AWS environment).</li><li><code>&lt;account_alias></code> serves as a name to identify the saml2aws configuration (see your ~/.saml2aws file</li><li><code>&lt;profile></code> serves as the name of the aws cli profile that will be created when you log in.</li></ul><p>This will automatically identify your tenant ID based on the AppID and will create a configuration based on the provided
information. Configuration will be created in ~/.saml2aws</p><h2 id=1-use-saml2aws-login-command-to-configure-the-aws-cli-profile>1. Use saml2aws login command to configure the AWS CLI profile</h2><p>Run saml2aws login to add or refresh your profile for the aws cli.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>saml2aws login -a <span style=color:#4e9a06>${</span><span style=color:#000>account_alias</span><span style=color:#4e9a06>}</span>
</span></span></code></pre></div><p>Follow the prompts to enter your SSO credentials and complete the multi-factor authentication step.</p><p>Note: if you are part of multiple roles you can use &ndash;role flag to configure the required role.</p><p>Above steps have been taken from below GitHub Repo. They have been tried in MacOS, Windows, Linux and Windows WSL
<a href=https://github.com/Versent/saml2aws>https://github.com/Versent/saml2aws</a></p><h2 id=2-kubernetes-connection>2. Kubernetes connection</h2><p>Adding a newly created Technology Convergence EKS cluster to your ~/.kube/config:</p><p>Add EKS Cluster to ~/.kube/config</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>aws eks update-kubeconfig --name <span style=color:#000>$clusterName</span> --region us-east-1
</span></span></code></pre></div><h2 id=3-common-issues>3. Common issues</h2><h3 id=31-error---error-authenticating-to-idp-unable-to-locate-idp-oidc-form-submit-url>3.1. Error - error authenticating to IdP: unable to locate IDP OIDC form submit URL</h3><p>This is very likely because you changed your account password. Reenter your password when prompted at saml2aws login</p><h3 id=32-error---error-authenticating-to-idp-unable-to-locate-samlrequest-url>3.2. Error - error authenticating to IdP: unable to locate SAMLRequest URL</h3><p>This is very likely because you do not have access to this AWS account.</p><p>Multifactor authentication asks for a number, but the terminal doesn&rsquo;t provide a number.</p><p><strong>Solution 1:</strong> We&rsquo;ve found that going to your
<a href=https://mysignins.microsoft.com/security-info>Microsoft account security info</a> and deleting and re-adding the sign-in
method seems to fix the issue. You should then be able to just enter a Time-based one-time password from your Microsoft
Authenticator app.</p><p><strong>Solution 2:</strong> You can change the MFA option for your saml2aws config either with PhoneAppOTP, PhoneAppNotification, or
OneWaySMS. Something like this in your ~/.saml2aws file</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>name          = tc-dev
</span></span><span style=display:flex><span>app_id         = 83cffb56-1d1b-400c-ad47-345c58e378dc
</span></span><span style=display:flex><span>url           = https://account.activedirectory.windowsazure.com
</span></span><span style=display:flex><span>username        = &lt;&gt;@microsoft.com
</span></span><span style=display:flex><span>provider        = AzureAD
</span></span><span style=display:flex><span>mfa           = OneWaySMS
</span></span><span style=display:flex><span>skip_verify       = false
</span></span><span style=display:flex><span>timeout         = 0
</span></span><span style=display:flex><span>aws_urn         = urn:amazon:webservices
</span></span><span style=display:flex><span>aws_session_duration  = 3600
</span></span><span style=display:flex><span>aws_profile       = dev
</span></span><span style=display:flex><span>resource_id       =
</span></span><span style=display:flex><span>subdomain        =
</span></span><span style=display:flex><span>role_arn        =
</span></span><span style=display:flex><span>region         =
</span></span><span style=display:flex><span>http_attempts_count   =
</span></span><span style=display:flex><span>http_retry_delay    =
</span></span><span style=display:flex><span>credentials_file    =
</span></span><span style=display:flex><span>saml_cache       = false
</span></span><span style=display:flex><span>saml_cache_file     =
</span></span><span style=display:flex><span>target_url       =
</span></span><span style=display:flex><span>disable_remember_device = false
</span></span><span style=display:flex><span>disable_sessions    = false
</span></span><span style=display:flex><span>prompter        =
</span></span></code></pre></div><p>for more reference, follow this page
<a href=https://github.com/Versent/saml2aws/blob/master/doc/provider/aad/README.md#configure>https://github.com/Versent/saml2aws/blob/master/doc/provider/aad/README.md#configure</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-b9067c29ff225f76498ad9ce2b8c0d91>1.4 - Reference Lists</h1><div class=lead>Curated reference lists and collections</div><div class="pageinfo pageinfo-primary"><p>Curated lists of tools, resources, and references for development and testing.</p></div><h2 id=1-available-lists>1. Available Lists</h2><ul><li><strong>Test Tools</strong> - Testing frameworks and tools</li><li><strong>Web Tools</strong> - Web analysis and OSINT tools</li></ul><h2 id=2-browse-lists>2. Browse Lists</h2><p>Select a list from the sidebar to explore resources.</p></div><div class=td-content><h1 id=pg-c230d2d89d9e57dde65de7892810c407>1.4.1 - Test</h1><div class=lead>Reference list of testing tools and frameworks</div><h2 id=1-test-tools>1. Test tools</h2><h3 id=11-testcontainers>1.1. TestContainers</h3><p><a href=https://testcontainers.com/>TestContainers</a></p><p>Unit tests with real dependencies</p><p>TestContainers is an open source framework for providing throwaway, lightweight instances of
databases, message brokers, web browsers, or just about anything that can run in a Docker
container.</p><p>Test dependencies as code</p><p>No more need for mocks or complicated environment configurations. Define your test
dependencies as code, then simply run your tests and containers will be created and then
deleted.</p><p>With support for many languages and testing frameworks, all you need is Docker.</p><p>Supported languages: python, nodejs, &mldr;</p><p>Supported modules: redis, mysql, &mldr;</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b0c2b7d40f3fa9fc59273cfbdfee53f8>1.4.2 - Web Tools</h1><div class=lead>Reference list of web analysis and OSINT tools</div><h2 id=1-osint-tools>1. OSINT tools</h2><p>What Are Open Source Intelligence (OSINT) Tools? Open-source intelligence software, abbreviated
as OSINT software, are tools that allow the collection of information that is publicly available
or open-source. The goal of using OSINT software is mainly to learn more about an individual or a
business.</p><h3 id=11-lissy93web-check>1.1. Lissy93/web-check</h3><p>All-in-one OSINT tool for analyzing any website Comprehensive, on-demand open source intelligence
for any website</p><p><a href=https://github.com/Lissy93/web-check>github project Lissy93/web-check</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-cf5130bf878cbb73a53d35bbfe95785b>1.5 - Other Projects</h1><div class=lead>Related documentation sites</div><p>Links to related documentation and projects in this documentation suite.</p><ul><li><a href=https://fchastanet.github.io/bash-tools-framework/>Bash Tools Framework</a></li><li><a href=https://fchastanet.github.io/bash-tools/>Bash Tools</a></li><li><a href=https://fchastanet.github.io/bash-dev-env/>Bash Dev Env</a></li><li><a href=https://fchastanet.github.io/bash-compiler/>Bash Compiler</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-bee86482d428bccb4857fac98ceed2ae>1.6 - My Documents - Static Site Generation Using Hugo</h1><div class=lead>Comprehensive documentation of the Hugo migration for multi-site documentation</div><h1 id=my-documents---static-site-generation-using-hugo---migration-analysis-and-implementation>My Documents - Static Site Generation Using Hugo - Migration Analysis and Implementation</h1><ul><li><a href=#my-documents---static-site-generation-using-hugo---migration-analysis-and-implementation>My Documents - Static Site Generation Using Hugo - Migration Analysis and Implementation</a><ul><li><a href=#1-technical-solutions-evaluated>1. Technical Solutions Evaluated</a><ul><li><a href=#11-static-site-generator-solutions>1.1. Static Site Generator Solutions</a><ul><li><a href=#111-hugo-selected>1.1.1. Hugo (SELECTED)</a></li><li><a href=#112-astro>1.1.2. Astro</a></li><li><a href=#113-11ty-eleventy>1.1.3. 11ty (Eleventy)</a></li><li><a href=#114-vuepress-2>1.1.4. VuePress 2</a></li><li><a href=#115-mkdocs>1.1.5. MkDocs</a></li><li><a href=#116-nextjs-and-gatsby>1.1.6. Next.js and Gatsby</a></li><li><a href=#117-comparison-summary>1.1.7. Comparison Summary</a></li></ul></li><li><a href=#12-multi-site-build-pipeline-solutions>1.2. Multi-Site Build Pipeline Solutions</a><ul><li><a href=#121-centralized-orchestrator-my-documents-builds-all-sites-selected>1.2.1. Centralized Orchestrator (my-documents builds all sites) (SELECTED)</a></li><li><a href=#122-decentralized-with-reusable-workflows--hugo-modules>1.2.2. Decentralized with Reusable Workflows + Hugo Modules</a></li><li><a href=#123-true-monorepo-with-subdirectories>1.2.3. True Monorepo with Subdirectories</a></li><li><a href=#124-pipeline-solution-comparison>1.2.4. Pipeline Solution Comparison</a></li></ul></li></ul></li><li><a href=#2-chosen-solutions--rationale>2. Chosen Solutions & Rationale</a><ul><li><a href=#21-static-site-generator-hugo--docsy-theme>2.1. Static Site Generator: Hugo + Docsy Theme</a></li><li><a href=#22-multi-site-pipeline-centralized-orchestrator>2.2. Multi-Site Pipeline: Centralized Orchestrator</a></li></ul></li><li><a href=#3-implementation-details>3. Implementation Details</a><ul><li><a href=#31-repository-architecture>3.1. Repository Architecture</a></li><li><a href=#32-directory-structure>3.2. Directory Structure</a><ul><li><a href=#321-my-documents-orchestrator>3.2.1. my-documents (Orchestrator)</a></li><li><a href=#322-dependent-repository-example-bash-compiler>3.2.2. Dependent Repository (Example: bash-compiler)</a></li></ul></li><li><a href=#33-configuration-merging-strategy>3.3. Configuration Merging Strategy</a></li><li><a href=#34-build-workflow>3.4. Build Workflow</a></li><li><a href=#35-deployment-approach>3.5. Deployment Approach</a></li><li><a href=#36-trigger-mechanism>3.6. Trigger Mechanism</a></li><li><a href=#37-theme-customization>3.7. Theme Customization</a></li></ul></li><li><a href=#4-lessons-learned--future-considerations>4. Lessons Learned & Future Considerations</a><ul><li><a href=#41-github-app-migration-from-deploy-keys>4.1. GitHub App Migration from Deploy Keys</a></li><li><a href=#42-trade-offs-discovered>4.2. Trade-offs Discovered</a><ul><li><a href=#421-all-site-rebuild-trade-off>4.2.1. All-Site Rebuild Trade-off</a></li><li><a href=#422-authentication-complexity>4.2.2. Authentication Complexity</a></li><li><a href=#423-configuration-flexibility-vs-consistency>4.2.3. Configuration Flexibility vs Consistency</a></li></ul></li><li><a href=#43-best-practices-identified>4.3. Best Practices Identified</a><ul><li><a href=#431-configuration-management>4.3.1. Configuration Management</a></li><li><a href=#432-build-optimization>4.3.2. Build Optimization</a></li><li><a href=#433-dependency-management>4.3.3. Dependency Management</a></li><li><a href=#434-security>4.3.4. Security</a></li></ul></li><li><a href=#44-future-considerations>4.4. Future Considerations</a><ul><li><a href=#441-potential-optimizations>4.4.1. Potential Optimizations</a></li><li><a href=#442-scalability-considerations>4.4.2. Scalability Considerations</a></li><li><a href=#443-alternative-approaches-for-future-projects>4.4.3. Alternative Approaches for Future Projects</a></li></ul></li><li><a href=#45-success-metrics>4.5. Success Metrics</a></li></ul></li><li><a href=#5-conclusion>5. Conclusion</a></li></ul></li></ul><p><strong>Project:</strong> Migration from Docsify to Hugo with Docsy theme for multiple documentation repositories</p><p><strong>Status:</strong> ✅ Completed</p><p><strong>Repositories:</strong></p><ul><li><code>fchastanet/my-documents</code> (orchestrator + own documentation)</li><li><code>fchastanet/bash-compiler</code></li><li><code>fchastanet/bash-tools</code></li><li><code>fchastanet/bash-tools-framework</code></li><li><code>fchastanet/bash-dev-env</code></li></ul><p><strong>Related Documentation:</strong> See <a href=../../../doc/ai/2026-02-18-migrate-repo-from-docsify-to-hugo.md>doc/ai/2026-02-18-migrate-repo-from-docsify-to-hugo.md</a>
for detailed migration guide.</p><h2 id=1-technical-solutions-evaluated>1. Technical Solutions Evaluated</h2><h3 id=11-static-site-generator-solutions>1.1. Static Site Generator Solutions</h3><h4 id=111-hugo-selected>1.1.1. Hugo (SELECTED)</h4><p><strong>Evaluation:</strong> ⭐⭐⭐⭐⭐
<strong>Type:</strong> Go-based static site generator</p><p><strong>Pros:</strong></p><ul><li>Extremely fast compilation (&lt;1s for most documentation sites)</li><li>Excellent for documentation with purpose-built features</li><li>Superior SEO support (static HTML, sitemaps, feeds, schemas) - <strong>9/10 SEO score</strong></li><li>Single binary with no dependency complications</li><li>Markdown + frontmatter support (natural progression from Docsify)</li><li>GitHub Actions ready with official actions</li><li>Large theme ecosystem (500+ themes) including specialized documentation themes</li><li>Built-in features: search indexes, RSS feeds, hierarchical content organization</li><li>Output optimization: image processing, minification, CSS purging</li><li>Active community with frequent updates</li><li>Multi-language support built-in</li></ul><p><strong>Cons:</strong></p><ul><li>Learning curve for Go templating (shortcodes, partials)</li><li>Theme customization requires understanding Hugo&rsquo;s page model</li><li>Configuration in YAML/TOML format</li></ul><p><strong>GitHub CI/CD Integration:</strong> Native, simple integration with peaceiris/actions-hugo</p><p><strong>Best For:</strong> Technical documentation, multi-site architecture, SEO-critical sites, GitHub Pages, content-heavy sites</p><h4 id=112-astro>1.1.2. Astro</h4><p><strong>Evaluation:</strong> ⭐⭐⭐⭐
<strong>Type:</strong> JavaScript/TypeScript-based with island architecture</p><p><strong>Pros:</strong></p><ul><li>Outstanding SEO support (static HTML, zero JavaScript by default) - <strong>9/10 SEO score</strong></li><li>Modern JavaScript patterns with TypeScript support</li><li>Markdown + MDX support (embedded React/Vue components in Markdown)</li><li>Island architecture minimizes JavaScript shipping</li><li>Fast performance and build times (&lt;2s)</li><li>Automatic image optimization (AVIF support)</li><li>Vite-based with fast HMR</li></ul><p><strong>Cons:</strong></p><ul><li>Newer ecosystem, less battle-tested than Hugo</li><li>Requires Node.js and npm dependency management</li><li>Smaller theme ecosystem</li><li>MDX adds complexity if not needed</li></ul><p><strong>Best For:</strong> Modern tech stacks, interactive components, TypeScript-heavy teams, blogs + documentation hybrids</p><h4 id=113-11ty-eleventy>1.1.3. 11ty (Eleventy)</h4><p><strong>Evaluation:</strong> ⭐⭐⭐⭐</p><p><strong>Type:</strong> JavaScript template engine</p><p><strong>Pros:</strong></p><ul><li>Incredibly flexible with multiple template language support</li><li>Lightweight and fast builds</li><li>JavaScript-based (easier for Node.js teams)</li><li>Low barrier to entry</li><li>No framework lock-in</li></ul><p><strong>Cons:</strong></p><ul><li>Less opinionated, requires more configuration</li><li>Smaller pre-built theme ecosystem</li><li>No built-in search (requires plugins)</li><li>SEO score: <strong>8/10</strong></li></ul><p><strong>Best For:</strong> Developers wanting full control, JavaScript/Node.js teams, unique design requirements</p><h4 id=114-vuepress-2>1.1.4. VuePress 2</h4><p><strong>Evaluation:</strong> ⭐⭐⭐</p><p><strong>Type:</strong> Vue 3-based static site generator</p><p><strong>Pros:</strong></p><ul><li>Documentation-first design</li><li>Built-in search functionality</li><li>Plugin ecosystem for documentation</li><li>Vue component integration in Markdown</li></ul><p><strong>Cons:</strong></p><ul><li>Vue.js knowledge required</li><li>Heavy JavaScript bundle (not as optimized as others)</li><li>Smaller ecosystem than Hugo</li><li>SEO score: <strong>6/10</strong></li></ul><p><strong>Best For:</strong> Vue-centric teams, smaller documentation sites</p><h4 id=115-mkdocs>1.1.5. MkDocs</h4><p><strong>Evaluation:</strong> ⭐⭐⭐</p><p><strong>Type:</strong> Python-based documentation generator</p><p><strong>Pros:</strong></p><ul><li>Documentation-optimized out of the box</li><li>Simple configuration</li><li>Material for MkDocs theme is excellent</li><li>Fast builds</li></ul><p><strong>Cons:</strong></p><ul><li>Python dependency management required</li><li>Smaller ecosystem than Hugo</li><li>Limited flexibility</li><li>SEO score: <strong>7/10</strong></li></ul><p><strong>Best For:</strong> Documentation-only focus, Python-familiar teams, rapid setup</p><h4 id=116-nextjs-and-gatsby>1.1.6. Next.js and Gatsby</h4><p><strong>Evaluation:</strong> ⭐⭐ - <strong>Not recommended</strong> for static documentation</p><p><strong>Reasons:</strong></p><ul><li>Overkill complexity for pure documentation</li><li>Longer build times (5-30s vs &lt;1s for Hugo)</li><li>Heavy JavaScript requirements</li><li>Optimized for different use cases (web apps, not docs)</li><li>Maintenance burden too high for static documentation</li></ul><h4 id=117-comparison-summary>1.1.7. Comparison Summary</h4><table><thead><tr><th>Criteria</th><th>Hugo</th><th>Astro</th><th>11ty</th><th>VuePress</th><th>MkDocs</th></tr></thead><tbody><tr><td><strong>SEO Score</strong></td><td>9/10</td><td>9/10</td><td>8/10</td><td>6/10</td><td>7/10</td></tr><tr><td><strong>Build Speed</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Learning Curve</strong></td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>GitHub Pages</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Documentation Focus</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>Theme Ecosystem</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td></tr><tr><td><strong>Multi-Site Support</strong></td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐</td></tr></tbody></table><h3 id=12-multi-site-build-pipeline-solutions>1.2. Multi-Site Build Pipeline Solutions</h3><h4 id=121-centralized-orchestrator-my-documents-builds-all-sites-selected>1.2.1. Centralized Orchestrator (my-documents builds all sites) (SELECTED)</h4><p><strong>Evaluation:</strong> ⭐⭐⭐⭐⭐
<strong>Architecture:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>my-documents (orchestrator)
</span></span><span style=display:flex><span>├── .github/workflows/build-all-sites.yml  ← Builds all sites
</span></span><span style=display:flex><span>├── configs/
</span></span><span style=display:flex><span>│   ├── _base.yaml                         ← Shared config
</span></span><span style=display:flex><span>│   ├── bash-compiler.yaml                 ← Site overrides
</span></span><span style=display:flex><span>│   ├── bash-tools.yaml
</span></span><span style=display:flex><span>│   └── bash-tools-framework.yaml
</span></span><span style=display:flex><span>├── shared/
</span></span><span style=display:flex><span>│   ├── layouts/                           ← Shared templates
</span></span><span style=display:flex><span>│   ├── assets/                            ← Shared styles
</span></span><span style=display:flex><span>│   └── archetypes/                        ← Content templates
</span></span><span style=display:flex><span>└── content/                               ← my-documents own docs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Dependent repos (minimal):
</span></span><span style=display:flex><span>bash-compiler/
</span></span><span style=display:flex><span>├── .github/workflows/trigger-docs.yml     ← Triggers my-documents
</span></span><span style=display:flex><span>└── content/en/                            ← Documentation only
</span></span></code></pre></div><p><strong>How It Works:</strong></p><ol><li>Push to <code>bash-compiler</code> → triggers <code>my-documents</code> via <code>repository_dispatch</code></li><li>my-documents workflow:<ul><li>Checks out ALL repos (my-documents, bash-compiler, bash-tools, bash-tools-framework, bash-dev-env)</li><li>Builds each site in parallel using GitHub Actions matrix strategy</li><li>Merges configs (<code>_base.yaml</code> + site-specific overrides)</li><li>Deploys each site to its respective GitHub Pages</li></ul></li></ol><p><strong>Pros:</strong></p><ul><li>✅ All repos under same owner (fchastanet) simplifies permission management</li><li>✅ One workflow update fixes all sites immediately</li><li>✅ Guaranteed consistency across all documentation sites</li><li>✅ Simpler per-repo setup (2 files: trigger workflow + content)</li><li>✅ No Hugo modules needed (simpler dependency management)</li><li>✅ Centralized theme customization with per-site overrides</li><li>✅ Build all sites in ~60s (parallel matrix execution)</li><li>✅ Single point of maintenance</li></ul><p><strong>Cons:</strong></p><ul><li>⚠️ Requires authentication setup (GitHub App or deploy keys)</li><li>⚠️ All sites rebuild together (cannot isolate to single site)</li><li>⚠️ All-or-nothing failures (one site failure blocks others in same matrix job)</li><li>⚠️ Slightly more complex initial setup</li></ul><p><strong>Best For:</strong> Related projects under same organization, shared theme/purpose, centralized maintenance preference</p><h4 id=122-decentralized-with-reusable-workflows--hugo-modules>1.2.2. Decentralized with Reusable Workflows + Hugo Modules</h4><p><strong>Architecture:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>my-documents (shared resources hub)
</span></span><span style=display:flex><span>├── .github/workflows/hugo-build-deploy-reusable.yml  ← Reusable workflow
</span></span><span style=display:flex><span>├── layouts/ (Hugo module export)
</span></span><span style=display:flex><span>└── assets/ (Hugo module export)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>bash-compiler/ (independent)
</span></span><span style=display:flex><span>├── .github/workflows/hugo-build-deploy.yml  ← Calls reusable workflow
</span></span><span style=display:flex><span>├── hugo.yaml (imports my-documents module)
</span></span><span style=display:flex><span>├── go.mod
</span></span><span style=display:flex><span>└── content/
</span></span></code></pre></div><p><strong>How It Works:</strong></p><ol><li>Each dependent repo has its own build workflow</li><li>Workflow calls the reusable workflow from my-documents</li><li>Hugo modules pull shared resources during build</li><li>Each site builds and deploys independently</li></ol><p><strong>Pros:</strong></p><ul><li>✅ Independent deployment (site failures isolated)</li><li>✅ Automatic updates when reusable workflow changes</li><li>✅ Version control (can pin to <code>@v1.0.0</code> or <code>@master</code>)</li><li>✅ No trigger coordination needed</li><li>✅ Faster builds for single-site changes (~30s per site)</li><li>✅ Per-repo flexibility if needed</li></ul><p><strong>Cons:</strong></p><ul><li>⚠️ Hugo modules require Go toolchain</li><li>⚠️ More files per repository (6 core files vs 2)</li><li>⚠️ Learning curve for Hugo module system</li><li>⚠️ Network dependency (modules fetched from GitHub)</li><li>⚠️ Potential configuration drift if repos don&rsquo;t update modules</li><li>⚠️ More complex to enforce consistency</li></ul><p><strong>Best For:</strong> Fully independent projects, teams wanting flexibility, isolated failure tolerance</p><h4 id=123-true-monorepo-with-subdirectories>1.2.3. True Monorepo with Subdirectories</h4><p><strong>Architecture:</strong> All content in single repo with subdirectories for each project</p><p><strong>Pros:</strong></p><ul><li>✅ Simplest configuration</li><li>✅ Single build process</li><li>✅ Guaranteed consistency</li></ul><p><strong>Cons:</strong></p><ul><li>❌ Loses separate GitHub Pages URLs</li><li>❌ No independent repository control</li><li>❌ Violates existing repository structure</li><li>❌ Complicated permission management</li></ul><p><strong>Evaluation:</strong> <strong>Not recommended</strong> - Conflicts with requirement to maintain separate repository URLs</p><h4 id=124-pipeline-solution-comparison>1.2.4. Pipeline Solution Comparison</h4><table><thead><tr><th>Criteria</th><th>Centralized Orchestrator</th><th>Decentralized Reusable</th><th>Monorepo</th></tr></thead><tbody><tr><td><strong>Complexity</strong></td><td>Low (minimal per-repo)</td><td>Medium (per-repo setup)</td><td>Low (single repo)</td></tr><tr><td><strong>Build Time</strong></td><td>~60s all sites</td><td>~30s per site</td><td>~60s all sites</td></tr><tr><td><strong>Maintenance</strong></td><td>Update once</td><td>Update workflow × N</td><td>Update once</td></tr><tr><td><strong>Consistency</strong></td><td>✅ Guaranteed</td><td>Can drift</td><td>✅ Guaranteed</td></tr><tr><td><strong>Failure Isolation</strong></td><td>All-or-nothing</td><td>✅ Independent</td><td>All-or-nothing</td></tr><tr><td><strong>Setup Effort</strong></td><td>1 workflow + N configs</td><td>6 files × N repos</td><td>Single setup</td></tr><tr><td><strong>Independent URLs</strong></td><td>✅ Yes</td><td>✅ Yes</td><td>❌ No</td></tr><tr><td><strong>Hugo Modules</strong></td><td>❌ Not needed</td><td>Required</td><td>❌ Not needed</td></tr></tbody></table><h2 id=2-chosen-solutions--rationale>2. Chosen Solutions & Rationale</h2><h3 id=21-static-site-generator-hugo--docsy-theme>2.1. Static Site Generator: Hugo + Docsy Theme</h3><p><strong>Choice:</strong> Hugo with Google&rsquo;s Docsy theme</p><p><strong>Rationale:</strong></p><ol><li><p><strong>SEO Requirements Met:</strong></p><ul><li>Static HTML pre-rendering (search engines can easily index)</li><li>Automatic sitemap and robots.txt generation</li><li>Per-page meta tags and structured data support</li><li>RSS/Atom feeds</li><li>Image optimization</li><li>Performance optimizations (minification, compression)</li><li><strong>SEO improvement: 2/10 (Docsify) → 9/10 (Hugo)</strong></li></ul></li><li><p><strong>Technical Excellence:</strong></p><ul><li>Extremely fast builds (&lt;1s for typical documentation site)</li><li>Simple deployment (single Go binary, no dependency hell)</li><li>GitHub Pages native support</li><li>Mature, stable, battle-tested (10+ years in production use)</li></ul></li><li><p><strong>Documentation-Specific Features:</strong></p><ul><li>Docsy theme built by Google specifically for documentation</li><li>Built-in search functionality</li><li>Responsive design</li><li>Navigation auto-generation from content structure</li><li>Version management support</li><li>Multi-language support</li></ul></li><li><p><strong>Developer Experience:</strong></p><ul><li>Markdown + frontmatter (minimal migration effort from Docsify)</li><li>Good documentation and large community</li><li>Extensive theme ecosystem</li><li>Active development and updates</li></ul></li><li><p><strong>Multi-Site Architecture Support:</strong></p><ul><li>Excellent support for shared configurations</li><li>Hugo modules for code reuse</li><li>Flexible configuration merging</li><li>Content organization flexibility</li></ul></li></ol><p><strong>Alternatives Considered:</strong></p><ul><li><strong>Astro:</strong> Excellent option, but newer ecosystem and Node.js dependency management adds complexity</li><li><strong>11ty:</strong> Good flexibility, but less opinionated structure requires more setup work</li><li><strong>MkDocs:</strong> Python dependencies and smaller ecosystem less ideal</li><li><strong>VuePress/Next.js/Gatsby:</strong> Too heavy for pure documentation needs</li></ul><h3 id=22-multi-site-pipeline-centralized-orchestrator>2.2. Multi-Site Pipeline: Centralized Orchestrator</h3><p><strong>Choice:</strong> Centralized build orchestrator in my-documents repository</p><p><strong>Rationale:</strong></p><ol><li><p><strong>Project Context Alignment:</strong></p><ul><li>All repositories under same owner (fchastanet)</li><li>All share same purpose (Bash tooling documentation)</li><li>All need consistent look and feel</li><li>Related projects benefit from coordinated updates</li></ul></li><li><p><strong>Maintenance Efficiency:</strong></p><ul><li>Single workflow update affects all sites immediately</li><li>One place to fix bugs or add features</li><li>Guaranteed consistency across all documentation</li><li>Reduced mental overhead (one system to understand)</li></ul></li><li><p><strong>Simplified Per-Repository Structure:</strong></p><ul><li>Only 2 essential files per dependent repo:<ul><li>Trigger workflow (10 lines)</li><li>Content directory</li></ul></li><li>No Hugo configuration duplication</li><li>No Go module management per repo</li></ul></li><li><p><strong>Configuration Management:</strong></p><ul><li>Base configuration shared via <code>configs/_base.yaml</code></li><li>Site-specific overrides in <code>configs/{site}.yaml</code></li><li>Automatic merging with <code>yq</code> tool</li><li>No configuration drift possible</li></ul></li><li><p><strong>Build Efficiency:</strong></p><ul><li>Parallel matrix execution builds all 5 sites simultaneously</li><li>Total time ~60s for all sites (vs 30s × 5 = 150s sequential)</li><li>Resource sharing in CI/CD (single Hugo/Go setup)</li></ul></li><li><p><strong>Deployment Simplification:</strong></p><ul><li>Authentication centralized in my-documents (GitHub App)</li><li>Single set of deployment credentials</li><li>Easier to audit and manage security</li></ul></li></ol><p><strong>Trade-offs Accepted:</strong></p><ul><li>⚠️ All sites rebuild together (acceptable for related documentation)</li><li>⚠️ More complex initial setup (one-time investment)</li><li>⚠️ All-or-nothing failures (mitigated with <code>fail-fast: false</code> in matrix)</li></ul><p><strong>Alternatives Considered:</strong></p><ul><li><strong>Decentralized Reusable Workflows:</strong> Good for truly independent projects, but adds complexity without benefit for
our use case where all sites are related and share theme/purpose</li><li><strong>Monorepo:</strong> Would lose independent GitHub Pages URLs, not acceptable</li></ul><h2 id=3-implementation-details>3. Implementation Details</h2><h3 id=31-repository-architecture>3.1. Repository Architecture</h3><p><strong>Orchestrator Repository:</strong> <code>fchastanet/my-documents</code></p><p><strong>Responsibilities:</strong></p><ul><li>Build all documentation sites (including its own)</li><li>Manage shared configurations and theme customizations</li><li>Deploy to multiple GitHub Pages repositories</li><li>Coordinate builds triggered from dependent repositories</li></ul><p><strong>Dependent Repositories:</strong></p><ul><li><code>fchastanet/bash-compiler</code></li><li><code>fchastanet/bash-tools</code></li><li><code>fchastanet/bash-tools-framework</code></li><li><code>fchastanet/bash-dev-env</code></li></ul><p><strong>Responsibilities:</strong> Contain documentation content only, trigger builds in orchestrator</p><h3 id=32-directory-structure>3.2. Directory Structure</h3><h4 id=321-my-documents-orchestrator>3.2.1. my-documents (Orchestrator)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>/home/wsl/fchastanet/my-documents/
</span></span><span style=display:flex><span>├── .github/workflows/
</span></span><span style=display:flex><span>│   └── build-all-sites.yml              ← Orchestrator workflow
</span></span><span style=display:flex><span>├── configs/
</span></span><span style=display:flex><span>│   ├── _base.yaml                       ← Shared configuration
</span></span><span style=display:flex><span>│   ├── my-documents.yaml               ← my-documents overrides
</span></span><span style=display:flex><span>│   ├── bash-compiler.yaml              ← bash-compiler overrides
</span></span><span style=display:flex><span>│   ├── bash-tools.yaml
</span></span><span style=display:flex><span>│   ├── bash-tools-framework.yaml
</span></span><span style=display:flex><span>│   └── bash-dev-env.yaml
</span></span><span style=display:flex><span>├── shared/
</span></span><span style=display:flex><span>│   ├── layouts/                         ← Shared Hugo templates
</span></span><span style=display:flex><span>│   ├── assets/                          ← Shared SCSS, JS
</span></span><span style=display:flex><span>│   └── archetypes/                      ← Content templates
</span></span><span style=display:flex><span>├── content/                             ← my-documents own content
</span></span><span style=display:flex><span>├── hugo.yaml                            ← Generated per build
</span></span><span style=display:flex><span>└── go.mod                               ← Hugo modules (Docsy)
</span></span></code></pre></div><p><strong>Key Files:</strong></p><ul><li><a href=../../.github/workflows/build-all-sites.yml>.github/workflows/build-all-sites.yml</a> - Orchestrator workflow</li><li><a href=../../configs/_base.yaml>configs/_base.yaml</a> - Shared Hugo configuration</li><li><a href=../../configs/bash-compiler.yaml>configs/bash-compiler.yaml</a> - Example site-specific config</li><li><a href=../../shared/>shared/</a> - Shared theme customizations</li></ul><h4 id=322-dependent-repository-example-bash-compiler>3.2.2. Dependent Repository (Example: bash-compiler)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>fchastanet/bash-compiler/
</span></span><span style=display:flex><span>├── .github/workflows/
</span></span><span style=display:flex><span>│   └── trigger-docs.yml                 ← Triggers orchestrator
</span></span><span style=display:flex><span>└── content/en/                          ← Documentation content only
</span></span><span style=display:flex><span>    ├── _index.md
</span></span><span style=display:flex><span>    └── docs/
</span></span><span style=display:flex><span>        └── *.md
</span></span></code></pre></div><h3 id=33-configuration-merging-strategy>3.3. Configuration Merging Strategy</h3><p><strong>Approach:</strong> Use <code>yq</code> tool for proper YAML deep-merging</p><p><strong>Base Configuration:</strong> <a href=../../configs/_base.yaml>configs/_base.yaml</a></p><p>Contains:</p><ul><li>Hugo module imports (Docsy theme)</li><li>Common parameters (language, SEO settings)</li><li>Shared markup configuration</li><li>Mount points for shared resources</li><li>Common menu structure</li><li>Default theme parameters</li></ul><p><strong>Site-Specific Overrides:</strong> Example <a href=../../configs/bash-compiler.yaml>configs/bash-compiler.yaml</a></p><p>Contains:</p><ul><li>Site title and baseURL</li><li>Repository-specific links</li><li>Site-specific theme colors (<code>ui.navbar_bg_color</code>)</li><li>Custom menu items</li><li>SEO keywords specific to the project</li><li>GitHub repository links</li></ul><p><strong>Merging Process:</strong></p><p>Implemented in <a href=../../.github/workflows/build-all-sites.yml>.github/workflows/build-all-sites.yml</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>yq eval-all &#39;select(fileIndex == 0) * select(fileIndex == 1)&#39; \</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#000>configs/_base.yaml \</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#000>configs/bash-compiler.yaml &gt; hugo.yaml</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Result:</strong> Clean, merged <code>hugo.yaml</code> with:</p><ul><li>Base configuration as foundation</li><li>Site-specific overrides applied</li><li>Proper YAML structure preserved (no duplication)</li><li>Deep merge of nested objects</li></ul><h3 id=34-build-workflow>3.4. Build Workflow</h3><p><strong>Main Workflow:</strong> <a href=../../.github/workflows/build-all-sites.yml>.github/workflows/build-all-sites.yml</a></p><p><strong>Triggers:</strong></p><ul><li><code>workflow_dispatch</code> - Manual trigger</li><li><code>repository_dispatch</code> with type <code>trigger-docs-rebuild</code> - From dependent repos</li><li><code>push</code> to <code>master</code> branch affecting:<ul><li><code>content/**</code></li><li><code>shared/**</code></li><li><code>configs/**</code></li><li><code>.github/workflows/build-all-sites.yml</code></li></ul></li></ul><p><strong>Strategy:</strong> Parallel matrix build</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>matrix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>site</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>my-documents</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>baseURL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://fchastanet.github.io/my-documents</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>self</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>baseURL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://fchastanet.github.io/bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>self</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># ... other sites</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Build Steps (Per Site):</strong></p><ol><li><strong>Checkout Orchestrator:</strong> Clone my-documents repository</li><li><strong>Checkout Content:</strong> Clone dependent repository content (if not self)</li><li><strong>Setup Tools:</strong> Install Hugo Extended 0.155.3, Go 1.24, yq</li><li><strong>Prepare Build Directory:</strong><ul><li>For my-documents: Use orchestrator directory</li><li>For dependent repos: Create <code>build-{site}</code> directory</li></ul></li><li><strong>Merge Configurations:</strong> Combine <code>_base.yaml</code> + <code>{site}.yaml</code></li><li><strong>Copy Shared Resources:</strong> Link shared layouts, assets, archetypes</li><li><strong>Copy Content:</strong> Link content directory</li><li><strong>Initialize Hugo Modules:</strong> Run <code>hugo mod init</code> and <code>hugo mod get -u</code></li><li><strong>Build Site:</strong> Run <code>hugo --minify</code></li><li><strong>Deploy:</strong> Push to respective GitHub Pages</li></ol><p><strong>Concurrency:</strong> <code>cancel-in-progress: true</code> prevents duplicate builds</p><p><strong>Failure Handling:</strong> <code>fail-fast: false</code> allows other sites to build even if one fails</p><h3 id=35-deployment-approach>3.5. Deployment Approach</h3><p><strong>Method:</strong> GitHub App authentication (migrated from deploy keys)</p><p><strong>Authentication Flow:</strong></p><ol><li><strong>Generate App Token:</strong> Use <code>actions/create-github-app-token@v1</code></li><li><strong>Deploy with Token:</strong> Use <code>peaceiris/actions-gh-pages@v4</code></li></ol><p><strong>Secrets Required</strong> (in my-documents):</p><ul><li><code>DOC_APP_ID</code> - GitHub App ID</li><li><code>DOC_APP_PRIVATE_KEY</code> - GitHub App private key (PEM format)</li></ul><p><strong>Deployment Step Example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Generate GitHub App token</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>app-token</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>actions/create-github-app-token@v1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>app-id</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.DOC_APP_ID }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>private-key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.DOC_APP_PRIVATE_KEY }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>owner</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>repositories</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Deploy to GitHub Pages</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peaceiris/actions-gh-pages@v4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>github_token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ steps.app-token.outputs.token }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>external_repository</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_dir</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>./public</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>publish_branch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>gh-pages</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Result URLs:</strong></p><ul><li><a href=https://fchastanet.github.io/my-documents/>https://fchastanet.github.io/my-documents/</a></li><li><a href=https://fchastanet.github.io/bash-compiler/>https://fchastanet.github.io/bash-compiler/</a></li><li><a href=https://fchastanet.github.io/bash-tools/>https://fchastanet.github.io/bash-tools/</a></li><li><a href=https://fchastanet.github.io/bash-tools-framework/>https://fchastanet.github.io/bash-tools-framework/</a></li><li><a href=https://fchastanet.github.io/bash-dev-env/>https://fchastanet.github.io/bash-dev-env/</a></li></ul><h3 id=36-trigger-mechanism>3.6. Trigger Mechanism</h3><p><strong>Dependent Repository Workflow Example:</strong> <code>.github/workflows/trigger-docs.yml</code></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger Documentation Rebuild</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;.github/workflows/trigger-docs.yml&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>runs-on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ubuntu-latest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>steps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger my-documents build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peter-evans/repository-dispatch@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.DOCS_TRIGGER_PAT }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>repository</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>event-type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>trigger-docs-rebuild</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>client-payload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;repository&#34;: &#34;${{ github.repository }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;ref&#34;: &#34;${{ github.ref }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;sha&#34;: &#34;${{ github.sha }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            }</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Required Secret:</strong> <code>DOCS_TRIGGER_PAT</code> - Personal Access Token with <code>repo</code> scope</p><h3 id=37-theme-customization>3.7. Theme Customization</h3><p><strong>Shared Customizations:</strong> <a href=../../shared/>shared/</a></p><p>Contains:</p><ul><li><strong>Layouts:</strong> Custom Hugo templates override Docsy defaults</li><li><strong>Assets:</strong> Custom SCSS variables, additional CSS/JS</li><li><strong>Archetypes:</strong> Content templates for new pages</li></ul><p><strong>Per-Site Customization:</strong> Via configuration overrides in <code>configs/{site}.yaml</code></p><p>Examples:</p><ul><li>Theme colors: <code>params.ui.navbar_bg_color: '#007bff'</code> (blue for bash-compiler)</li><li>Custom links in footer or navbar</li><li>Site-specific SEO keywords and description</li><li>Logo overrides</li></ul><p><strong>Mount Strategy:</strong> Defined in <a href=../../configs/_base.yaml>configs/_base.yaml</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>module</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>mounts</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#204a87;font-weight:700>source: shared/layouts, target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>layouts}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#204a87;font-weight:700>source: shared/assets, target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>assets}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#204a87;font-weight:700>source: shared/archetypes, target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>archetypes}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#204a87;font-weight:700>source: content, target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>content}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- {<span style=color:#204a87;font-weight:700>source: static, target</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>static}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Result:</strong> Shared resources available to all sites, with per-site override capability</p><h2 id=4-lessons-learned--future-considerations>4. Lessons Learned & Future Considerations</h2><h3 id=41-github-app-migration-from-deploy-keys>4.1. GitHub App Migration from Deploy Keys</h3><p><strong>Initial Approach:</strong> Deploy keys for each repository</p><ul><li><strong>Setup:</strong> Generate SSH key pair per repository, store private key in my-documents secrets</li><li><strong>Secrets Required:</strong> <code>DEPLOY_KEY_BASH_COMPILER</code>, <code>DEPLOY_KEY_BASH_TOOLS</code>, etc. (4+ secrets)</li><li><strong>Management:</strong> Per-repository key addition in Settings → Deploy keys</li></ul><p><strong>Problem:</strong> Scalability and management overhead</p><p><strong>Migration to GitHub Apps:</strong></p><p><strong>Advantages:</strong></p><ul><li>✅ <strong>Fine-grained permissions:</strong> Only Contents and Pages write access (vs full repo access)</li><li>✅ <strong>Centralized management:</strong> One app for all repositories</li><li>✅ <strong>Better security:</strong> Automatic token expiration and rotation</li><li>✅ <strong>Audit trail:</strong> All actions logged under app identity</li><li>✅ <strong>No SSH management:</strong> HTTPS with tokens instead of SSH keys</li><li>✅ <strong>Easily revocable:</strong> Instant access revocation without key regeneration</li><li>✅ <strong>Scalable:</strong> Add/remove repositories without creating new keys</li><li>✅ <strong>Secrets reduction:</strong> 2 secrets (app ID + private key) vs 4+ deploy keys</li></ul><p><strong>GitHub Official Recommendation:</strong></p><blockquote><p>&ldquo;We recommend using GitHub Apps with permissions scoped to specific repositories for
enhanced security and more granular access control.&rdquo;</p></blockquote><p><strong>Implementation:</strong> See <a href=../../../doc/ai/2026-02-18-github-app-migration.md>doc/ai/2026-02-18-github-app-migration.md</a>
for complete migration guide</p><p><strong>Outcome:</strong> Significantly improved security posture and simplified credential management</p><h3 id=42-trade-offs-discovered>4.2. Trade-offs Discovered</h3><h4 id=421-all-site-rebuild-trade-off>4.2.1. All-Site Rebuild Trade-off</h4><p><strong>Trade-off:</strong> All sites rebuild together when any site content changes</p><p><strong>Mitigation Strategies:</strong></p><ul><li>✅ <code>fail-fast: false</code> in matrix strategy - One site failure doesn&rsquo;t block others</li><li>✅ Parallel execution - All 5 sites build simultaneously (~60s total)</li><li>✅ Path-based triggers - Only rebuild when relevant files change</li><li>✅ Concurrency control - Cancel duplicate builds</li></ul><p><strong>Acceptance Rationale:</strong></p><ul><li>Related documentation sites benefit from synchronized updates</li><li>Total build time (60s) acceptable for documentation updates</li><li>Ensures all sites stay consistent with latest shared resources</li><li>Simpler mental model: one build updates everything</li></ul><h4 id=422-authentication-complexity>4.2.2. Authentication Complexity</h4><p><strong>Trade-off:</strong> Initial setup requires GitHub App creation and secret configuration</p><p><strong>Mitigation:</strong></p><ul><li>✅ One-time setup effort well-documented</li><li>✅ Improved security worth the complexity</li><li>✅ Scales better than deploy keys (no per-repo setup needed for new sites)</li></ul><p><strong>Outcome:</strong> Initial investment pays off with easier ongoing management</p><h4 id=423-configuration-flexibility-vs-consistency>4.2.3. Configuration Flexibility vs Consistency</h4><p><strong>Trade-off:</strong> Centralized configuration limits per-site flexibility</p><p><strong>Mitigation:</strong></p><ul><li>✅ Site-specific override files in <code>configs/{site}.yaml</code></li><li>✅ Shared base with override capability provides best of both worlds</li><li>✅ yq deep-merge preserves flexibility where needed</li></ul><p><strong>Outcome:</strong> Achieved balance between consistency and customization</p><h3 id=43-best-practices-identified>4.3. Best Practices Identified</h3><h4 id=431-configuration-management>4.3.1. Configuration Management</h4><ul><li><strong>Use YAML deep-merge:</strong> <code>yq eval-all</code> properly merges nested structures</li><li><strong>Separate concerns:</strong> Base configuration vs site-specific overrides</li><li><strong>Version control everything:</strong> All configs in git</li><li><strong>Document override patterns:</strong> Clear examples in base config</li></ul><h4 id=432-build-optimization>4.3.2. Build Optimization</h4><ul><li><strong>Parallel matrix builds:</strong> Leverage GitHub Actions matrix for speed</li><li><strong>Minimal checkout:</strong> Only fetch what&rsquo;s needed (depth, paths)</li><li><strong>Careful path triggers:</strong> Avoid unnecessary builds</li><li><strong>Cancel redundant builds:</strong> Use concurrency groups</li></ul><h4 id=433-dependency-management>4.3.3. Dependency Management</h4><ul><li><strong>Pin versions:</strong> Hugo 0.155.3, Go 1.24 (reproducible builds)</li><li><strong>Cache when possible:</strong> Hugo modules could be cached (future optimization)</li><li><strong>Minimal dependencies:</strong> yq only additional tool needed</li></ul><h4 id=434-security>4.3.4. Security</h4><ul><li><strong>GitHub Apps over deploy keys:</strong> Better security model</li><li><strong>Minimal permissions:</strong> Only what&rsquo;s needed (Contents write, Pages write)</li><li><strong>Secret scoping:</strong> Secrets only in orchestrator repo</li><li><strong>Audit logging:</strong> GitHub App actions fully logged</li></ul><h3 id=44-future-considerations>4.4. Future Considerations</h3><h4 id=441-potential-optimizations>4.4.1. Potential Optimizations</h4><p><strong>Hugo Module Caching:</strong></p><ul><li>Current: Hugo modules downloaded fresh each build</li><li>Future: Cache Go modules directory to speed up builds</li><li>Benefit: Reduce build time by 5-10s per site</li></ul><p><strong>Conditional Site Builds:</strong></p><ul><li>Current: All sites build on any trigger</li><li>Future: Parse <code>repository_dispatch</code> payload to build only affected site</li><li>Benefit: Faster feedback for single-site changes</li><li>Trade-off: More complex logic, potential consistency issues</li></ul><p><strong>Build Artifact Reuse:</strong></p><ul><li>Current: Each site built independently</li><li>Future: Share Hugo module downloads across matrix jobs</li><li>Benefit: Reduced redundant network calls</li></ul><h4 id=442-scalability-considerations>4.4.2. Scalability Considerations</h4><p><strong>Adding New Documentation Sites:</strong></p><ol><li>Create new repository with content</li><li>Add trigger workflow (2-minute setup)</li><li>Add site config to <code>my-documents/configs/{new-site}.yaml</code></li><li>Add site to matrix in <code>build-all-sites.yml</code></li><li>Install GitHub App on new repository</li><li>Done - automatic builds immediately available</li></ol><p><strong>Estimated effort:</strong> 15-30 minutes per new site</p><h4 id=443-alternative-approaches-for-future-projects>4.4.3. Alternative Approaches for Future Projects</h4><p><strong>When Decentralized Makes Sense:</strong></p><ul><li>Truly independent projects (not related documentation)</li><li>Different teams with different update schedules</li><li>Need for isolated failure handling</li><li>Different Hugo/Docsy versions per project</li></ul><p><strong>When to Reconsider:</strong></p><ul><li>More than 10 sites (build time may become issue)</li><li>Sites diverge significantly in requirements</li><li>Team structure changes (separate maintainers per site)</li><li>Different deployment targets (not all GitHub Pages)</li></ul><h3 id=45-success-metrics>4.5. Success Metrics</h3><p><strong>Achieved:</strong></p><ul><li>✅ <strong>SEO Improvement:</strong> 2/10 (Docsify) → 9/10 (Hugo with Docsy)</li><li>✅ <strong>Build Time:</strong> ~60s for all 5 sites (parallel)</li><li>✅ <strong>Maintenance Reduction:</strong> One workflow update vs 5× separate updates</li><li>✅ <strong>Consistency:</strong> 100% - All sites use same base configuration</li><li>✅ <strong>Security:</strong> GitHub App authentication with fine-grained permissions</li><li>✅ <strong>Deployment:</strong> Automatic on content changes</li><li>✅ <strong>Developer Experience:</strong> Simplified per-repo structure (2 files vs 6)</li><li>✅ <strong>Independent URLs:</strong> All 5 repositories maintain separate GitHub Pages URLs</li><li>✅ <strong>Theme Sharing:</strong> Shared Docsy theme customizations across all sites</li></ul><p><strong>Continuous Improvement:</strong></p><ul><li>Monitor build times as content grows</li><li>Gather feedback on developer experience</li><li>Iterate on shared vs per-site customizations</li><li>Evaluate caching opportunities</li><li>Consider additional SEO optimization (structured data, etc.)</li></ul><h2 id=5-conclusion>5. Conclusion</h2><p>The Hugo migration successfully addressed the SEO limitations of Docsify while
establishing a scalable, maintainable multi-site documentation architecture.
The centralized orchestrator approach provides the right balance of consistency
and flexibility for related Bash tooling documentation projects.</p><p><strong>Key Success Factors:</strong></p><ol><li><strong>Right tool for the job:</strong> Hugo&rsquo;s documentation focus and SEO capabilities</li><li><strong>Architectural alignment:</strong> Centralized approach matches project relationships</li><li><strong>Security improvement:</strong> GitHub App migration enhanced security posture</li><li><strong>Maintainability:</strong> Single-point updates reduce ongoing effort</li><li><strong>Flexibility preserved:</strong> Configuration overrides allow per-site customization</li></ol><p><strong>Documentation maintained and current as of:</strong> 2026-02-18</p><p><strong>Related Resources:</strong></p><ul><li><a href=../../../doc/ai/2026-02-18-migrate-repo-from-docsify-to-hugo.md>Migration Guide</a></li><li><a href=../../../doc/ai/2026-02-18-github-app-migration.md>GitHub App Migration Details</a></li><li><a href=../../../.github/workflows/build-all-sites.yml>Build Workflow</a></li><li><a href=../../../configs/>Configuration Examples</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-ea17a438b505000b83a96758c2f7c165>1.7 - My Documents - Technical Architecture and Documentation Site Implementation</h1><div class=lead>Overview of the technical architecture and implementation details of the My Documents documentation site built with Hugo</div><h1 id=my-documents---technical-architecture-and-documentation-site-implementation>My Documents - Technical Architecture and Documentation Site Implementation</h1><ul><li><a href=#my-documents---technical-architecture-and-documentation-site-implementation>My Documents - Technical Architecture and Documentation Site Implementation</a><ul><li><a href=#1-documentation-site-built-with-hugo>1. Documentation Site Built with Hugo</a></li><li><a href=#2-building-locally>2. Building Locally</a><ul><li><a href=#21-prerequisites>2.1. Prerequisites</a></li><li><a href=#22-quick-start>2.2. Quick Start</a><ul><li><a href=#221-install-hugo>2.2.1. Install Hugo</a></li><li><a href=#222-clone-and-setup>2.2.2. Clone and Setup</a></li><li><a href=#223-run-local-server>2.2.3. Run Local Server</a></li></ul></li><li><a href=#23-building-for-production>2.3. Building for Production</a></li><li><a href=#24-checking-site-statistics>2.4. Checking Site Statistics</a></li></ul></li><li><a href=#3-multi-site-orchestrator-architecture>3. Multi-Site Orchestrator Architecture</a><ul><li><a href=#31-architecture-overview>3.1. Architecture Overview</a></li><li><a href=#32-managed-documentation-sites>3.2. Managed Documentation Sites</a></li><li><a href=#33-shared-vs-site-specific-resources>3.3. Shared vs Site-Specific Resources</a></li><li><a href=#34-how-it-works>3.4. How It Works</a></li><li><a href=#35-key-benefits>3.5. Key Benefits</a></li><li><a href=#36-testing-multi-site-locally>3.6. Testing Multi-Site Locally</a></li><li><a href=#37-makefile-commands>3.7. Makefile Commands</a></li></ul></li><li><a href=#4-creating-a-new-documentation-site>4. Creating a New Documentation Site</a><ul><li><a href=#41-prerequisites>4.1. Prerequisites</a></li><li><a href=#42-step-by-step-guide>4.2. Step-by-Step Guide</a><ul><li><a href=#421-step-1-prepare-the-new-repository>4.2.1. Step 1: Prepare the New Repository</a></li><li><a href=#422-step-2-add-trigger-workflow>4.2.2. Step 2: Add Trigger Workflow</a></li><li><a href=#423-step-3-create-site-configuration-in-my-documents>4.2.3. Step 3: Create Site Configuration in my-documents</a></li><li><a href=#424-step-4-update-build-workflow-matrix>4.2.4. Step 4: Update Build Workflow Matrix</a></li><li><a href=#425-step-5-configure-github-see-section-6-for-details>4.2.5. Step 5: Configure GitHub (See Section 6 for details)</a></li><li><a href=#426-step-6-test-locally>4.2.6. Step 6: Test Locally</a></li><li><a href=#427-step-7-commit-and-deploy>4.2.7. Step 7: Commit and Deploy</a></li></ul></li><li><a href=#43-post-creation-checklist>4.3. Post-Creation Checklist</a></li></ul></li><li><a href=#5-github-configuration>5. GitHub Configuration</a><ul><li><a href=#51-architecture-github-app-authentication>5.1. Architecture: GitHub App Authentication</a></li><li><a href=#52-required-secrets>5.2. Required Secrets</a><ul><li><a href=#521-in-my-documents-repository>5.2.1. In my-documents Repository</a></li><li><a href=#522-in-each-dependent-repository>5.2.2. In Each Dependent Repository</a></li></ul></li><li><a href=#53-creating-the-github-app>5.3. Creating the GitHub App</a><ul><li><a href=#531-step-1-create-github-app>5.3.1. Step 1: Create GitHub App</a></li><li><a href=#532-step-2-note-the-app-id>5.3.2. Step 2: Note the App ID</a></li><li><a href=#533-step-3-generate-private-key>5.3.3. Step 3: Generate Private Key</a></li><li><a href=#534-step-4-install-app-on-repositories>5.3.4. Step 4: Install App on Repositories</a></li><li><a href=#535-step-5-add-secrets-to-my-documents>5.3.5. Step 5: Add Secrets to my-documents</a></li></ul></li><li><a href=#54-creating-personal-access-token-pat>5.4. Creating Personal Access Token (PAT)</a><ul><li><a href=#541-step-1-create-pat>5.4.1. Step 1: Create PAT</a></li><li><a href=#542-step-2-add-to-each-dependent-repository>5.4.2. Step 2: Add to Each Dependent Repository</a></li></ul></li><li><a href=#55-repository-settings>5.5. Repository Settings</a><ul><li><a href=#551-github-pages-configuration>5.5.1. GitHub Pages Configuration</a></li><li><a href=#552-branch-protection-optional>5.5.2. Branch Protection (Optional)</a></li></ul></li></ul></li><li><a href=#6-repository-integration>6. Repository Integration</a><ul><li><a href=#61-files-and-folder-structure>6.1. Files and Folder Structure</a><ul><li><a href=#611-required-structure-in-dependent-repository>6.1.1. Required Structure in Dependent Repository</a></li><li><a href=#612-required-structure-in-my-documents-orchestrator>6.1.2. Required Structure in my-documents (Orchestrator)</a></li></ul></li><li><a href=#62-migration-guide>6.2. Migration Guide</a></li><li><a href=#63-content-organization-best-practices>6.3. Content Organization Best Practices</a></li><li><a href=#64-repository-configuration-in-github>6.4. Repository Configuration in GitHub</a><ul><li><a href=#641-step-1-add-required-secrets>6.4.1. Step 1: Add Required Secrets</a></li><li><a href=#642-step-2-install-github-app>6.4.2. Step 2: Install GitHub App</a></li><li><a href=#643-step-3-configure-github-pages>6.4.3. Step 3: Configure GitHub Pages</a></li><li><a href=#644-step-4-verify-workflow-permissions>6.4.4. Step 4: Verify Workflow Permissions</a></li><li><a href=#645-step-5-test-the-integration>6.4.5. Step 5: Test the Integration</a></li><li><a href=#646-common-integration-issues>6.4.6. Common Integration Issues</a></li></ul></li></ul></li><li><a href=#7-authentication-setup-details>7. Authentication Setup Details</a><ul><li><a href=#71-github-app-vs-deploy-keys-comparison>7.1. GitHub App vs Deploy Keys Comparison</a></li><li><a href=#72-github-app-complete-setup>7.2. GitHub App Complete Setup</a></li><li><a href=#73-personal-access-token-pat-setup>7.3. Personal Access Token (PAT) Setup</a></li><li><a href=#74-token-lifecycle-and-rotation>7.4. Token Lifecycle and Rotation</a><ul><li><a href=#741-github-app-tokens>7.4.1. GitHub App Tokens</a></li><li><a href=#742-personal-access-tokens>7.4.2. Personal Access Tokens</a></li></ul></li><li><a href=#75-troubleshooting-authentication>7.5. Troubleshooting Authentication</a></li></ul></li><li><a href=#8-troubleshooting-multi-site-builds>8. Troubleshooting Multi-Site Builds</a><ul><li><a href=#81-build-failures>8.1. Build Failures</a><ul><li><a href=#811-issue-matrix-build-fails-for-one-site>8.1.1. Issue: Matrix Build Fails for One Site</a></li><li><a href=#812-issue-all-sites-fail-to-build>8.1.2. Issue: All Sites Fail to Build</a></li></ul></li><li><a href=#82-configuration-merge-issues>8.2. Configuration Merge Issues</a><ul><li><a href=#821-issue-site-specific-config-not-applied>8.2.1. Issue: Site-Specific Config Not Applied</a></li><li><a href=#822-issue-configuration-merge-produces-invalid-yaml>8.2.2. Issue: Configuration Merge Produces Invalid YAML</a></li></ul></li><li><a href=#83-deployment-failures>8.3. Deployment Failures</a><ul><li><a href=#831-issue-github-app-authentication-fails>8.3.1. Issue: GitHub App Authentication Fails</a></li><li><a href=#832-issue-deploy-succeeds-but-site-not-updated>8.3.2. Issue: Deploy Succeeds but Site Not Updated</a></li></ul></li><li><a href=#84-trigger-issues>8.4. Trigger Issues</a><ul><li><a href=#841-issue-repository-dispatch-not-triggering-build>8.4.1. Issue: Repository Dispatch Not Triggering Build</a></li><li><a href=#842-issue-unwanted-builds-too-many-triggers>8.4.2. Issue: Unwanted Builds (Too Many Triggers)</a></li></ul></li><li><a href=#85-content-and-link-issues>8.5. Content and Link Issues</a><ul><li><a href=#851-issue-internal-links-return-404>8.5.1. Issue: Internal Links Return 404</a></li><li><a href=#852-issue-images-not-displaying>8.5.2. Issue: Images Not Displaying</a></li></ul></li><li><a href=#86-performance-issues>8.6. Performance Issues</a><ul><li><a href=#861-issue-builds-taking-too-long>8.6.1. Issue: Builds Taking Too Long</a></li></ul></li><li><a href=#87-debugging-checklist>8.7. Debugging Checklist</a></li></ul></li><li><a href=#9-advanced-configuration-topics>9. Advanced Configuration Topics</a><ul><li><a href=#91-configuration-merging-strategy>9.1. Configuration Merging Strategy</a><ul><li><a href=#911-how-yq-deep-merge-works>9.1.1. How yq Deep-Merge Works</a></li></ul></li><li><a href=#92-per-site-theme-customization>9.2. Per-Site Theme Customization</a><ul><li><a href=#921-theme-colors>9.2.1. Theme Colors</a></li><li><a href=#922-custom-logos>9.2.2. Custom Logos</a></li><li><a href=#923-custom-cssscss>9.2.3. Custom CSS/SCSS</a></li></ul></li><li><a href=#93-seo-and-metadata-customization>9.3. SEO and Metadata Customization</a><ul><li><a href=#931-per-site-seo-keywords>9.3.1. Per-Site SEO Keywords</a></li><li><a href=#932-custom-metadata>9.3.2. Custom Metadata</a></li><li><a href=#933-structured-data-json-ld>9.3.3. Structured Data (JSON-LD)</a></li></ul></li><li><a href=#94-menu-customization>9.4. Menu Customization</a><ul><li><a href=#941-custom-navigation-menu>9.4.1. Custom Navigation Menu</a></li><li><a href=#942-footer-links>9.4.2. Footer Links</a></li></ul></li><li><a href=#95-performance-optimization>9.5. Performance Optimization</a><ul><li><a href=#951-image-optimization>9.5.1. Image Optimization</a></li><li><a href=#952-minification>9.5.2. Minification</a></li><li><a href=#953-html-rendering-optimization>9.5.3. HTML Rendering Optimization</a></li></ul></li><li><a href=#96-multi-language-support>9.6. Multi-Language Support</a></li><li><a href=#97-search-configuration>9.7. Search Configuration</a></li></ul></li><li><a href=#10-contributing-to-the-orchestrator>10. Contributing to the Orchestrator</a><ul><li><a href=#101-types-of-contributions>10.1. Types of Contributions</a></li><li><a href=#102-development-workflow>10.2. Development Workflow</a><ul><li><a href=#1021-step-1-fork-and-clone>10.2.1. Step 1: Fork and Clone</a></li><li><a href=#1022-step-2-make-changes>10.2.2. Step 2: Make Changes</a></li><li><a href=#1023-step-3-test-across-all-sites>10.2.3. Step 3: Test Across All Sites</a></li><li><a href=#1024-step-4-commit-with-conventional-commits>10.2.4. Step 4: Commit with Conventional Commits</a></li></ul></li><li><a href=#103-testing-changes-locally>10.3. Testing Changes Locally</a><ul><li><a href=#1031-test-shared-layout-changes>10.3.1. Test Shared Layout Changes</a></li><li><a href=#1032-test-configuration-changes>10.3.2. Test Configuration Changes</a></li><li><a href=#1033-test-workflow-changes>10.3.3. Test Workflow Changes</a></li></ul></li><li><a href=#104-best-practices-for-contributors>10.4. Best Practices for Contributors</a><ul><li><a href=#1041-shared-components>10.4.1. Shared Components</a></li><li><a href=#1042-configuration-changes>10.4.2. Configuration Changes</a></li><li><a href=#1043-workflow-improvements>10.4.3. Workflow Improvements</a></li></ul></li><li><a href=#105-code-review-process>10.5. Code Review Process</a></li><li><a href=#106-adding-new-shared-features>10.6. Adding New Shared Features</a><ul><li><a href=#1061-example-adding-a-new-partial>10.6.1. Example: Adding a New Partial</a></li></ul></li><li><a href=#107-release-process>10.7. Release Process</a><ul><li><a href=#1071-versioning>10.7.1. Versioning</a></li><li><a href=#1072-deprecation-policy>10.7.2. Deprecation Policy</a></li></ul></li><li><a href=#108-getting-help>10.8. Getting Help</a></li></ul></li><li><a href=#11-documentation-structure>11. Documentation Structure</a><ul><li><a href=#111-adding-new-documentation>11.1. Adding New Documentation</a></li></ul></li><li><a href=#12-content-guidelines>12. Content Guidelines</a></li><li><a href=#13-seo-features>13. SEO Features</a></li><li><a href=#14-cicd-pipelines>14. CI/CD Pipelines</a><ul><li><a href=#141-build-all-sites-build-all-sitesyml>14.1. Build All Sites (build-all-sites.yml)</a></li><li><a href=#142-hugo-build--deploy-hugo-build-deployyml>14.2. Hugo Build & Deploy (hugo-build-deploy.yml)</a></li><li><a href=#143-pre-commit-linting-lintyml>14.3. Pre-commit Linting (lint.yml)</a></li></ul></li></ul></li></ul><h2 id=1-documentation-site-built-with-hugo>1. Documentation Site Built with Hugo</h2><p>This repository contains documentation built with
<a href=https://gohugo.io/>Hugo</a> static site generator and the
<a href=https://www.docsy.dev/>Docsy</a> theme. All content is in Markdown format and
automatically published to GitHub Pages.</p><h2 id=2-building-locally>2. Building Locally</h2><h3 id=21-prerequisites>2.1. Prerequisites</h3><ul><li><a href=https://gohugo.io/installation/>Hugo Extended</a> version 0.110+</li><li><a href=https://golang.org/doc/install>Go</a> version 1.18+</li></ul><h3 id=22-quick-start>2.2. Quick Start</h3><h4 id=221-install-hugo>2.2.1. Install Hugo</h4><p><strong>Linux:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>CGO_ENABLED</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span> go install -tags extended github.com/gohugoio/hugo@latest
</span></span></code></pre></div><p><strong>Or download from <a href=https://github.com/gohugoio/hugo/releases>Hugo &ldquo;extended&rdquo; releases</a></strong></p><h4 id=222-clone-and-setup>2.2.2. Clone and Setup</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git clone https://github.com/fchastanet/my-documents.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Download Hugo theme and dependencies</span>
</span></span><span style=display:flex><span>hugo mod get -u
</span></span></code></pre></div><h4 id=223-run-local-server>2.2.3. Run Local Server</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>hugo server -D
</span></span></code></pre></div><p>The site will be available at <code>http://localhost:1313/my-documents/</code></p><ul><li><code>-D</code> flag includes draft pages</li><li>Site auto-reloads on file changes</li><li>Press <code>Ctrl+C</code> to stop the server</li></ul><h3 id=23-building-for-production>2.3. Building for Production</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>hugo --minify
</span></span></code></pre></div><p>Output is generated in the <code>public/</code> directory.</p><h3 id=24-checking-site-statistics>2.4. Checking Site Statistics</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>hugo --printI18nWarnings --printPathWarnings --printUnusedTemplates
</span></span></code></pre></div><h2 id=3-multi-site-orchestrator-architecture>3. Multi-Site Orchestrator Architecture</h2><p>This repository serves as a <strong>centralized orchestrator</strong> that builds and deploys multiple documentation sites in a
coordinated fashion.</p><h3 id=31-architecture-overview>3.1. Architecture Overview</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>┌─────────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│                    my-documents (Orchestrator)                   │
</span></span><span style=display:flex><span>├─────────────────────────────────────────────────────────────────┤
</span></span><span style=display:flex><span>│  • Shared Hugo theme and layouts (shared/)                      │
</span></span><span style=display:flex><span>│  • Base configuration (configs/_base.yaml)                      │
</span></span><span style=display:flex><span>│  • Site-specific configs (configs/*.yaml)                       │
</span></span><span style=display:flex><span>│  • Build workflow (.github/workflows/build-all-sites.yml)       │
</span></span><span style=display:flex><span>│  • Deployment orchestration (GitHub App authentication)         │
</span></span><span style=display:flex><span>└────┬────────────┬────────────┬────────────┬─────────────────────┘
</span></span><span style=display:flex><span>     │            │            │            │
</span></span><span style=display:flex><span>     ▼            ▼            ▼            ▼
</span></span><span style=display:flex><span>┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
</span></span><span style=display:flex><span>│  bash-  │  │  bash-  │  │  bash-  │  │  bash-  │
</span></span><span style=display:flex><span>│compiler │  │  tools  │  │  tools- │  │   dev-  │
</span></span><span style=display:flex><span>│         │  │         │  │framework│  │   env   │
</span></span><span style=display:flex><span>└─────────┘  └─────────┘  └─────────┘  └─────────┘
</span></span><span style=display:flex><span>     │            │            │            │
</span></span><span style=display:flex><span>     └────┬───────┴────────┬───┴────────┬───┘
</span></span><span style=display:flex><span>          │                │            │
</span></span><span style=display:flex><span>          ▼                ▼            ▼
</span></span><span style=display:flex><span>    Push to master → Trigger orchestrator → Build all sites in parallel
</span></span><span style=display:flex><span>          │                                        │
</span></span><span style=display:flex><span>          └────────────────────────────────────────┘
</span></span><span style=display:flex><span>                            │
</span></span><span style=display:flex><span>                            ▼
</span></span><span style=display:flex><span>                  Deploy to GitHub Pages
</span></span><span style=display:flex><span>    (fchastanet.github.io/bash-compiler/, etc.)
</span></span></code></pre></div><h3 id=32-managed-documentation-sites>3.2. Managed Documentation Sites</h3><ul><li>Centralized orchestrator and documentation site<ul><li><a href=https://fchastanet.github.io/my-documents/>My Documents deployment</a></li><li><a href=https://github.com/fchastanet/my-documents>My Documents GitHub Repository</a></li></ul></li><li>Documentation for the Bash Compiler project<ul><li><a href=https://fchastanet.github.io/bash-compiler/>Bash Compiler deployment</a></li><li><a href=https://github.com/fchastanet/bash-compiler>Bash Compiler GitHub Repository</a></li></ul></li><li>Documentation for the Bash Tools project<ul><li><a href=https://fchastanet.github.io/bash-tools/>Bash Tools deployment</a></li><li><a href=https://github.com/fchastanet/bash-tools>Bash Tools GitHub Repository</a></li></ul></li><li>Documentation for the Bash Tools Framework project<ul><li><a href=https://fchastanet.github.io/bash-tools-framework/>Bash Tools Framework deployment</a></li><li><a href=https://github.com/fchastanet/bash-tools-framework>Bash Tools Framework GitHub Repository</a></li></ul></li><li>Documentation for the Bash Dev Env project<ul><li><a href=https://fchastanet.github.io/bash-dev-env/>Bash Dev Env deployment</a></li><li><a href=https://github.com/fchastanet/bash-dev-env>Bash Dev Env GitHub Repository</a></li></ul></li></ul><h3 id=33-shared-vs-site-specific-resources>3.3. Shared vs Site-Specific Resources</h3><p><strong>Shared Resources (All Sites):</strong></p><ul><li>Hugo theme (Docsy) and version</li><li>Common layouts and partials (<code>shared/layouts/</code>)</li><li>Base SCSS variables and assets (<code>shared/assets/</code>)</li><li>Content archetypes (<code>shared/archetypes/</code>)</li><li>SEO structured data and meta tags</li><li>Base configuration (<code>configs/_base.yaml</code>)</li></ul><p><strong>Site-Specific Resources:</strong></p><ul><li>Documentation content (<code>content/</code>)</li><li>Site configuration overrides (<code>configs/[site].yaml</code>)</li><li>Theme colors and branding</li><li>Navigation menu items</li><li>Repository links and metadata</li><li>Static assets specific to the site</li></ul><h3 id=34-how-it-works>3.4. How It Works</h3><ol><li><strong>Content Change:</strong> Developer pushes changes to any managed repository (e.g., bash-compiler)</li><li><strong>Trigger:</strong> Repository trigger workflow sends <code>repository_dispatch</code> event to my-documents orchestrator</li><li><strong>Checkout:</strong> Orchestrator checks out all repositories</li><li><strong>Parallel Build:</strong> GitHub Actions matrix builds all 5 sites simultaneously (~60s total)</li><li><strong>Config Merge:</strong> Each site gets base config + site-specific overrides merged with <code>yq</code></li><li><strong>Deploy:</strong> Sites deployed to respective GitHub Pages using GitHub App authentication</li><li><strong>Result:</strong> All documentation sites are updated and consistent</li></ol><h3 id=35-key-benefits>3.5. Key Benefits</h3><ul><li>✅ <strong>Guaranteed Consistency:</strong> All sites use the same Hugo theme version and shared components</li><li>✅ <strong>Single-Point Updates:</strong> Fix a bug once, deploy to all sites automatically</li><li>✅ <strong>Simplified Per-Repo Setup:</strong> Dependent repos need only 2 files (trigger workflow + content)</li><li>✅ <strong>Fast Parallel Builds:</strong> All 5 sites build simultaneously in ~60 seconds</li><li>✅ <strong>Centralized Authentication:</strong> One GitHub App manages deployments to all repositories</li><li>✅ <strong>Configuration Flexibility:</strong> Per-site customization while maintaining consistency</li></ul><h3 id=36-testing-multi-site-locally>3.6. Testing Multi-Site Locally</h3><p>To test multiple sites locally using symlinks:</p><p><strong>Step 1: Clone related repositories</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> /path/to/your/workspace
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/my-documents.git
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/bash-compiler.git
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/bash-tools.git
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/bash-tools-framework.git
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/bash-dev-env.git
</span></span></code></pre></div><p><strong>Step 2: Install dependencies</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>make install  <span style=color:#8f5902;font-style:italic># Installs Hugo, yq, npm packages, Go modules</span>
</span></span></code></pre></div><p><strong>Step 3: Link repositories</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>make link-repos  <span style=color:#8f5902;font-style:italic># Creates symlinks in sites/ directory</span>
</span></span></code></pre></div><p>This creates:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>my-documents/sites/
</span></span><span style=display:flex><span>├── bash-compiler -&gt; ../../bash-compiler
</span></span><span style=display:flex><span>├── bash-tools -&gt; ../../bash-tools
</span></span><span style=display:flex><span>├── bash-tools-framework -&gt; ../../bash-tools-framework
</span></span><span style=display:flex><span>└── bash-dev-env -&gt; ../../bash-dev-env
</span></span></code></pre></div><p><strong>Step 4: Build and test</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Build all sites</span>
</span></span><span style=display:flex><span>make build-all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test all sites with curl</span>
</span></span><span style=display:flex><span>make test-all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build a specific site</span>
</span></span><span style=display:flex><span>make build-site <span style=color:#000>SITE</span><span style=color:#ce5c00;font-weight:700>=</span>bash-compiler
</span></span></code></pre></div><p><strong>Step 5: Clean up</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Remove symlinks</span>
</span></span><span style=display:flex><span>make unlink-repos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Clean build artifacts</span>
</span></span><span style=display:flex><span>make clean
</span></span></code></pre></div><h3 id=37-makefile-commands>3.7. Makefile Commands</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>make <span style=color:#204a87>help</span>           <span style=color:#8f5902;font-style:italic># Show all available commands</span>
</span></span><span style=display:flex><span>make install        <span style=color:#8f5902;font-style:italic># Install all dependencies</span>
</span></span><span style=display:flex><span>make link-repos     <span style=color:#8f5902;font-style:italic># Create symlinks to other repos</span>
</span></span><span style=display:flex><span>make unlink-repos   <span style=color:#8f5902;font-style:italic># Remove symlinks</span>
</span></span><span style=display:flex><span>make build-all      <span style=color:#8f5902;font-style:italic># Build all sites locally</span>
</span></span><span style=display:flex><span>make build-site     <span style=color:#8f5902;font-style:italic># Build specific site (SITE=name)</span>
</span></span><span style=display:flex><span>make test-all       <span style=color:#8f5902;font-style:italic># Build and test all sites with curl</span>
</span></span><span style=display:flex><span>make start          <span style=color:#8f5902;font-style:italic># Start Hugo dev server (my-documents)</span>
</span></span><span style=display:flex><span>make build          <span style=color:#8f5902;font-style:italic># Build my-documents only</span>
</span></span><span style=display:flex><span>make clean          <span style=color:#8f5902;font-style:italic># Remove build artifacts</span>
</span></span></code></pre></div><h2 id=4-creating-a-new-documentation-site>4. Creating a New Documentation Site</h2><p>This section guides you through adding a new documentation site to the orchestrator.</p><h3 id=41-prerequisites>4.1. Prerequisites</h3><p>Before adding a new site, ensure:</p><ul><li><input disabled type=checkbox> Repository exists and contains documentation to migrate</li><li><input disabled type=checkbox> You have admin access to both my-documents and the new repository</li><li><input disabled type=checkbox> Hugo Extended and Go are installed locally for testing</li><li><input disabled type=checkbox> You understand the orchestrator architecture (see Section 4)</li></ul><h3 id=42-step-by-step-guide>4.2. Step-by-Step Guide</h3><h4 id=421-step-1-prepare-the-new-repository>4.2.1. Step 1: Prepare the New Repository</h4><ol><li><p><strong>Clone the repository:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git clone https://github.com/fchastanet/your-new-repo.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> your-new-repo
</span></span></code></pre></div></li><li><p><strong>Create content structure:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>mkdir -p content/en/docs
</span></span></code></pre></div></li><li><p><strong>Create homepage</strong> (<code>content/en/_index.md</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Your Project Name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Brief project description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>Welcome to the documentation!</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>## Features</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>Feature 1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#000>Feature 2</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Create docs landing page</strong> (<code>content/en/docs/_index.md</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Documentation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Complete documentation for Your Project</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Migrate existing content</strong> (see Section 7.2 for detailed migration guide)</p></li></ol><h4 id=422-step-2-add-trigger-workflow>4.2.2. Step 2: Add Trigger Workflow</h4><p>Create <code>.github/workflows/trigger-docs.yml</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger Documentation Rebuild</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;static/**&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;.github/workflows/trigger-docs.yml&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>workflow_dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>runs-on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ubuntu-latest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>steps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger my-documents orchestrator</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>peter-evans/repository-dispatch@v3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.DOCS_BUILD_TOKEN }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>repository</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>event-type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>trigger-docs-rebuild</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>          </span><span style=color:#204a87;font-weight:700>client-payload</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            {
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;repository&#34;: &#34;${{ github.repository }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;ref&#34;: &#34;${{ github.ref }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;sha&#34;: &#34;${{ github.sha }}&#34;,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>              &#34;triggered_by&#34;: &#34;${{ github.actor }}&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            }</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Build triggered</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          echo &#34;✅ Documentation build triggered in fchastanet/my-documents&#34;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          echo &#34;🔗 Check status: https://github.com/fchastanet/my-documents/actions&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=423-step-3-create-site-configuration-in-my-documents>4.2.3. Step 3: Create Site Configuration in my-documents</h4><ol><li><p><strong>Clone my-documents:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> /path/to/workspace
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/my-documents.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> my-documents
</span></span></code></pre></div></li><li><p><strong>Create site config</strong> (<code>configs/your-new-repo.yaml</code>):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>baseURL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://fchastanet.github.io/your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Your Project Name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Brief description for SEO and meta tags</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Brief description for SEO and meta tags</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>keyword1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>keyword2</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>keyword3</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Theme color (hex color code)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#ff6600&#39;</span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Choose a unique color</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Repository links</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>github_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>github_project_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Footer links</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>links</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GitHub Repository</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>icon</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fab fa-github</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li></ol><h4 id=424-step-4-update-build-workflow-matrix>4.2.4. Step 4: Update Build Workflow Matrix</h4><p>Edit <code>.github/workflows/build-all-sites.yml</code> and add your site to the matrix:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>matrix</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>site</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># ... existing sites ...</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/your-new-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>baseURL</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://fchastanet.github.io/your-new-repo&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>self</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=425-step-5-configure-github-see-section-6-for-details>4.2.5. Step 5: Configure GitHub (See Section 6 for details)</h4><ol><li><p><strong>Add Personal Access Token to new repository:</strong></p><ul><li>Go to new repository → Settings → Secrets → Actions</li><li>Add secret: <code>DOCS_BUILD_TOKEN</code> (see Section 6.2)</li></ul></li><li><p><strong>Install GitHub App on new repository</strong> (see Section 6.3)</p></li></ol><h4 id=426-step-6-test-locally>4.2.6. Step 6: Test Locally</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Link your new repository</span>
</span></span><span style=display:flex><span>ln -s ../../your-new-repo sites/your-new-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build the site</span>
</span></span><span style=display:flex><span>make build-site <span style=color:#000>SITE</span><span style=color:#ce5c00;font-weight:700>=</span>your-new-repo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test the output</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> build/your-new-repo
</span></span><span style=display:flex><span>hugo server -D --port <span style=color:#0000cf;font-weight:700>1314</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Visit http://localhost:1314/your-new-repo/</span>
</span></span></code></pre></div><h4 id=427-step-7-commit-and-deploy>4.2.7. Step 7: Commit and Deploy</h4><ol><li><p><strong>Commit changes to my-documents:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>git add configs/your-new-repo.yaml .github/workflows/build-all-sites.yml
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;feat: add your-new-repo to orchestrator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Add site configuration with unique theme color
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Update build matrix to include your-new-repo
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Enable automated documentation deployment
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>git push origin master
</span></span></code></pre></div></li><li><p><strong>Commit trigger workflow to new repository:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> your-new-repo
</span></span><span style=display:flex><span>git add .github/workflows/trigger-docs.yml content/
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;feat: add Hugo content structure and orchestrator trigger
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Migrate content to Hugo format
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Add trigger workflow for my-documents orchestrator
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Configure content structure for Docsy theme
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;</span>
</span></span><span style=display:flex><span>git push origin master
</span></span></code></pre></div></li><li><p><strong>Verify deployment:</strong></p><ul><li>Check my-documents Actions: <a href=https://github.com/fchastanet/my-documents/actions>https://github.com/fchastanet/my-documents/actions</a></li><li>Wait for build to complete (~60s)</li><li>Visit your site: <code>https://fchastanet.github.io/your-new-repo/</code></li></ul></li></ol><h3 id=43-post-creation-checklist>4.3. Post-Creation Checklist</h3><ul><li><input disabled type=checkbox> Site builds successfully in ci/CD</li><li><input disabled type=checkbox> GitHub Pages deployment completes without errors</li><li><input disabled type=checkbox> Live site is accessible at expected URL</li><li><input disabled type=checkbox> Navigation works correctly</li><li><input disabled type=checkbox> Internal links resolve properly</li><li><input disabled type=checkbox> Images and static assets display correctly</li><li><input disabled type=checkbox> SEO meta tags are present (view source)</li><li><input disabled type=checkbox> Sitemap is generated: <code>https://fchastanet.github.io/your-new-repo/sitemap.xml</code></li><li><input disabled type=checkbox> Mobile responsive layout works</li><li><input disabled type=checkbox> Search functionality works (Docsy local search)</li></ul><h2 id=5-github-configuration>5. GitHub Configuration</h2><p>This section covers authentication, secrets, and repository settings required for the orchestrator.</p><h3 id=51-architecture-github-app-authentication>5.1. Architecture: GitHub App Authentication</h3><p>The orchestrator uses a <strong>GitHub App</strong> for secure, fine-grained authentication when deploying to dependent
repositories.</p><p><strong>Why GitHub App (vs Deploy Keys)?</strong></p><ul><li>✅ <strong>Fine-grained permissions:</strong> Only Contents and Pages write access</li><li>✅ <strong>Centralized management:</strong> One app deploys to all repositories</li><li>✅ <strong>Better security:</strong> Automatic token expiration and rotation</li><li>✅ <strong>Audit trail:</strong> All actions logged under app identity</li><li>✅ <strong>Easily scalable:</strong> Add/remove repositories without generating new keys</li><li>✅ <strong>Revocable:</strong> Instantly revoke access from app settings</li></ul><h3 id=52-required-secrets>5.2. Required Secrets</h3><h4 id=521-in-my-documents-repository>5.2.1. In my-documents Repository</h4><table><thead><tr><th>Secret Name</th><th>Purpose</th><th>How to Obtain</th></tr></thead><tbody><tr><td><code>DOC_APP_ID</code></td><td>GitHub App ID for deployments</td><td>Step 3 of GitHub App creation (Section 6.3)</td></tr><tr><td><code>DOC_APP_PRIVATE_KEY</code></td><td>GitHub App private key (PEM format)</td><td>Step 4 of GitHub App creation (Section 6.3)</td></tr></tbody></table><h4 id=522-in-each-dependent-repository>5.2.2. In Each Dependent Repository</h4><table><thead><tr><th>Secret Name</th><th>Purpose</th><th>How to Obtain</th></tr></thead><tbody><tr><td><code>DOCS_BUILD_TOKEN</code></td><td>Personal Access Token to trigger builds</td><td>Create PAT with <code>repo</code> scope (Section 6.4)</td></tr></tbody></table><h3 id=53-creating-the-github-app>5.3. Creating the GitHub App</h3><p>If the GitHub App doesn&rsquo;t exist yet, follow these steps:</p><h4 id=531-step-1-create-github-app>5.3.1. Step 1: Create GitHub App</h4><ol><li><p>Navigate to <a href=https://github.com/settings/apps/new>https://github.com/settings/apps/new</a> (or Organization → Settings → GitHub Apps → New)</p></li><li><p>Fill in app details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Name: My Documents Site Deployer
</span></span><span style=display:flex><span>Description: Deploys documentation sites to GitHub Pages for fchastanet projects
</span></span><span style=display:flex><span>Homepage URL: https://github.com/fchastanet/my-documents
</span></span><span style=display:flex><span>Callback URL: (leave blank)
</span></span><span style=display:flex><span>Webhook: ✗ Uncheck &#34;Active&#34;
</span></span></code></pre></div></li><li><p>Set repository permissions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Repository permissions:
</span></span><span style=display:flex><span>- Contents: Read and write  ← Deploy to gh-pages branch
</span></span><span style=display:flex><span>- Pages: Read and write     ← Trigger GitHub Pages build
</span></span><span style=display:flex><span>- Metadata: Read-only       ← (automatic, required)
</span></span></code></pre></div></li><li><p>Where can this app be installed?</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>○ Only on this account
</span></span></code></pre></div></li><li><p>Click <strong>&ldquo;Create GitHub App&rdquo;</strong></p></li></ol><h4 id=532-step-2-note-the-app-id>5.3.2. Step 2: Note the App ID</h4><ul><li>App ID is displayed at the top of the app settings page</li><li>Example: <code>App ID: 123456</code></li><li>You&rsquo;ll need this for <code>DOC_APP_ID</code> secret</li></ul><h4 id=533-step-3-generate-private-key>5.3.3. Step 3: Generate Private Key</h4><ol><li>Scroll to &ldquo;Private keys&rdquo; section</li><li>Click <strong>&ldquo;Generate a private key&rdquo;</strong></li><li>Download the <code>.pem</code> file (e.g., <code>my-documents-site-deployer.2026-02-19.private-key.pem</code>)</li><li><strong>Store securely</strong> (password manager or encrypted storage)</li></ol><p>⚠️ <strong>Security Warning:</strong> Private key provides write access to repositories. Never commit it to git.</p><h4 id=534-step-4-install-app-on-repositories>5.3.4. Step 4: Install App on Repositories</h4><ol><li>In app settings → <strong>&ldquo;Install App&rdquo;</strong> (left sidebar)</li><li>Click <strong>&ldquo;Install&rdquo;</strong> next to your account (fchastanet)</li><li>Select <strong>&ldquo;Only select repositories&rdquo;</strong></li><li>Choose repositories:<ul><li><code>bash-compiler</code></li><li><code>bash-tools</code></li><li><code>bash-tools-framework</code></li><li><code>bash-dev-env</code></li><li><em>(Add your new repository here)</em></li></ul></li><li>Click <strong>&ldquo;Install&rdquo;</strong></li></ol><h4 id=535-step-5-add-secrets-to-my-documents>5.3.5. Step 5: Add Secrets to my-documents</h4><ol><li>Go to <a href=https://github.com/fchastanet/my-documents/settings/secrets/actions>https://github.com/fchastanet/my-documents/settings/secrets/actions</a></li><li>Click <strong>&ldquo;New repository secret&rdquo;</strong></li></ol><p><strong>Secret 1: DOC_APP_ID</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Name: DOC_APP_ID
</span></span><span style=display:flex><span>Value: 123456  # Your App ID from Step 2
</span></span></code></pre></div><p><strong>Secret 2: DOC_APP_PRIVATE_KEY</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Name: DOC_APP_PRIVATE_KEY
</span></span><span style=display:flex><span>Value: # Paste ENTIRE content of .pem file, including BEGIN/END lines
</span></span></code></pre></div><h3 id=54-creating-personal-access-token-pat>5.4. Creating Personal Access Token (PAT)</h3><p>Each dependent repository needs a Personal Access Token to trigger builds in my-documents.</p><h4 id=541-step-1-create-pat>5.4.1. Step 1: Create PAT</h4><ol><li><p>Go to <a href=https://github.com/settings/tokens>https://github.com/settings/tokens</a></p></li><li><p>Click <strong>&ldquo;Generate new token&rdquo;</strong> → <strong>&ldquo;Generate new token (classic)&rdquo;</strong></p></li><li><p>Fill in details:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Note: Documentation Build Trigger
</span></span><span style=display:flex><span>Expiration: No expiration (or 1 year)
</span></span><span style=display:flex><span>Scopes:
</span></span><span style=display:flex><span>  ✅ repo (Full control of private repositories)
</span></span><span style=display:flex><span>    ✅ repo:status
</span></span><span style=display:flex><span>    ✅ repo_deployment
</span></span><span style=display:flex><span>    ✅ public_repo
</span></span></code></pre></div></li><li><p>Click <strong>&ldquo;Generate token&rdquo;</strong></p></li><li><p><strong>Copy the token immediately</strong> (you won&rsquo;t see it again)</p></li></ol><h4 id=542-step-2-add-to-each-dependent-repository>5.4.2. Step 2: Add to Each Dependent Repository</h4><p>For each repository (bash-compiler, bash-tools, etc.):</p><ol><li><p>Go to repository → Settings → Secrets and variables → Actions</p></li><li><p>Click <strong>&ldquo;New repository secret&rdquo;</strong></p></li><li><p>Add:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Name: DOCS_BUILD_TOKEN
</span></span><span style=display:flex><span>Value: ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx  # Your PAT
</span></span></code></pre></div></li></ol><h3 id=55-repository-settings>5.5. Repository Settings</h3><h4 id=551-github-pages-configuration>5.5.1. GitHub Pages Configuration</h4><p>For each dependent repository:</p><ol><li>Go to repository → Settings → Pages</li><li><strong>Source:</strong> Deploy from a branch</li><li><strong>Branch:</strong> <code>gh-pages</code> / <code>(root)</code></li><li><strong>Custom domain:</strong> (leave blank unless you have one)</li><li><strong>Enforce HTTPS:</strong> ✅ Checked</li></ol><p>The orchestrator will create and manage the <code>gh-pages</code> branch automatically.</p><h4 id=552-branch-protection-optional>5.5.2. Branch Protection (Optional)</h4><p>For <code>master</code> branch in dependent repositories:</p><ol><li>Go to repository → Settings → Branches</li><li>Add rule for <code>master</code>:<ul><li>✅ Require a pull request before merging</li><li>✅ Require status checks to pass (Documentation build)</li><li>✅ Require branches to be up to date</li></ul></li></ol><h2 id=6-repository-integration>6. Repository Integration</h2><p>This section covers integrating an existing or new repository into the orchestrator.</p><h3 id=61-files-and-folder-structure>6.1. Files and Folder Structure</h3><h4 id=611-required-structure-in-dependent-repository>6.1.1. Required Structure in Dependent Repository</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>your-new-repo/
</span></span><span style=display:flex><span>├── .github/
</span></span><span style=display:flex><span>│   └── workflows/
</span></span><span style=display:flex><span>│       └── trigger-docs.yml          ← Triggers orchestrator (required)
</span></span><span style=display:flex><span>├── content/
</span></span><span style=display:flex><span>│   └── en/
</span></span><span style=display:flex><span>│       ├── _index.md                 ← Homepage (required)
</span></span><span style=display:flex><span>│       └── docs/
</span></span><span style=display:flex><span>│           ├── _index.md             ← Docs landing page (required)
</span></span><span style=display:flex><span>│           └── *.md                  ← Documentation pages
</span></span><span style=display:flex><span>├── static/                           ← Static assets (optional)
</span></span><span style=display:flex><span>│   ├── images/
</span></span><span style=display:flex><span>│   └── downloads/
</span></span><span style=display:flex><span>├── README.md                         ← Repository README (recommended)
</span></span><span style=display:flex><span>└── LICENSE                           ← License file (recommended)
</span></span></code></pre></div><p><strong>Not Required in Dependent Repository:</strong></p><ul><li>❌ <code>hugo.yaml</code> (generated by orchestrator from configs/)</li><li>❌ <code>go.mod</code> / <code>go.sum</code> (managed by orchestrator)</li><li>❌ Hugo build workflows (orchestrator handles this)</li><li>❌ Theme files (shared from my-documents)</li></ul><h4 id=612-required-structure-in-my-documents-orchestrator>6.1.2. Required Structure in my-documents (Orchestrator)</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>my-documents/
</span></span><span style=display:flex><span>├── configs/
</span></span><span style=display:flex><span>│   ├── _base.yaml                    ← Shared base config
</span></span><span style=display:flex><span>│   └── your-new-repo.yaml            ← Site-specific overrides
</span></span><span style=display:flex><span>├── shared/
</span></span><span style=display:flex><span>│   ├── layouts/                      ← Shared Hugo templates
</span></span><span style=display:flex><span>│   ├── assets/                       ← Shared SCSS, JS
</span></span><span style=display:flex><span>│   └── archetypes/                   ← Content templates
</span></span><span style=display:flex><span>└── .github/workflows/
</span></span><span style=display:flex><span>    └── build-all-sites.yml           ← Orchestrator workflow (update matrix)
</span></span></code></pre></div><h3 id=62-migration-guide>6.2. Migration Guide</h3><p>For detailed migration from Docsify or other static site generators to Hugo, see:</p><p><strong>📄 <a href=doc/ai/2026-02-18-migrate-repo-from-docsify-to-hugo.md>Complete Migration Guide</a></strong></p><p>The migration guide covers:</p><ul><li>Analyzing current documentation structure</li><li>Converting Docsify/other formats to Hugo content structure</li><li>Content migration strategies (markdown conversion)</li><li>Adding proper frontmatter to all pages</li><li>Updating internal links and image references</li><li>Testing migration locally</li><li>Validation checklist</li></ul><p><strong>Quick Migration Overview:</strong></p><ol><li><strong>Analyze current structure</strong> - Identify all documentation files and organization</li><li><strong>Create Hugo content structure</strong> - <code>content/en/docs/</code> hierarchy</li><li><strong>Add frontmatter</strong> - Title, description, weight to all pages</li><li><strong>Convert content</strong> - Update syntax, links, shortcodes</li><li><strong>Migrate assets</strong> - Move to <code>static/</code> directory</li><li><strong>Test locally</strong> - Build with orchestrator, verify output</li><li><strong>Deploy</strong> - Commit and push to trigger automated build</li></ol><h3 id=63-content-organization-best-practices>6.3. Content Organization Best Practices</h3><p><strong>Directory Structure Example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>content/en/docs/
</span></span><span style=display:flex><span>├── _index.md                         # Docs landing page (weight: 1)
</span></span><span style=display:flex><span>├── getting-started/
</span></span><span style=display:flex><span>│   ├── _index.md                     # Section landing (weight: 10)
</span></span><span style=display:flex><span>│   ├── installation.md               # (weight: 10)
</span></span><span style=display:flex><span>│   ├── quickstart.md                 # (weight: 20)
</span></span><span style=display:flex><span>│   └── configuration.md              # (weight: 30)
</span></span><span style=display:flex><span>├── guides/
</span></span><span style=display:flex><span>│   ├── _index.md                     # (weight: 20)
</span></span><span style=display:flex><span>│   ├── basic-usage.md
</span></span><span style=display:flex><span>│   └── advanced-topics.md
</span></span><span style=display:flex><span>└── reference/
</span></span><span style=display:flex><span>    ├── _index.md                     # (weight: 30)
</span></span><span style=display:flex><span>    ├── api.md
</span></span><span style=display:flex><span>    └── cli.md
</span></span></code></pre></div><p><strong>Frontmatter Template:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Page Title</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Brief description for SEO (100-160 characters recommended)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>                            </span><span style=color:#8f5902;font-style:italic># Lower numbers appear first in navigation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>categories</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>documentation]          </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional categories</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>bash, linux, tutorial]        </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Optional tags</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Navigation Ordering:</strong></p><ul><li>Hugo uses <code>weight</code> to order pages (ascending order)</li><li>Lower weight = higher in menu (10 before 20)</li><li>Same weight = alphabetical order by title</li><li>Section <code>_index.md</code> establishes section weight</li></ul><h3 id=64-repository-configuration-in-github>6.4. Repository Configuration in GitHub</h3><p>After creating content and workflows, configure the repository:</p><h4 id=641-step-1-add-required-secrets>6.4.1. Step 1: Add Required Secrets</h4><p>See Section 6.2 and 6.4 for details.</p><ol><li>Add <code>DOCS_BUILD_TOKEN</code> secret to dependent repository</li><li>Ensure my-documents has <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code></li></ol><h4 id=642-step-2-install-github-app>6.4.2. Step 2: Install GitHub App</h4><p>See Section 6.3, Step 4 for details.</p><ol><li>Go to <a href=https://github.com/settings/installations>https://github.com/settings/installations</a></li><li>Click &ldquo;Configure&rdquo; on &ldquo;My Documents Site Deployer&rdquo;</li><li>Add your repository to &ldquo;Repository access&rdquo;</li><li>Click &ldquo;Save&rdquo;</li></ol><h4 id=643-step-3-configure-github-pages>6.4.3. Step 3: Configure GitHub Pages</h4><ol><li>Go to repository → Settings → Pages</li><li>Source: <strong>Deploy from a branch</strong></li><li>Branch: <strong>gh-pages</strong> / (root)</li><li>Click &ldquo;Save&rdquo;</li></ol><p>⚠️ <strong>Note:</strong> The <code>gh-pages</code> branch will be created automatically on first deployment. Don&rsquo;t create it manually.</p><h4 id=644-step-4-verify-workflow-permissions>6.4.4. Step 4: Verify Workflow Permissions</h4><ol><li>Go to repository → Settings → Actions → General</li><li>Workflow permissions:<ul><li>✅ <strong>Read and write permissions</strong> (for creating gh-pages branch)</li><li>✅ <strong>Allow GitHub Actions to create and approve pull requests</strong> (optional)</li></ul></li></ol><h4 id=645-step-5-test-the-integration>6.4.5. Step 5: Test the Integration</h4><ol><li><p><strong>Make a test commit</strong> to content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87>cd</span> your-new-repo
</span></span><span style=display:flex><span><span style=color:#204a87>echo</span> <span style=color:#4e9a06>&#34;Test update&#34;</span> &gt;&gt; content/en/docs/_index.md
</span></span><span style=display:flex><span>git add content/en/docs/_index.md
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;test: trigger documentation build&#34;</span>
</span></span><span style=display:flex><span>git push origin master
</span></span></code></pre></div></li><li><p><strong>Verify trigger workflow</strong> runs in your repository:</p><ul><li>Go to <a href=https://github.com/fchastanet/your-new-repo/actions>https://github.com/fchastanet/your-new-repo/actions</a></li><li>Check &ldquo;Trigger Documentation Rebuild&rdquo; workflow succeeded</li></ul></li><li><p><strong>Verify orchestrator build</strong> in my-documents:</p><ul><li>Go to <a href=https://github.com/fchastanet/my-documents/actions>https://github.com/fchastanet/my-documents/actions</a></li><li>Check &ldquo;Build All Documentation Sites&rdquo; workflow running</li><li>Look for your site in the matrix build jobs</li></ul></li><li><p><strong>Verify deployment:</strong></p><ul><li>Wait for build to complete (~60s)</li><li>Visit <code>https://fchastanet.github.io/your-new-repo/</code></li><li>Check that test update is visible</li></ul></li></ol><h4 id=646-common-integration-issues>6.4.6. Common Integration Issues</h4><table><thead><tr><th>Issue</th><th>Solution</th></tr></thead><tbody><tr><td>Trigger workflow fails</td><td>Check <code>DOCS_BUILD_TOKEN</code> secret exists and is valid</td></tr><tr><td>Build workflow fails</td><td>Check GitHub App installed on repository</td></tr><tr><td>Deployment fails</td><td>Check <code>gh-pages</code> branch permissions and Pages settings</td></tr><tr><td>Site not accessible</td><td>Wait 2-3 minutes for GitHub Pages propagation</td></tr><tr><td>404 on site</td><td>Check <code>baseURL in configs/your-new-repo.yaml</code></td></tr></tbody></table><h2 id=7-authentication-setup-details>7. Authentication Setup Details</h2><p>This section provides comprehensive details on authentication mechanisms.</p><h3 id=71-github-app-vs-deploy-keys-comparison>7.1. GitHub App vs Deploy Keys Comparison</h3><table><thead><tr><th>Feature</th><th>GitHub App (Recommended)</th><th>Deploy Keys</th></tr></thead><tbody><tr><td><strong>Secrets Required</strong></td><td>2 (App ID + Private Key)</td><td>N (one per repository)</td></tr><tr><td><strong>Permissions</strong></td><td>Fine-grained (Contents, Pages)</td><td>Full repository access</td></tr><tr><td><strong>Token Expiration</strong></td><td>Automatic (1 hour)</td><td>Never (manual rotation needed)</td></tr><tr><td><strong>Scalability</strong></td><td>Easy (add repos to app)</td><td>Creates new key pair per repo</td></tr><tr><td><strong>Audit Trail</strong></td><td>Full (logged as app)</td><td>Limited (logged as deploy key)</td></tr><tr><td><strong>Revocation</strong></td><td>Instant (uninstall app)</td><td>Per-key (delete each key)</td></tr><tr><td><strong>Setup Complexity</strong></td><td>Medium (one-time)</td><td>Low (per repo)</td></tr><tr><td><strong>GitHub Recommendation</strong></td><td>✅ Yes</td><td>❌ Deprecated for this use case</td></tr></tbody></table><p><strong>Conclusion:</strong> GitHub App is the better choice for the orchestrator architecture.</p><h3 id=72-github-app-complete-setup>7.2. GitHub App Complete Setup</h3><p>See Section 6.3 for step-by-step instructions.</p><p><strong>Quick Reference:</strong></p><ol><li>Create app at <a href=https://github.com/settings/apps/new>https://github.com/settings/apps/new</a></li><li>Set permissions: Contents (write), Pages (write)</li><li>Generate and download private key (.pem file)</li><li>Note the App ID</li><li>Install app on target repositories</li><li>Add <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code> to my-documents secrets</li></ol><h3 id=73-personal-access-token-pat-setup>7.3. Personal Access Token (PAT) Setup</h3><p>See Section 6.4 for step-by-step instructions.</p><p><strong>Quick Reference:</strong></p><ol><li>Create PAT at <a href=https://github.com/settings/tokens>https://github.com/settings/tokens</a></li><li>Scopes: <code>repo</code> (full control)</li><li>Expiration: No expiration or 1 year</li><li>Add <code>DOCS_BUILD_TOKEN</code> to each dependent repository</li></ol><p><strong>Security Note:</strong> PAT has full <code>repo</code> access. It&rsquo;s used only to trigger <code>repository_dispatch</code> events, which is a
safe operation. Still, protect it like a password.</p><h3 id=74-token-lifecycle-and-rotation>7.4. Token Lifecycle and Rotation</h3><h4 id=741-github-app-tokens>7.4.1. GitHub App Tokens</h4><ul><li><strong>Lifetime:</strong> 1 hour (automatic)</li><li><strong>Rotation:</strong> Automatic (new token generated each build)</li><li><strong>Manual Rotation:</strong> Regenerate private key in app settings if compromised</li></ul><h4 id=742-personal-access-tokens>7.4.2. Personal Access Tokens</h4><ul><li><strong>Lifetime:</strong> As configured (no expiration or 1 year)</li><li><strong>Rotation:</strong> Manual</li><li><strong>Best Practice:</strong> Rotate annually or when team members leave</li></ul><p><strong>To Rotate PAT:</strong></p><ol><li>Create new PAT (Section 6.4)</li><li>Update <code>DOCS_BUILD_TOKEN</code> in all dependent repositories</li><li>Delete old PAT from <a href=https://github.com/settings/tokens>https://github.com/settings/tokens</a></li></ol><h3 id=75-troubleshooting-authentication>7.5. Troubleshooting Authentication</h3><table><thead><tr><th>Issue</th><th>Diagnosis</th><th>Solution</th></tr></thead><tbody><tr><td>&ldquo;Bad credentials&rdquo; error</td><td>GitHub App token expired/invalid</td><td>Check <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code></td></tr><tr><td>&ldquo;Resource not accessible&rdquo; error</td><td>GitHub App not installed on repo</td><td>Install app on repository (Section 6.3.4)</td></tr><tr><td>Trigger workflow unauthorized</td><td>PAT invalid or insufficient scope</td><td>Regenerate PAT with <code>repo</code> scope</td></tr><tr><td></td><td></td><td>(Section 6.4)</td></tr><tr><td>Deploy fails with 403</td><td>GitHub App lacks Pages permission</td><td>Check app permissions (Section 6.3.1)</td></tr><tr><td>Token generation fails</td><td>Private key malformed</td><td>Re-download .pem file, ensure complete copy</td></tr></tbody></table><h2 id=8-troubleshooting-multi-site-builds>8. Troubleshooting Multi-Site Builds</h2><p>This section covers common issues and solutions specific to the orchestrator.</p><h3 id=81-build-failures>8.1. Build Failures</h3><h4 id=811-issue-matrix-build-fails-for-one-site>8.1.1. Issue: Matrix Build Fails for One Site</h4><p><strong>Symptoms:</strong></p><ul><li>One site fails while others succeed</li><li>Error message specific to site content or configuration</li></ul><p><strong>Diagnosis:</strong></p><ol><li>Check GitHub Actions logs for the failing site</li><li>Look for errors in the matrix job output</li><li>Identify if it&rsquo;s a content issue or configuration issue</li></ol><p><strong>Solutions:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Test site locally to reproduce error</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>make build-site <span style=color:#000>SITE</span><span style=color:#ce5c00;font-weight:700>=</span>failing-site-name
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check configuration merge</span>
</span></span><span style=display:flex><span>yq eval-all <span style=color:#4e9a06>&#39;select(fileIndex == 0) * select(fileIndex == 1)&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/_base.yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/failing-site.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Validate content frontmatter</span>
</span></span><span style=display:flex><span>grep -r <span style=color:#4e9a06>&#34;^---</span>$<span style=color:#4e9a06>&#34;</span> sites/failing-site/content/
</span></span></code></pre></div><h4 id=812-issue-all-sites-fail-to-build>8.1.2. Issue: All Sites Fail to Build</h4><p><strong>Symptoms:</strong></p><ul><li>Entire matrix fails</li><li>Error occurs before individual site builds</li></ul><p><strong>Common Causes:</strong></p><ol><li>Hugo version incompatibility</li><li>yq installation failure</li><li>Go module resolution issues</li><li>Base configuration syntax error</li></ol><p><strong>Solutions:</strong></p><ol><li><p>Check Hugo version in workflow matches local: <code>0.155.3</code></p></li><li><p>Verify yq installation step succeeded</p></li><li><p>Check <code>configs/_base.yaml</code> for YAML syntax errors:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>yq <span style=color:#204a87>eval</span> configs/_base.yaml
</span></span></code></pre></div></li><li><p>Review workflow logs for specific error messages</p></li></ol><h3 id=82-configuration-merge-issues>8.2. Configuration Merge Issues</h3><h4 id=821-issue-site-specific-config-not-applied>8.2.1. Issue: Site-Specific Config Not Applied</h4><p><strong>Symptoms:</strong></p><ul><li>Site uses base configuration instead of overrides</li><li>Theme color or title not correct</li></ul><p><strong>Diagnosis:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Test configuration merge locally</span>
</span></span><span style=display:flex><span>yq eval-all <span style=color:#4e9a06>&#39;select(fileIndex == 0) * select(fileIndex == 1)&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/_base.yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/your-site.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check if keys are being merged (should be combined, not duplicated)</span>
</span></span></code></pre></div><p><strong>Solutions:</strong></p><ol><li>Ensure site config uses correct YAML syntax (2-space indentation)</li><li>Verify override keys match base config structure</li><li>Use <code>yq</code> deep-merge syntax (not simple concatenation)</li></ol><h4 id=822-issue-configuration-merge-produces-invalid-yaml>8.2.2. Issue: Configuration Merge Produces Invalid YAML</h4><p><strong>Symptoms:</strong></p><ul><li><code>yq</code> merge succeeds but Hugo fails to parse <code>hugo.yaml</code></li><li>YAML syntax errors in workflow</li></ul><p><strong>Solutions:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Validate both configs individually</span>
</span></span><span style=display:flex><span>yq <span style=color:#204a87>eval</span> configs/_base.yaml
</span></span><span style=display:flex><span>yq <span style=color:#204a87>eval</span> configs/your-site.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test merge and validate result</span>
</span></span><span style=display:flex><span>yq eval-all <span style=color:#4e9a06>&#39;select(fileIndex == 0) * select(fileIndex == 1)&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/_base.yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/your-site.yaml <span style=color:#000;font-weight:700>|</span> yq <span style=color:#204a87>eval</span> -
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Common issues:</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Missing quotes around URLs</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Incorrect indentation (use 2 spaces, not tabs)</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># - Invalid YAML anchors or aliases</span>
</span></span></code></pre></div><h3 id=83-deployment-failures>8.3. Deployment Failures</h3><h4 id=831-issue-github-app-authentication-fails>8.3.1. Issue: GitHub App Authentication Fails</h4><p><strong>Symptoms:</strong></p><ul><li>Error: &ldquo;Could not authenticate with GitHub App&rdquo;</li><li>Deploy step fails with 401 or 403</li></ul><p><strong>Solutions:</strong></p><ol><li><p>Verify secrets exist in my-documents:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Check in GitHub UI</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://github.com/fchastanet/my-documents/settings/secrets/actions</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Ensure DOC_APP_ID and DOC_APP_PRIVATE_KEY are set</span>
</span></span></code></pre></div></li><li><p>Verify GitHub App is installed on target repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Check installations</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># https://github.com/settings/installations</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Click &#34;Configure&#34; → Verify repository is in access list</span>
</span></span></code></pre></div></li><li><p>Verify app permissions (Contents: write, Pages: write)</p></li></ol><h4 id=832-issue-deploy-succeeds-but-site-not-updated>8.3.2. Issue: Deploy Succeeds but Site Not Updated</h4><p><strong>Symptoms:</strong></p><ul><li>Deploy step succeeds in workflow</li><li>GitHub Pages still shows old content</li></ul><p><strong>Solutions:</strong></p><ol><li><p><strong>Check gh-pages branch:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Clone repository</span>
</span></span><span style=display:flex><span>git clone https://github.com/fchastanet/your-site.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> your-site
</span></span><span style=display:flex><span>git checkout gh-pages
</span></span><span style=display:flex><span>git log -1  <span style=color:#8f5902;font-style:italic># Check latest commit timestamp</span>
</span></span></code></pre></div></li><li><p><strong>Clear GitHub Actions cache:</strong></p><ul><li>Go to repository → Actions → Caches</li><li>Delete all caches</li><li>Re-run workflow</li></ul></li><li><p><strong>Wait for propagation:</strong></p><ul><li>GitHub Pages can take 2-3 minutes to update</li><li>Check deployment status in repository → Settings → Pages</li></ul></li><li><p><strong>Verify Pages settings:</strong></p><ul><li>Source: Deploy from a branch</li><li>Branch: gh-pages / (root)</li></ul></li></ol><h3 id=84-trigger-issues>8.4. Trigger Issues</h3><h4 id=841-issue-repository-dispatch-not-triggering-build>8.4.1. Issue: Repository Dispatch Not Triggering Build</h4><p><strong>Symptoms:</strong></p><ul><li>Commit to dependent repository doesn&rsquo;t trigger my-documents build</li><li>Trigger workflow succeeds but orchestrator doesn&rsquo;t run</li></ul><p><strong>Solutions:</strong></p><ol><li><p><strong>Verify PAT has correct scope:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># PAT must have &#39;repo&#39; scope</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Check: https://github.com/settings/tokens</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Regenerate if necessary (Section 6.4)</span>
</span></span></code></pre></div></li><li><p><strong>Check event type matches:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># In trigger workflow (dependent repo)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>event-type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>trigger-docs-rebuild</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Must match orchestrator workflow</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>repository_dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>types</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>trigger-docs-rebuild] </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Must match exactly</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Verify secret name:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># In trigger workflow</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>token</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>${{ secrets.DOCS_BUILD_TOKEN }} </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Must be this exact name</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Check workflow logs</strong> in dependent repository for API errors</p></li></ol><h4 id=842-issue-unwanted-builds-too-many-triggers>8.4.2. Issue: Unwanted Builds (Too Many Triggers)</h4><p><strong>Symptoms:</strong></p><ul><li>Builds trigger on every commit</li><li>Builds trigger even when only README changes</li></ul><p><strong>Solutions:</strong></p><p>Update <code>paths</code> filter in trigger workflow:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Only content changes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;static/**&#39;</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Only static asset changes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Remove other paths if too many triggers</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=85-content-and-link-issues>8.5. Content and Link Issues</h3><h4 id=851-issue-internal-links-return-404>8.5.1. Issue: Internal Links Return 404</h4><p><strong>Symptoms:</strong></p><ul><li>Navigation works but internal links broken</li><li>Links work locally but not on deployed site</li></ul><p><strong>Solutions:</strong></p><ol><li><p><strong>Use Hugo shortcodes for internal links:</strong>
escaped here to prevent rendering by hugo</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span>\{\{&lt; ref &#34;/docs/section/page&#34; &gt;\}\}
</span></span></code></pre></div></li><li><p><strong>Use relative paths without .md extension:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span>[<span style=color:#204a87;font-weight:700>Link text</span>](<span style=color:#c4a000>/docs/section/page/</span>)
</span></span></code></pre></div></li><li><p><strong>Avoid absolute URLs for internal links:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span>❌ [<span style=color:#204a87;font-weight:700>Bad</span>](<span style=color:#c4a000>https://fchastanet.github.io/site/docs/page/</span>)
</span></span><span style=display:flex><span>✅ [<span style=color:#204a87;font-weight:700>Good</span>](<span style=color:#c4a000>/docs/page/</span>)
</span></span></code></pre></div></li></ol><h4 id=852-issue-images-not-displaying>8.5.2. Issue: Images Not Displaying</h4><p><strong>Symptoms:</strong></p><ul><li>Images work locally but 404 on deployed site</li></ul><p><strong>Solutions:</strong></p><ol><li><p><strong>Use correct path from static directory:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span><span style=color:navy;font-weight:700># File: static/images/diagram.png
</span></span></span><span style=display:flex><span>![<span style=color:#204a87;font-weight:700>Diagram</span>](<span style=color:#c4a000>/images/diagram.png</span>)  ✅
</span></span><span style=display:flex><span>![<span style=color:#204a87;font-weight:700>Diagram</span>](<span style=color:#c4a000>images/diagram.png</span>)   ❌
</span></span></code></pre></div></li><li><p><strong>Verify image exists in static directory:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>ls -la sites/your-site/static/images/
</span></span></code></pre></div></li><li><p><strong>Check build output includes images:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>ls -la build/your-site/public/images/
</span></span></code></pre></div></li></ol><h3 id=86-performance-issues>8.6. Performance Issues</h3><h4 id=861-issue-builds-taking-too-long>8.6.1. Issue: Builds Taking Too Long</h4><p><strong>Symptoms:</strong></p><ul><li>Build time exceeds 5 minutes</li><li>Workflow times out</li></ul><p><strong>Solutions:</strong></p><ol><li><p><strong>Enable matrix parallelization</strong> (already enabled):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>strategy</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>fail-fast</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Ensures parallel execution</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li><li><p><strong>Reduce content size:</strong></p><ul><li>Optimize images (compress, resize)</li><li>Remove unused static assets</li><li>Archive old documentation versions</li></ul></li><li><p><strong>Cache Hugo modules (future optimization):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Add caching step</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Cache Hugo modules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>actions/cache@v4</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>path</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      ~/.cache/hugo_cache
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>      /tmp/hugo_cache</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>key</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>hugo-modules-${{ hashFiles(&#39;**/go.sum&#39;) }}</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div></li></ol><h3 id=87-debugging-checklist>8.7. Debugging Checklist</h3><p>When troubleshooting, follow this systematic approach:</p><ol><li><p><strong>Identify the failure point:</strong></p><ul><li><input disabled type=checkbox> Trigger workflow (dependent repo)</li><li><input disabled type=checkbox> Orchestrator workflow started</li><li><input disabled type=checkbox> Specific site build failed</li><li><input disabled type=checkbox> Deployment failed</li><li><input disabled type=checkbox> Site not accessible</li></ul></li><li><p><strong>Gather information:</strong></p><ul><li><input disabled type=checkbox> Check GitHub Actions logs</li><li><input disabled type=checkbox> Review error messages</li><li><input disabled type=checkbox> Check workflow run details</li><li><input disabled type=checkbox> Visit repository deployment status</li></ul></li><li><p><strong>Reproduce locally:</strong></p><ul><li><input disabled type=checkbox> Clone repository</li><li><input disabled type=checkbox> Run <code>make build-site SITE=failing-site</code></li><li><input disabled type=checkbox> Check local build output</li></ul></li><li><p><strong>Verify configuration:</strong></p><ul><li><input disabled type=checkbox> YAML syntax valid</li><li><input disabled type=checkbox> Secrets exist and are correct</li><li><input disabled type=checkbox> GitHub App installed</li><li><input disabled type=checkbox> Permissions configured</li></ul></li><li><p><strong>Test incrementally:</strong></p><ul><li><input disabled type=checkbox> Test config merge</li><li><input disabled type=checkbox> Test Hugo build</li><li><input disabled type=checkbox> Test with minimal content</li><li><input disabled type=checkbox> Add content gradually</li></ul></li></ol><h2 id=9-advanced-configuration-topics>9. Advanced Configuration Topics</h2><p>This section covers advanced customization and optimization techniques.</p><h3 id=91-configuration-merging-strategy>9.1. Configuration Merging Strategy</h3><h4 id=911-how-yq-deep-merge-works>9.1.1. How yq Deep-Merge Works</h4><p>The orchestrator uses <code>yq</code> for proper YAML deep-merging (not simple concatenation):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>yq eval-all <span style=color:#4e9a06>&#39;select(fileIndex == 0) * select(fileIndex == 1)&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/_base.yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/site-specific.yaml &gt; hugo.yaml
</span></span></code></pre></div><p><strong>Behavior:</strong></p><ul><li><strong>Scalar values:</strong> Site-specific overrides base (complete replacement)</li><li><strong>Objects:</strong> Deep merge (combine keys from both)</li><li><strong>Arrays:</strong> Site-specific replaces base entirely (not appended)</li></ul><p><strong>Example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/_base.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#333333&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>sidebar_width</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>250px</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>documentation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>hugo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># configs/bash-compiler.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#007bff&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>bash</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Merged result</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#007bff&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Overridden</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>sidebar_width</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>250px         </span><span style=color:#f8f8f8> </span><span style=color:#8f5902;font-style:italic># Inherited from base</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>                       </span><span style=color:#8f5902;font-style:italic># Array replaced entirely</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>bash</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>compiler</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=92-per-site-theme-customization>9.2. Per-Site Theme Customization</h3><h4 id=921-theme-colors>9.2.1. Theme Colors</h4><p>Each site can have unique branding:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#ff6600&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Navbar background</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_text_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#ffffff&#39;</span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># Navbar text</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>sidebar_bg_color</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;#f8f9fa&#39;</span><span style=color:#f8f8f8>     </span><span style=color:#8f5902;font-style:italic># Sidebar background</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Color Palette Recommendations:</strong></p><ul><li>my-documents: <code>#663399</code> (Deep Purple)</li><li>bash-compiler: <code>#007bff</code> (Blue)</li><li>bash-tools: <code>#28a745</code> (Green)</li><li>bash-tools-framework: <code>#dc3545</code> (Red)</li><li>bash-dev-env: <code>#fd7e14</code> (Orange)</li></ul><h4 id=922-custom-logos>9.2.2. Custom Logos</h4><p>Override logo per site:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>ui</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>navbar_logo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/images/logo.svg</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>sidebar_logo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/images/logo-sidebar.svg</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Place logos in dependent repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># your-site/static/images/logo.svg</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># your-site/static/images/logo-sidebar.svg</span>
</span></span></code></pre></div><h4 id=923-custom-cssscss>9.2.3. Custom CSS/SCSS</h4><p><strong>Option 1: Site-specific SCSS in shared/</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-scss data-lang=scss><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>// shared/assets/scss/_variables_project.scss
</span></span></span><span style=display:flex><span><span style=color:#000>$custom-your-site-color</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>#ff6600</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p><strong>Option 2: Site-specific CSS in dependent repo</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-css data-lang=css><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>/* your-site/static/css/custom.css */</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>.</span><span style=color:#000>navbar</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>background-color</span><span style=color:#000;font-weight:700>:</span> <span style=color:#0000cf;font-weight:700>#ff6600</span> <span style=color:#8f5902;font-style:italic>!important</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Reference in config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>custom_css</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>/css/custom.css</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=93-seo-and-metadata-customization>9.3. SEO and Metadata Customization</h3><h4 id=931-per-site-seo-keywords>9.3.1. Per-Site SEO Keywords</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Comprehensive documentation for Your Project Name</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>keywords</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>your</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>specific</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#000>keywords</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=932-custom-metadata>9.3.2. Custom Metadata</h4><p>Add custom meta tags via site config:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>meta_tags</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;author&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;Your Name&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;og:type&#34;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>content</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#34;website&#34;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=933-structured-data-json-ld>9.3.3. Structured Data (JSON-LD)</h4><p>Shared structured data is in <code>shared/layouts/partials/hooks/head-end.html</code>. Customize per site:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-html data-lang=html><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>&lt;!-- Create: sites/your-site/layouts/partials/hooks/head-end.html --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>script</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/ld+json&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;@context&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;https://schema.org&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;@type&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;SoftwareApplication&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;name&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Your Project&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;description&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Project description&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#4e9a06>&#34;url&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;{{ .Site.BaseURL }}&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>script</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><h3 id=94-menu-customization>9.4. Menu Customization</h3><h4 id=941-custom-navigation-menu>9.4.1. Custom Navigation Menu</h4><p>Override default menu per site:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>menu</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>main</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Documentation</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/docs/</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>10</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Guides</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/docs/guides/</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>API</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>/docs/api/</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>30</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GitHub</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-site</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>40</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=942-footer-links>9.4.2. Footer Links</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>links</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>user</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>GitHub</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-site</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>icon</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fab fa-github</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Issues</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-site/issues</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>icon</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fas fa-bug</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>developer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Contribute</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>url</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>https://github.com/fchastanet/your-site/blob/master/CONTRIBUTING.md</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>icon</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fas fa-code</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=95-performance-optimization>9.5. Performance Optimization</h3><h4 id=951-image-optimization>9.5.1. Image Optimization</h4><p>Hugo can process and optimize images:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/_base.yaml (already configured)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>imaging</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>resampleFilter</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>CatmullRom</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>quality</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>75</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>anchor</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>smart</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Use responsive images in content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span><figure><img src=/images/large-image.png alt=Description width=600px>
</figure>

</span></span></code></pre></div><h4 id=952-minification>9.5.2. Minification</h4><p>Already enabled in build workflow:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>hugo --minify
</span></span></code></pre></div><p>This minifies:</p><ul><li>HTML</li><li>CSS</li><li>JavaScript</li><li>JSON</li><li>XML</li></ul><h4 id=953-html-rendering-optimization>9.5.3. HTML Rendering Optimization</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/_base.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>markup</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>goldmark</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>renderer</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>unsafe: false           # Security</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>disable raw HTML</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>highlight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>anchorLineNos: false     # Faster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8> </span><span style=color:#000>line number anchors</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>lineNos: false           # Faster</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>no</span><span style=color:#f8f8f8> </span><span style=color:#000>line numbers</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>lineNumbersInTable</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=96-multi-language-support>9.6. Multi-Language Support</h3><p>Hugo/Docsy supports multiple languages. To add:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>languages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>en</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Your Project</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>English description</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>languageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>English</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>fr</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>title</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Votre Project</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>description</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Description française</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>languageName</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Français</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>weight</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Create content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>content/en/docs/guide.md
</span></span><span style=display:flex><span>content/fr/docs/guide.md
</span></span></code></pre></div><h3 id=97-search-configuration>9.7. Search Configuration</h3><p>Docsy includes local search (already configured). To customize:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># configs/your-site.yaml</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>params</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>search</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>algolia</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>enabled</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>false</span><span style=color:#f8f8f8>         </span><span style=color:#8f5902;font-style:italic># Use local search (default)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>offlineSearch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>        </span><span style=color:#8f5902;font-style:italic># Enable offline search index</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>offlineSearchMaxResults</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>20</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>offlineSearchSummaryLength</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#0000cf;font-weight:700>200</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=10-contributing-to-the-orchestrator>10. Contributing to the Orchestrator</h2><p>This section guides contributors who want to improve the orchestrator itself.</p><h3 id=101-types-of-contributions>10.1. Types of Contributions</h3><p><strong>Shared Components:</strong></p><ul><li>Layouts and partials (<code>shared/layouts/</code>)</li><li>SCSS variables and styles (<code>shared/assets/</code>)</li><li>Content archetypes (<code>shared/archetypes/</code>)</li><li>SEO enhancements (<code>shared/layouts/partials/hooks/</code>)</li></ul><p><strong>Configuration:</strong></p><ul><li>Base configuration improvements (<code>configs/_base.yaml</code>)</li><li>New site additions (site-specific configs)</li></ul><p><strong>Workflows:</strong></p><ul><li>Build optimizations (<code>.github/workflows/build-all-sites.yml</code>)</li><li>New optional workflows (testing, validation)</li></ul><p><strong>Documentation:</strong></p><ul><li>README improvements</li><li>Troubleshooting guide additions</li><li>Migration guide updates</li></ul><h3 id=102-development-workflow>10.2. Development Workflow</h3><h4 id=1021-step-1-fork-and-clone>10.2.1. Step 1: Fork and Clone</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git clone https://github.com/fchastanet/my-documents.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> my-documents
</span></span><span style=display:flex><span>git checkout -b feature/your-improvement
</span></span></code></pre></div><h4 id=1022-step-2-make-changes>10.2.2. Step 2: Make Changes</h4><ol><li><strong>Edit shared components</strong> in <code>shared/</code></li><li><strong>Test changes locally</strong> (see Section 11.3)</li><li><strong>Verify all sites</strong> still build correctly</li></ol><h4 id=1023-step-3-test-across-all-sites>10.2.3. Step 3: Test Across All Sites</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Link all repositories</span>
</span></span><span style=display:flex><span>make link-repos
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build all sites</span>
</span></span><span style=display:flex><span>make build-all
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Test all sites</span>
</span></span><span style=display:flex><span>make test-all
</span></span></code></pre></div><h4 id=1024-step-4-commit-with-conventional-commits>10.2.4. Step 4: Commit with Conventional Commits</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git add shared/layouts/partials/your-change.html
</span></span><span style=display:flex><span>git commit -m <span style=color:#4e9a06>&#34;feat: add new partial for feature X
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Add partial to enhance functionality
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Update documentation
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>- Test across all sites
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>&#34;</span>
</span></span></code></pre></div><h3 id=103-testing-changes-locally>10.3. Testing Changes Locally</h3><h4 id=1031-test-shared-layout-changes>10.3.1. Test Shared Layout Changes</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Build specific site to test layout</span>
</span></span><span style=display:flex><span>make build-site <span style=color:#000>SITE</span><span style=color:#ce5c00;font-weight:700>=</span>bash-compiler
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Start local server</span>
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> build/bash-compiler
</span></span><span style=display:flex><span>hugo server -D --port <span style=color:#0000cf;font-weight:700>1314</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Visit http://localhost:1314/bash-compiler/</span>
</span></span></code></pre></div><h4 id=1032-test-configuration-changes>10.3.2. Test Configuration Changes</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># Test config merge</span>
</span></span><span style=display:flex><span>yq eval-all <span style=color:#4e9a06>&#39;select(fileIndex == 0) * select(fileIndex == 1)&#39;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/_base.yaml <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span>  configs/bash-compiler.yaml <span style=color:#000;font-weight:700>|</span> tee /tmp/test-config.yaml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Build with test config</span>
</span></span><span style=display:flex><span>hugo --config /tmp/test-config.yaml --minify
</span></span></code></pre></div><h4 id=1033-test-workflow-changes>10.3.3. Test Workflow Changes</h4><ol><li><p><strong>Push to your fork:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git push origin feature/your-improvement
</span></span></code></pre></div></li><li><p><strong>Create PR</strong> to fchastanet/my-documents</p></li><li><p><strong>Workflow will run</strong> on PR (test build before merge)</p></li></ol><h3 id=104-best-practices-for-contributors>10.4. Best Practices for Contributors</h3><h4 id=1041-shared-components>10.4.1. Shared Components</h4><ul><li><strong>Test across all sites</strong> before committing</li><li><strong>Keep changes backward compatible</strong> (don&rsquo;t break existing sites)</li><li><strong>Document new features</strong> in comments and README</li><li><strong>Use descriptive variable names</strong> in layouts/partials</li></ul><h4 id=1042-configuration-changes>10.4.2. Configuration Changes</h4><ul><li><strong>Preserve base config integrity</strong> (don&rsquo;t remove existing keys)</li><li><strong>Document new parameters</strong> in comments</li><li><strong>Test config merge</strong> with all site-specific configs</li><li><strong>Validate YAML syntax</strong> before committing</li></ul><h4 id=1043-workflow-improvements>10.4.3. Workflow Improvements</h4><ul><li><strong>Test workflow changes in fork</strong> before PR</li><li><strong>Ensure backward compatibility</strong> with existing triggers</li><li><strong>Document workflow parameters</strong> in comments</li><li><strong>Keep build times efficient</strong> (avoid unnecessary steps)</li></ul><h3 id=105-code-review-process>10.5. Code Review Process</h3><ol><li><strong>Create PR</strong> with descriptive title and description</li><li><strong>Ensure CI passes</strong> (lint workflow)</li><li><strong>Request review</strong> from maintainers</li><li><strong>Address feedback</strong> promptly</li><li><strong>Squash and merge</strong> after approval</li></ol><h3 id=106-adding-new-shared-features>10.6. Adding New Shared Features</h3><h4 id=1061-example-adding-a-new-partial>10.6.1. Example: Adding a New Partial</h4><ol><li><p><strong>Create partial:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-html data-lang=html><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>&lt;!-- shared/layouts/partials/custom-feature.html --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;custom-feature&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>  {{ .Inner }}
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div></li><li><p><strong>Reference in base layout:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-html data-lang=html><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic>&lt;!-- shared/layouts/partials/hooks/head-end.html --&gt;</span>
</span></span><span style=display:flex><span>{{ partial &#34;custom-feature.html&#34; . }}
</span></span></code></pre></div></li><li><p><strong>Test across all sites:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>make build-all
</span></span></code></pre></div></li><li><p><strong>Document usage:</strong></p><p>Update README with usage instructions</p></li></ol><h3 id=107-release-process>10.7. Release Process</h3><h4 id=1071-versioning>10.7.1. Versioning</h4><p>The orchestrator doesn&rsquo;t use semantic versioning (continuous deployment), but significant changes should be
documented:</p><ol><li><p><strong>Update CHANGELOG.md</strong> (create if doesn&rsquo;t exist)</p></li><li><p><strong>Tag release</strong> for major changes:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-bash data-lang=bash><span style=display:flex;background-color:#dfdfdf><span>git tag -a v2.0.0 -m <span style=color:#4e9a06>&#34;Release v2.0.0: Multi-site orchestrator&#34;</span>
</span></span><span style=display:flex><span>git push origin v2.0.0
</span></span></code></pre></div></li></ol><h4 id=1072-deprecation-policy>10.7.2. Deprecation Policy</h4><p>When deprecating features:</p><ol><li><strong>Announce deprecation</strong> in README and PR</li><li><strong>Keep deprecated feature</strong> for 1 month minimum</li><li><strong>Provide migration path</strong> in documentation</li><li><strong>Remove after grace period</strong></li></ol><h3 id=108-getting-help>10.8. Getting Help</h3><ul><li><strong>Issues:</strong> <a href=https://github.com/fchastanet/my-documents/issues>https://github.com/fchastanet/my-documents/issues</a></li><li><strong>Discussions:</strong> <a href=https://github.com/fchastanet/my-documents/discussions>https://github.com/fchastanet/my-documents/discussions</a></li><li><strong>Documentation:</strong> This README and related guides</li></ul><h2 id=11-documentation-structure>11. Documentation Structure</h2><p>The documentation is organized as follows:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>content/en/
</span></span><span style=display:flex><span>├── _index.html              # Homepage
</span></span><span style=display:flex><span>└── docs/
</span></span><span style=display:flex><span>    ├── _index.md            # Docs landing page
</span></span><span style=display:flex><span>    ├── bash-scripts/        # Bash scripting guides
</span></span><span style=display:flex><span>    ├── howtos/              # How-to guides
</span></span><span style=display:flex><span>    ├── lists/               # Reference lists
</span></span><span style=display:flex><span>    └── other-projects/      # Links to related projects
</span></span></code></pre></div><h3 id=111-adding-new-documentation>11.1. Adding New Documentation</h3><ol><li>Create a Markdown file in the appropriate <code>content/en/docs/</code> subdirectory</li><li>Add frontmatter with title, description, and weight (for ordering)</li><li>Save and Hugo will automatically rebuild the site</li></ol><p>Example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span>---
</span></span><span style=display:flex><span>title: My New Page
</span></span><span style=display:flex><span>description: Brief description of the page
</span></span><span style=display:flex><span>weight: 10
</span></span><span style=display:flex><span>---
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Your content here...
</span></span></code></pre></div><h2 id=12-content-guidelines>12. Content Guidelines</h2><ul><li>Keep Markdown files focused and well-organized</li><li>Use ATX-style headers (<code>#</code>, <code>##</code>, etc.)</li><li>Line length: 120 characters maximum (enforced by mdformat)</li><li>Line endings: LF only</li><li>Use relative links for internal navigation</li><li>Code blocks should specify language: <code>```bash ```,</code> <code>yaml</code>, etc.</li></ul><h2 id=13-seo-features>13. SEO Features</h2><p>This site includes the following SEO optimizations:</p><ul><li>Static HTML pre-rendering for all content</li><li>Automatic XML sitemap generation</li><li>Responsive design and mobile-first approach</li><li>Optimized page load performance</li><li>Per-page metadata and structured data (JSON-LD)</li><li>RSS feeds for content distribution</li><li>Canonical URLs to prevent duplication</li><li>Open Graph and Twitter card support</li><li>Breadcrumb navigation with schema markup</li></ul><h2 id=14-cicd-pipelines>14. CI/CD Pipelines</h2><h3 id=141-build-all-sites-build-all-sitesyml>14.1. Build All Sites (build-all-sites.yml)</h3><p>Centralized orchestrator that:</p><ul><li>Builds all documentation sites in parallel</li><li>Merges base + site-specific configs using <code>yq</code></li><li>Deploys each site to its own GitHub Pages</li><li>Triggers on push to <code>master</code> or via <code>repository_dispatch</code></li></ul><h3 id=142-hugo-build--deploy-hugo-build-deployyml>14.2. Hugo Build & Deploy (hugo-build-deploy.yml)</h3><ul><li>Builds my-documents site only</li><li>Validates build output</li><li>Deploys to GitHub Pages automatically</li></ul><h3 id=143-pre-commit-linting-lintyml>14.3. Pre-commit Linting (lint.yml)</h3><ul><li>Runs Markdown and code quality checks</li><li>Auto-fixes formatting/linting issues</li><li>Runs MegaLinter validation</li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-89d09adaad4557c5a3cf18be5dab7166>1.8 - My Documents - Trigger Reusable Workflow Documentation</h1><div class=lead>Overview of the technical architecture and implementation details of the My Documents reusable workflow for triggering documentation builds</div><ul><li><a href=#trigger-my-documents-reusable-workflow>Trigger My-Documents Reusable Workflow</a><ul><li><a href=#1-overview>1. Overview</a></li><li><a href=#2-quick-start>2. Quick Start</a><ul><li><a href=#21-basic-usage>2.1. Basic Usage</a></li></ul></li><li><a href=#3-how-it-works>3. How It Works</a><ul><li><a href=#31-architecture>3.1. Architecture</a></li><li><a href=#32-authentication-flow>3.2. Authentication Flow</a></li></ul></li><li><a href=#4-configuration>4. Configuration</a><ul><li><a href=#41-input-parameters>4.1. Input Parameters</a></li><li><a href=#42-advanced-usage-examples>4.2. Advanced Usage Examples</a><ul><li><a href=#421-custom-documentation-url>4.2.1. Custom Documentation URL</a></li><li><a href=#422-different-target-repository>4.2.2. Different Target Repository</a></li><li><a href=#423-manual-trigger-with-custom-event-type>4.2.3. Manual Trigger with Custom Event Type</a></li></ul></li></ul></li><li><a href=#5-complete-example>5. Complete Example</a></li><li><a href=#6-secrets-configuration>6. Secrets Configuration</a><ul><li><a href=#61-in-my-documents-repository>6.1. In my-documents Repository</a></li><li><a href=#62-in-dependent-repositories>6.2. In Dependent Repositories</a></li></ul></li><li><a href=#7-understanding-secrets-inherit-and-access-control>7. Understanding Secrets: Inherit and Access Control</a><ul><li><a href=#71-what-is-secrets-inherit>7.1. What is <code>secrets: inherit</code>?</a></li><li><a href=#72-how-does-it-work-for-dependent-repositories>7.2. How Does It Work for Dependent Repositories?</a></li><li><a href=#73-secret-access-hierarchy>7.3. Secret Access Hierarchy</a></li><li><a href=#74-why-this-workflow-cant-be-used-by-others>7.4. Why This Workflow Can&rsquo;t Be Used by Others</a><ul><li><a href=#741-reason-1-github-app-is-organization-specific>7.4.1. Reason 1: GitHub App is Organization-Specific</a></li><li><a href=#742-reason-2-github-app-has-no-access-to-other-organizations>7.4.2. Reason 2: GitHub App Has No Access to Other Organizations</a></li><li><a href=#743-reason-3-secrets-are-repository-specific>7.4.3. Reason 3: Secrets Are Repository-Specific</a></li></ul></li><li><a href=#75-practical-example-why-it-fails>7.5. Practical Example: Why It Fails</a></li><li><a href=#76-how-someone-else-could-create-their-own-version>7.6. How Someone Else Could Create Their Own Version</a></li><li><a href=#77-summary-why-this-workflow-is-fchastanet-only>7.7. Summary: Why This Workflow is Fchastanet-Only</a></li><li><a href=#78-conclusion>7.8. Conclusion</a></li></ul></li><li><a href=#8-workflow-outputs>8. Workflow Outputs</a><ul><li><a href=#81-console-output>8.1. Console Output</a></li><li><a href=#82-github-actions-summary>8.2. GitHub Actions Summary</a></li></ul></li><li><a href=#9-troubleshooting>9. Troubleshooting</a><ul><li><a href=#91-build-not-triggered>9.1. Build Not Triggered</a></li><li><a href=#92-authentication-failures>9.2. Authentication Failures</a></li><li><a href=#93-workflow-not-found>9.3. Workflow Not Found</a></li><li><a href=#94-debug-mode>9.4. Debug Mode</a></li></ul></li><li><a href=#10-migration-guide>10. Migration Guide</a><ul><li><a href=#101-from-old-trigger-workflow>10.1. From Old Trigger Workflow</a></li></ul></li><li><a href=#11-best-practices>11. Best Practices</a><ul><li><a href=#111-trigger-paths>11.1. Trigger Paths</a></li><li><a href=#112-concurrency-control>11.2. Concurrency Control</a></li><li><a href=#113-conditional-triggers>11.3. Conditional Triggers</a></li></ul></li><li><a href=#12-faq>12. FAQ</a><ul><li><a href=#121-q-do-i-need-to-configure-secrets-in-my-dependent-repository>12.1. Q: Do I need to configure secrets in my dependent repository?</a></li><li><a href=#122-q-can-i-test-the-workflow-before-merging-to-master>12.2. Q: Can I test the workflow before merging to master?</a></li><li><a href=#123-q-how-long-does-documentation-deployment-take>12.3. Q: How long does documentation deployment take?</a></li><li><a href=#124-q-can-i-use-this-with-my-own-organization>12.4. Q: Can I use this with my own organization?</a></li><li><a href=#125-q-what-if-the-build-fails>12.5. Q: What if the build fails?</a></li><li><a href=#126-q-can-i-trigger-builds-for-multiple-repositories>12.6. Q: Can I trigger builds for multiple repositories?</a></li></ul></li><li><a href=#13-related-documentation>13. Related Documentation</a></li><li><a href=#14-support>14. Support</a></li></ul></li></ul><h1 id=trigger-my-documents-reusable-workflow>Trigger My-Documents Reusable Workflow</h1><h2 id=1-overview>1. Overview</h2><p>The <code>trigger-docs-reusable.yml</code> workflow is a reusable GitHub Actions workflow that enables dependent repositories
(bash-compiler, bash-tools, bash-tools-framework, bash-dev-env) to trigger documentation builds in the centralized
my-documents orchestrator.</p><p><strong>Benefits:</strong></p><ul><li><strong>No secrets required</strong> in dependent repositories (GitHub handles authentication automatically)</li><li><strong>Centralized configuration</strong> - All authentication handled by GitHub App in my-documents</li><li><strong>Configurable</strong> - Override defaults for organization, repository, URLs, etc.</li><li><strong>Secure</strong> - Uses GitHub App authentication with automatic token expiration</li><li><strong>Simple integration</strong> - Just a few lines in dependent repo workflows</li></ul><h2 id=2-quick-start>2. Quick Start</h2><h3 id=21-basic-usage>2.1. Basic Usage</h3><p>Create <code>.github/workflows/trigger-docs.yml</code> in your dependent repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger Documentation Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;static/**&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.mod&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.sum&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>workflow_dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>That&rsquo;s it! No secrets to configure, no tokens to manage.</p><h2 id=3-how-it-works>3. How It Works</h2><h3 id=31-architecture>3.1. Architecture</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>      ┌─────────────────────────┐
</span></span><span style=display:flex><span>      │  Dependent Repository   │
</span></span><span style=display:flex><span>      │  (e.g., bash-compiler)  │
</span></span><span style=display:flex><span>      │                         │
</span></span><span style=display:flex><span>      │  Push to master branch  │
</span></span><span style=display:flex><span>      │  ├─ content/**          │
</span></span><span style=display:flex><span>      │  └─ static/**           │
</span></span><span style=display:flex><span>      └────────────┬────────────┘
</span></span><span style=display:flex><span>                   │
</span></span><span style=display:flex><span>                   │ workflow_call
</span></span><span style=display:flex><span>                   ▼
</span></span><span style=display:flex><span>┌─────────────────────────────────────┐
</span></span><span style=display:flex><span>│  my-documents Repository            │
</span></span><span style=display:flex><span>│                                     │
</span></span><span style=display:flex><span>│  .github/workflows/                 │
</span></span><span style=display:flex><span>│    trigger-docs-reusable.yml        │
</span></span><span style=display:flex><span>│                                     │
</span></span><span style=display:flex><span>│  ┌────────────────────────────────┐ │
</span></span><span style=display:flex><span>│  │ 1. Generate GitHub App Token   │ │
</span></span><span style=display:flex><span>│  │    (using DOC_APP_ID secret)   │ │
</span></span><span style=display:flex><span>│  └────────────┬───────────────────┘ │
</span></span><span style=display:flex><span>│               │                     │
</span></span><span style=display:flex><span>│  ┌────────────▼───────────────────┐ │
</span></span><span style=display:flex><span>│  │ 2. Trigger repository_dispatch │ │
</span></span><span style=display:flex><span>│  │    event in my-documents       │ │
</span></span><span style=display:flex><span>│  └────────────┬───────────────────┘ │
</span></span><span style=display:flex><span>└───────────────┼─────────────────────┘
</span></span><span style=display:flex><span>                │
</span></span><span style=display:flex><span>                │ repository_dispatch
</span></span><span style=display:flex><span>                ▼
</span></span><span style=display:flex><span>┌─────────────────────────────────────┐
</span></span><span style=display:flex><span>│  my-documents Repository            │
</span></span><span style=display:flex><span>│                                     │
</span></span><span style=display:flex><span>│  .github/workflows/                 │
</span></span><span style=display:flex><span>│    build-all-sites.yml              │
</span></span><span style=display:flex><span>│                                     │
</span></span><span style=display:flex><span>│  Builds all 5 documentation sites   │
</span></span><span style=display:flex><span>│  Deploys to GitHub Pages            │
</span></span><span style=display:flex><span>└─────────────────────────────────────┘
</span></span></code></pre></div><h3 id=32-authentication-flow>3.2. Authentication Flow</h3><ol><li><strong>Calling workflow runs</strong> in dependent repository context</li><li><strong>Reusable workflow executes</strong> in my-documents repository context</li><li><strong>GitHub App token generated</strong> using my-documents secrets:<ul><li><code>DOC_APP_ID</code> - GitHub App ID</li><li><code>DOC_APP_PRIVATE_KEY</code> - GitHub App private key</li></ul></li><li><strong>Token used to trigger</strong> <code>repository_dispatch</code> event</li><li><strong>Build workflow starts</strong> automatically in my-documents</li></ol><p><strong>Security Benefits:</strong></p><ul><li>No PAT tokens needed in dependent repositories</li><li>No secrets management in dependent repos</li><li>Automatic token expiration (1 hour)</li><li>Fine-grained permissions (Contents: write, Pages: write)</li><li>Centralized audit trail</li></ul><h2 id=4-configuration>4. Configuration</h2><h3 id=41-input-parameters>4.1. Input Parameters</h3><p>All inputs are optional with sensible defaults:</p><table><thead><tr><th>Input</th><th>Description</th><th>Default</th></tr></thead><tbody><tr><td><code>target_org</code></td><td>Target organization/user</td><td><code>fchastanet</code></td></tr><tr><td><code>target_repo</code></td><td>Target repository name</td><td><code>my-documents</code></td></tr><tr><td><code>event_type</code></td><td>Repository dispatch event type</td><td><code>trigger-docs-rebuild</code></td></tr><tr><td><code>docs_url_base</code></td><td>Documentation URL base</td><td><code>https://fchastanet.github.io</code></td></tr><tr><td><code>workflow_filename</code></td><td>Workflow filename to monitor</td><td><code>build-all-sites.yml</code></td></tr><tr><td><code>source_repo</code></td><td>Source repository</td><td><code>${{ github.repository }}</code></td></tr><tr><td></td><td>(auto-detected if not provided)</td><td></td></tr></tbody></table><h3 id=42-advanced-usage-examples>4.2. Advanced Usage Examples</h3><h4 id=421-custom-documentation-url>4.2.1. Custom Documentation URL</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>docs_url_base</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;https://docs.example.com&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=422-different-target-repository>4.2.2. Different Target Repository</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>target_org</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;myOrg&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>target_repo</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;my-docs&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>workflow_filename</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;build-docs.yml&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h4 id=423-manual-trigger-with-custom-event-type>4.2.3. Manual Trigger with Custom Event Type</h4><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>with</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>event_type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#4e9a06>&#39;custom-docs-rebuild&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=5-complete-example>5. Complete Example</h2><p>Here&rsquo;s a complete example for a dependent repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#000>---</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger Documentation Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Trigger on content changes</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Hugo content</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;static/**&#39;</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Static assets</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.mod&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Hugo modules</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.sum&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Hugo module checksums</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;configs/**&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># If using custom configs</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Allow manual triggering</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>workflow_dispatch</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#8f5902;font-style:italic># Trigger on releases</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>release</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>types</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>published]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger Documentation Build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=6-secrets-configuration>6. Secrets Configuration</h2><h3 id=61-in-my-documents-repository>6.1. In my-documents Repository</h3><p>The reusable workflow requires these secrets to be configured in the my-documents repository:</p><table><thead><tr><th>Secret</th><th>Description</th><th>How to Get</th></tr></thead><tbody><tr><td><code>DOC_APP_ID</code></td><td>GitHub App ID</td><td>From GitHub App settings</td></tr><tr><td><code>DOC_APP_PRIVATE_KEY</code></td><td>GitHub App private key (PEM format)</td><td>Generated when creating GitHub App</td></tr></tbody></table><p><strong>Setting up secrets:</strong></p><ol><li>Go to <a href=https://github.com/fchastanet/my-documents/settings/secrets/actions>https://github.com/fchastanet/my-documents/settings/secrets/actions</a></li><li>Add <code>DOC_APP_ID</code> with your GitHub App ID</li><li>Add <code>DOC_APP_PRIVATE_KEY</code> with the private key content</li></ol><h3 id=62-in-dependent-repositories>6.2. In Dependent Repositories</h3><p><strong>No secrets needed!</strong> The <code>secrets: inherit</code> directive allows the reusable workflow to access my-documents secrets when
running.</p><h2 id=7-understanding-secrets-inherit-and-access-control>7. Understanding Secrets: Inherit and Access Control</h2><h3 id=71-what-is-secrets-inherit>7.1. What is <code>secrets: inherit</code>?</h3><p><code>secrets: inherit</code> is a GitHub Actions feature that allows a reusable workflow to access <strong>repository secrets from the
calling workflow&rsquo;s repository</strong> when in the same repository context.</p><p><strong>Important distinction:</strong></p><p>When a dependent repository (like bash-compiler) calls this reusable workflow with <code>secrets: inherit</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>It means:</p><blockquote><p>&ldquo;Pass any secrets from bash-compiler repository to the reusable workflow&rdquo;</p></blockquote><p>NOT:</p><blockquote><p>&ldquo;Pass secrets from my-documents to bash-compiler&rdquo;</p></blockquote><h3 id=72-how-does-it-work-for-dependent-repositories>7.2. How Does It Work for Dependent Repositories?</h3><p>The key to understanding this is the <strong>execution context</strong>:</p><ol><li><strong>Workflow file location:</strong> <code>.github/workflows/trigger-docs-reusable.yml</code> lives in <strong>my-documents</strong></li><li><strong>Calling workflow location:</strong> <code>.github/workflows/trigger-docs.yml</code> lives in <strong>bash-compiler</strong> (or other dependent repo)</li><li><strong>Execution context:</strong> When bash-compiler calls the reusable workflow, the reusable workflow <strong>still runs in the
my-documents context</strong></li></ol><p>This means:</p><ul><li>The reusable workflow has access to <strong>my-documents&rsquo; secrets</strong>, not bash-compiler&rsquo;s secrets</li><li><code>secrets: inherit</code> tells the reusable workflow &ldquo;use my (the calling repo&rsquo;s) secrets if needed&rdquo;</li><li>But since the workflow runs in my-documents context, it automatically has access to my-documents&rsquo; secrets anyway</li></ul><h3 id=73-secret-access-hierarchy>7.3. Secret Access Hierarchy</h3><p><strong>GitHub Actions processes reusable workflows within the repository where they&rsquo;re defined:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>┌────────────────────────────────────────────────────────────────────────────────────┐
</span></span><span style=display:flex><span>│  bash-compiler repo                                                                │
</span></span><span style=display:flex><span>│                                                                                    │
</span></span><span style=display:flex><span>│  .github/workflows/                                                                │
</span></span><span style=display:flex><span>│    trigger-docs.yml                                                                │
</span></span><span style=display:flex><span>│                                                                                    │
</span></span><span style=display:flex><span>│  calls: fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master │
</span></span><span style=display:flex><span>│    secrets: inherit                                                                │
</span></span><span style=display:flex><span>└───────────────────────────────────────┬────────────────────────────────────────────┘
</span></span><span style=display:flex><span>                                        │
</span></span><span style=display:flex><span>                                        │ workflow_call (context: my-documents)
</span></span><span style=display:flex><span>                                        │
</span></span><span style=display:flex><span>                                        ▼
</span></span><span style=display:flex><span>                      ┌─────────────────────────────────┐
</span></span><span style=display:flex><span>                      │  my-documents repo              │
</span></span><span style=display:flex><span>                      │  (workflow context)             │
</span></span><span style=display:flex><span>                      │                                 │
</span></span><span style=display:flex><span>                      │  .github/workflows/             │
</span></span><span style=display:flex><span>                      │    trigger-docs-reusable.yml    │
</span></span><span style=display:flex><span>                      │                                 │
</span></span><span style=display:flex><span>                      │  ✅ Can access:                 │
</span></span><span style=display:flex><span>                      │  - DOC_APP_ID                   │
</span></span><span style=display:flex><span>                      │  - DOC_APP_PRIVATE_KEY          │
</span></span><span style=display:flex><span>                      │  (my-documents secrets)         │
</span></span><span style=display:flex><span>                      │                                 │
</span></span><span style=display:flex><span>                      │  ❌ Cannot directly access:     │
</span></span><span style=display:flex><span>                      │  - bash-compiler secrets        │
</span></span><span style=display:flex><span>                      └─────────────────────────────────┘
</span></span></code></pre></div><h3 id=74-why-this-workflow-cant-be-used-by-others>7.4. Why This Workflow Can&rsquo;t Be Used by Others</h3><p><strong>This workflow is tightly coupled to the my-documents infrastructure:</strong></p><h4 id=741-reason-1-github-app-is-organization-specific>7.4.1. Reason 1: GitHub App is Organization-Specific</h4><p>The workflow uses <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code> secrets that are:</p><ul><li>Configured <strong>only</strong> in the my-documents repository</li><li>Created from a GitHub App installed <strong>only</strong> on:<ul><li>fchastanet/my-documents</li><li>fchastanet/bash-compiler</li><li>fchastanet/bash-tools</li><li>fchastanet/bash-tools-framework</li><li>fchastanet/bash-dev-env</li></ul></li></ul><p><strong>If someone from outside this organization tries to use the workflow:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># In their-org/their-repo</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>What happens:</strong></p><ol><li>Workflow starts in their-org/their-repo context (calling workflow)</li><li>Reusable workflow executes in <strong>fchastanet/my-documents</strong> context</li><li>Reusable workflow tries to access <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code></li><li><strong>These secrets don&rsquo;t exist</strong> in their-repo, so <code>secrets: inherit</code> doesn&rsquo;t provide them</li><li>The workflow <strong>fails with authentication error</strong></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Error: The variable has not been set, or it has been set to an empty string.
</span></span><span style=display:flex><span>Evaluating: secrets.DOC_APP_ID
</span></span></code></pre></div><h4 id=742-reason-2-github-app-has-no-access-to-other-organizations>7.4.2. Reason 2: GitHub App Has No Access to Other Organizations</h4><p>The GitHub App is installed <strong>only</strong> on specific fchastanet repositories:</p><ul><li>When workflow tries to trigger <code>repository_dispatch</code> in my-documents using the app token</li><li>The token is only valid for repositories where the app is <strong>installed</strong></li><li>If someone tries to point it to their own my-documents fork, the app has no permission</li></ul><p><strong>Error example:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>Error: Resource not accessible by integration
</span></span><span style=display:flex><span>  at https://api.github.com/repos/their-org/their-docs/dispatches
</span></span></code></pre></div><h4 id=743-reason-3-secrets-are-repository-specific>7.4.3. Reason 3: Secrets Are Repository-Specific</h4><p>GitHub Actions secrets are stored at three levels:</p><table><thead><tr><th>Level</th><th>Scope</th><th>Accessible By</th></tr></thead><tbody><tr><td><strong>Repository</strong></td><td>Single repository</td><td>Workflows in that repository only</td></tr><tr><td><strong>Environment</strong></td><td>Specific deployment environment</td><td>Workflows targeting that environment</td></tr><tr><td><strong>Organization</strong></td><td>All repositories in organization</td><td>All workflows in the organization</td></tr></tbody></table><p>My-documents secrets are stored at the <strong>repository level</strong>:</p><ul><li>Only accessible to workflows executing in my-documents context</li><li>Not accessible to workflows in other organizations</li><li>Not inherited by other repositories, even if they call the reusable workflow</li></ul><h3 id=75-practical-example-why-it-fails>7.5. Practical Example: Why It Fails</h3><p><strong>Scenario:</strong> User <code>john</code> forks my-documents to <code>john/my-documents-fork</code> and tries to use the workflow:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># In john/bash-compiler (dependent repo fork)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>john/my-documents-fork/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Execution flow:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>1. bash-compiler workflow starts (context: john)
</span></span><span style=display:flex><span>   ❌ john/my-documents-fork doesn&#39;t have DOC_APP_ID or DOC_APP_PRIVATE_KEY secrets
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2. Reusable workflow starts (context: john/my-documents-fork)
</span></span><span style=display:flex><span>   ❌ Tries to access secrets.DOC_APP_ID
</span></span><span style=display:flex><span>   ❌ Secrets don&#39;t exist in john/my-documents-fork
</span></span><span style=display:flex><span>   ❌ secrets: inherit doesn&#39;t help (no secrets in john/bash-compiler either)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3. GitHub App access attempt
</span></span><span style=display:flex><span>   ❌ GitHub App not installed on john/my-documents-fork
</span></span><span style=display:flex><span>   ❌ Authentication fails with 403 error
</span></span></code></pre></div><h3 id=76-how-someone-else-could-create-their-own-version>7.6. How Someone Else Could Create Their Own Version</h3><p><strong>If someone wanted to use this pattern for their own orchestrator:</strong></p><ol><li><p><strong>Create their own GitHub App</strong></p><ul><li>In their organization settings</li><li>With Contents: write and Pages: write permissions</li><li>Install on their repositories</li></ul></li><li><p><strong>Set up secrets in their my-documents repository</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>DOC_APP_ID = their-app-id
</span></span><span style=display:flex><span>DOC_APP_PRIVATE_KEY = their-private-key
</span></span></code></pre></div></li><li><p><strong>Create their own reusable workflow</strong></p><ul><li>Copy and adapt the trigger-docs-reusable.yml</li><li>Reference their own secrets</li><li>Change target_org default to their organization</li></ul></li><li><p><strong>Update dependent repositories</strong></p><ul><li>Point to their reusable workflow</li><li>Use <code>secrets: inherit</code> in their calls</li></ul></li></ol><p><strong>Example for their-org:</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#8f5902;font-style:italic># In their-org/bash-compiler</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>their-org/my-docs-orchestrator/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#8f5902;font-style:italic># This now references their-org&#39;s secrets, not fchastanet&#39;s</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=77-summary-why-this-workflow-is-fchastanet-only>7.7. Summary: Why This Workflow is Fchastanet-Only</h3><table><thead><tr><th>Component</th><th>Why It&rsquo;s Fchastanet-Specific</th><th>Can Be Generalized?</th></tr></thead><tbody><tr><td>Workflow logic</td><td>Generic, reusable for any workflow</td><td>✅ Yes, with different inputs</td></tr><tr><td><code>DOC_APP_ID</code> secret</td><td>Specific to fchastanet&rsquo;s GitHub App</td><td>❌ No, organization-specific</td></tr><tr><td><code>DOC_APP_PRIVATE_KEY</code> secret</td><td>Specific to fchastanet&rsquo;s GitHub App</td><td>❌ No, organization-specific</td></tr><tr><td>Target repository (default)</td><td>Hardcoded to my-documents</td><td>✅ Yes, via <code>target_repo</code> input</td></tr><tr><td>Target organization (default)</td><td>Hardcoded to fchastanet</td><td>✅ Yes, via <code>target_org</code> input</td></tr><tr><td>GitHub App installation</td><td>Only on fchastanet repositories</td><td>❌ No, would need own app</td></tr></tbody></table><h3 id=78-conclusion>7.8. Conclusion</h3><p>The <code>secrets: inherit</code> mechanism is elegant for internal workflows within an organization because:</p><ul><li><strong>For dependent repos in fchastanet:</strong> They can call the workflow without managing secrets (works perfectly)</li><li><strong>For external users:</strong> They cannot use this workflow as-is because the GitHub App and secrets are organization-specific</li><li><strong>This is intentional:</strong> It provides security and prevents unauthorized access to the build orchestration</li></ul><p>This is <strong>not a limitation</strong> but a <strong>security feature</strong> - the workflow is designed to work only within the fchastanet
organization where the GitHub App is installed.</p><h2 id=8-workflow-outputs>8. Workflow Outputs</h2><p>The workflow provides rich output and summaries:</p><h3 id=81-console-output>8.1. Console Output</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-text data-lang=text><span style=display:flex;background-color:#dfdfdf><span>🔔 Triggering documentation build in fchastanet/my-documents...
</span></span><span style=display:flex><span>✅ Successfully triggered docs build in fchastanet/my-documents
</span></span><span style=display:flex><span>📖 Documentation will be updated at: https://fchastanet.github.io/bash-compiler/
</span></span><span style=display:flex><span>ℹ️  Note: Documentation deployment may take 2-5 minutes
</span></span></code></pre></div><h3 id=82-github-actions-summary>8.2. GitHub Actions Summary</h3><p>The workflow creates a detailed summary visible in the Actions UI:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-markdown data-lang=markdown><span style=display:flex;background-color:#dfdfdf><span><span style=color:purple;font-weight:700>### 8.3. ✅ Documentation build triggered
</span></span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>**Source Repository:**</span> <span style=color:#4e9a06>`fchastanet/bash-compiler`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>**Target Repository:**</span> <span style=color:#4e9a06>`fchastanet/my-documents`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>**Commit:**</span> <span style=color:#4e9a06>`abc123def456`</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>**Triggered by:**</span> <span style=color:#4e9a06>`fchastanet`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>🔗 [<span style=color:#204a87;font-weight:700>View build status</span>](<span style=color:#c4a000>https://github.com/fchastanet/my-documents/actions/workflows/build-all-sites.yml</span>)
</span></span><span style=display:flex><span>📖 [<span style=color:#204a87;font-weight:700>View documentation</span>](<span style=color:#c4a000>https://fchastanet.github.io/bash-compiler/</span>)
</span></span></code></pre></div><h2 id=9-troubleshooting>9. Troubleshooting</h2><h3 id=91-build-not-triggered>9.1. Build Not Triggered</h3><p><strong>Symptoms:</strong></p><ul><li>Workflow runs successfully but build doesn&rsquo;t start</li><li>HTTP 204 response but no activity in my-documents</li></ul><p><strong>Possible Causes:</strong></p><ol><li><p><strong>GitHub App not installed</strong> on target repository</p><ul><li>Solution: Install the GitHub App on my-documents repository</li></ul></li><li><p><strong>GitHub App permissions insufficient</strong></p><ul><li>Solution: Ensure app has <code>Contents: write</code> permission</li></ul></li><li><p><strong>Event type mismatch</strong></p><ul><li>Solution: Verify <code>event_type</code> input matches what build-all-sites.yml expects</li></ul></li></ol><h3 id=92-authentication-failures>9.2. Authentication Failures</h3><p><strong>Symptoms:</strong></p><ul><li>HTTP 401 (Unauthorized) or 403 (Forbidden) errors</li><li>&ldquo;Resource not accessible by integration&rdquo; error</li></ul><p><strong>Possible Causes:</strong></p><ol><li><p><strong>Secrets not configured</strong> in my-documents</p><ul><li>Solution: Add <code>DOC_APP_ID</code> and <code>DOC_APP_PRIVATE_KEY</code> secrets</li></ul></li><li><p><strong>GitHub App private key incorrect</strong></p><ul><li>Solution: Regenerate private key in GitHub App settings</li></ul></li><li><p><strong>GitHub App permissions revoked</strong></p><ul><li>Solution: Reinstall GitHub App on repositories</li></ul></li></ol><h3 id=93-workflow-not-found>9.3. Workflow Not Found</h3><p><strong>Symptoms:</strong></p><ul><li>&ldquo;Unable to resolve action&rdquo; error</li><li>&ldquo;Workflow file not found&rdquo; error</li></ul><p><strong>Possible Causes:</strong></p><ol><li><p><strong>Wrong branch reference</strong></p><ul><li>Solution: Use <code>@master</code> not <code>@main</code> (my-documents uses master branch)</li></ul></li><li><p><strong>Workflow file renamed or moved</strong></p><ul><li>Solution: Verify file exists at <code>.github/workflows/trigger-docs-reusable.yml</code></li></ul></li></ol><h3 id=94-debug-mode>9.4. Debug Mode</h3><p>Enable debug logging in dependent repository:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p>Then enable debug logs in repository settings:</p><ol><li>Go to repository settings → Secrets and variables → Actions</li><li>Add repository variable: <code>ACTIONS_STEP_DEBUG</code> = <code>true</code></li><li>Add repository variable: <code>ACTIONS_RUNNER_DEBUG</code> = <code>true</code></li></ol><h2 id=10-migration-guide>10. Migration Guide</h2><h3 id=101-from-old-trigger-workflow>10.1. From Old Trigger Workflow</h3><p>If you&rsquo;re migrating from the old PAT-based trigger workflow:</p><p><strong>Old approach (deprecated):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>runs-on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>ubuntu-latest</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>steps</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#204a87;font-weight:700>name</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>Trigger my-documents build</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>        </span><span style=color:#204a87;font-weight:700>run</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>|</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>          curl -X POST \
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            -H &#34;Authorization: token ${{ secrets.DOCS_BUILD_TOKEN }}&#34; \
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>            ...</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>New approach (recommended):</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Benefits of migration:</strong></p><ul><li>✅ Remove <code>DOCS_BUILD_TOKEN</code> secret from dependent repository</li><li>✅ Simpler workflow (3 lines vs 50+ lines)</li><li>✅ Centralized authentication</li><li>✅ Automatic token management</li><li>✅ Better security (GitHub App vs PAT)</li></ul><h2 id=11-best-practices>11. Best Practices</h2><h3 id=111-trigger-paths>11.1. Trigger Paths</h3><p>Only trigger on content changes to avoid unnecessary builds:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>on</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>push</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>branches</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000;font-weight:700>[</span><span style=color:#000>master]</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>paths</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;content/**&#39;</span><span style=color:#f8f8f8>      </span><span style=color:#8f5902;font-style:italic># Documentation content</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;static/**&#39;</span><span style=color:#f8f8f8>       </span><span style=color:#8f5902;font-style:italic># Static assets</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.mod&#39;</span><span style=color:#f8f8f8>          </span><span style=color:#8f5902;font-style:italic># Hugo modules (theme updates)</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span>- <span style=color:#4e9a06>&#39;go.sum&#39;</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><p><strong>Don&rsquo;t trigger on:</strong></p><ul><li>Test files</li><li>CI configuration changes</li><li>Source code changes (unless they affect docs)</li><li>README updates (unless it&rsquo;s documentation content)</li></ul><h3 id=112-concurrency-control>11.2. Concurrency Control</h3><p>Prevent multiple concurrent builds:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>concurrency</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>group</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>docs-build-${{ github.ref }}</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>      </span><span style=color:#204a87;font-weight:700>cancel-in-progress</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h3 id=113-conditional-triggers>11.3. Conditional Triggers</h3><p>Only trigger for certain branches:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none;display:grid><code class=language-yaml data-lang=yaml><span style=display:flex;background-color:#dfdfdf><span><span style=color:#204a87;font-weight:700>jobs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>  </span><span style=color:#204a87;font-weight:700>trigger-docs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>github.ref == &#39;refs/heads/master&#39;</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>uses</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>fchastanet/my-documents/.github/workflows/trigger-docs-reusable.yml@master</span><span style=color:#f8f8f8>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8>    </span><span style=color:#204a87;font-weight:700>secrets</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8> </span><span style=color:#000>inherit</span><span style=color:#f8f8f8>
</span></span></span></code></pre></div><h2 id=12-faq>12. FAQ</h2><h3 id=121-q-do-i-need-to-configure-secrets-in-my-dependent-repository>12.1. Q: Do I need to configure secrets in my dependent repository?</h3><p><strong>A:</strong> No! When using <code>secrets: inherit</code>, the reusable workflow can access secrets from my-documents repository.</p><h3 id=122-q-can-i-test-the-workflow-before-merging-to-master>12.2. Q: Can I test the workflow before merging to master?</h3><p><strong>A:</strong> Yes, add <code>workflow_dispatch</code> trigger and manually run it from the Actions tab.</p><h3 id=123-q-how-long-does-documentation-deployment-take>12.3. Q: How long does documentation deployment take?</h3><p><strong>A:</strong> Typically 2-5 minutes:</p><ul><li>Trigger: ~5 seconds</li><li>Build (all sites): ~60 seconds</li><li>Deployment: ~1-3 minutes (GitHub Pages propagation)</li></ul><h3 id=124-q-can-i-use-this-with-my-own-organization>12.4. Q: Can I use this with my own organization?</h3><p><strong>A:</strong> Yes, override <code>target_org</code> and <code>target_repo</code> inputs. You&rsquo;ll need to set up your own GitHub App.</p><h3 id=125-q-what-if-the-build-fails>12.5. Q: What if the build fails?</h3><p><strong>A:</strong> Check the build status link in the workflow summary. The trigger workflow will still succeed; failures happen in
the build workflow.</p><h3 id=126-q-can-i-trigger-builds-for-multiple-repositories>12.6. Q: Can I trigger builds for multiple repositories?</h3><p><strong>A:</strong> Yes, create multiple jobs in your workflow, each calling the reusable workflow with different <code>source_repo</code>
values.</p><h2 id=13-related-documentation>13. Related Documentation</h2><ul><li><a href=../../../.github/copilot-instructions.md#multi-site-orchestrator-architecture>Multi-Site Orchestrator Architecture</a></li><li><a href=./2026-02-18-github-app-migration.md>GitHub App Migration Guide</a></li><li><a href=../.github/workflows/build-all-sites.yml>Build All Sites Workflow</a></li></ul><h2 id=14-support>14. Support</h2><p>For issues or questions:</p><ol><li>Check <a href=#9-troubleshooting>Troubleshooting</a> section</li><li>Review <a href=https://github.com/fchastanet/my-documents/actions>GitHub Actions logs</a></li><li>Create an issue in <a href=https://github.com/fchastanet/my-documents/issues>my-documents repository</a></li></ol></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/fchastanet aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Bash Tools Framework" aria-label="Bash Tools Framework"><a target=_blank rel=noopener href=https://fchastanet.github.io/bash-tools-framework/ aria-label="Bash Tools Framework"><i class="fas fa-toolbox"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Bash Tools" aria-label="Bash Tools"><a target=_blank rel=noopener href=https://fchastanet.github.io/bash-tools/ aria-label="Bash Tools"><i class="fas fa-tools"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Bash Dev Env" aria-label="Bash Dev Env"><a target=_blank rel=noopener href=https://fchastanet.github.io/bash-dev-env/ aria-label="Bash Dev Env"><i class="fas fa-laptop-code"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title="Bash Compiler" aria-label="Bash Compiler"><a target=_blank rel=noopener href=https://fchastanet.github.io/bash-compiler/ aria-label="Bash Compiler"><i class="fas fa-cogs"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>Francois Chastanet</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span><span class=ms-2><a href=https://github.com/fchastanet/my-documents/blob/master/LICENSE target=_blank rel=noopener>Privacy Policy</a></span></div></div></div></footer></div><script src=/my-documents/js/main.min.65d702cee0bf35691ed701b78b7b713d03be4a9f1f184f95e8049d065c07bc57.js integrity="sha256-ZdcCzuC/NWke1wG3i3txPQO+Sp8fGE+V6ASdBlwHvFc=" crossorigin=anonymous></script><script defer src=/my-documents/js/click-to-copy.min.24576ff9fe9f85bb1948ecae52ce227cafce53757a3ad52301f2a79260f6b97d.js integrity="sha256-JFdv+f6fhbsZSOyuUs4ifK/OU3V6OtUjAfKnkmD2uX0=" crossorigin=anonymous></script><script src=/my-documents/js/tabpane-persist.js></script></body></html>